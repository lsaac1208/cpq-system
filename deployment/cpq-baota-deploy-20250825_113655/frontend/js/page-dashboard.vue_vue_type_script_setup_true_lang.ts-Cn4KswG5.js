import{g as a,h as e,E as t,d as l,l as s,o as n,a6 as u,aN as d,a1 as o,$ as r,f as i,_ as c,a as p,aF as _,p as f,G as v}from"./element-plus-DR0qywX_.js";import{o as g,p as h,q as m}from"./api-BHu6TLr6.js";import{z as y,r as w,l as b,A as q,C as z,S as x,K as Q,an as P,B as j,u as k,Q as A,L,J as S,P as $}from"./vue-BMWQU0Ry.js";const C={class:"dashboard"},F={class:"stat-content"},I={class:"stat-icon products"},B={class:"stat-info"},D={class:"stat-content"},E={class:"stat-icon quotes"},G={class:"stat-info"},J={class:"stat-content"},K={class:"stat-icon pending"},N={class:"stat-info"},H={class:"stat-content"},M={class:"stat-icon revenue"},O={class:"stat-info"},R={class:"card-header"},T={class:"card-header"},U={key:0},V={class:"quick-actions"},W=y({__name:"Dashboard",setup(y){const W=w(!1),X=w([]),Y=w([]),Z=w({products:0,quotes:0,pendingQuotes:0,revenue:0}),aa=(a,e)=>a?a.length>e?a.substring(0,e)+"...":a:"",ea=()=>{return a=this,e=function*(){var a,e;W.value=!0;try{const l=yield g.getAllQuotes({page:1,per_page:5});X.value=(null==l?void 0:l.quotes)||[];const s=yield h.getProducts({page:1,per_page:1});try{const a=yield m({page:1,per_page:5});Y.value=(null==a?void 0:a.records)||[]}catch(t){Y.value=[]}Z.value={products:(null==(a=null==s?void 0:s.pagination)?void 0:a.total)||0,quotes:(null==(e=null==l?void 0:l.pagination)?void 0:e.total)||0,pendingQuotes:((null==l?void 0:l.quotes)||[]).filter(a=>"pending"===a.status).length,revenue:((null==l?void 0:l.quotes)||[]).filter(a=>"approved"===a.status).reduce((a,e)=>a+(e.final_price||0),0)}}catch(t){Z.value={products:0,quotes:0,pendingQuotes:0,revenue:0},X.value=[],Y.value=[]}finally{W.value=!1}},new Promise((t,l)=>{var s=a=>{try{u(e.next(a))}catch(t){l(t)}},n=a=>{try{u(e.throw(a))}catch(t){l(t)}},u=a=>a.done?t(a.value):Promise.resolve(a.value).then(s,n);u((e=e.apply(a,null)).next())});var a,e};return b(()=>{ea()}),(g,h)=>{const m=l,y=t,w=e,b=a,ea=p,ta=P("router-link"),la=r,sa=i,na=o,ua=_,da=c;return j(),q("div",C,[h[14]||(h[14]=z("div",{class:"dashboard-header"},[z("h1",null,"仪表盘"),z("p",null,"欢迎使用CPQ系统")],-1)),x(b,{gutter:20,class:"stats-row"},{default:Q(()=>[x(w,{span:6},{default:Q(()=>[x(y,{class:"stat-card"},{default:Q(()=>[z("div",F,[z("div",I,[x(m,null,{default:Q(()=>[x(k(s))]),_:1})]),z("div",B,[z("h3",null,A(Z.value.products),1),h[0]||(h[0]=z("p",null,"活跃产品",-1))])])]),_:1})]),_:1}),x(w,{span:6},{default:Q(()=>[x(y,{class:"stat-card"},{default:Q(()=>[z("div",D,[z("div",E,[x(m,null,{default:Q(()=>[x(k(n))]),_:1})]),z("div",G,[z("h3",null,A(Z.value.quotes),1),h[1]||(h[1]=z("p",null,"总报价数",-1))])])]),_:1})]),_:1}),x(w,{span:6},{default:Q(()=>[x(y,{class:"stat-card"},{default:Q(()=>[z("div",J,[z("div",K,[x(m,null,{default:Q(()=>[x(k(u))]),_:1})]),z("div",N,[z("h3",null,A(Z.value.pendingQuotes),1),h[2]||(h[2]=z("p",null,"待处理报价",-1))])])]),_:1})]),_:1}),x(w,{span:6},{default:Q(()=>[x(y,{class:"stat-card"},{default:Q(()=>[z("div",H,[z("div",M,[x(m,null,{default:Q(()=>[x(k(d))]),_:1})]),z("div",O,[z("h3",null,"$"+A(Z.value.revenue.toLocaleString()),1),h[3]||(h[3]=z("p",null,"总收入",-1))])])]),_:1})]),_:1})]),_:1}),x(b,{gutter:20,class:"content-row"},{default:Q(()=>[x(w,{span:12},{default:Q(()=>[x(y,null,{header:Q(()=>[z("div",R,[h[5]||(h[5]=z("span",null,"最近报价",-1)),x(ta,{to:"/quotes"},{default:Q(()=>[x(ea,{type:"primary",size:"small"},{default:Q(()=>h[4]||(h[4]=[$("查看全部",-1)])),_:1,__:[4]})]),_:1})])]),default:Q(()=>[L((j(),S(na,{data:X.value,style:{width:"100%"}},{default:Q(()=>[x(la,{prop:"quote_number",label:"报价单号",width:"120"}),x(la,{prop:"customer_name",label:"客户"}),x(la,{prop:"status",label:"状态",width:"100"},{default:Q(({row:a})=>{return[x(sa,{type:(e=a.status,{draft:"info",pending:"warning",approved:"success",rejected:"danger",expired:"info"}[e]||"info")},{default:Q(()=>[$(A(a.status),1)]),_:2},1032,["type"])];var e}),_:1}),x(la,{prop:"final_price",label:"金额",width:"100"},{default:Q(({row:a})=>{var e;return[$(" $"+A(null==(e=a.final_price)?void 0:e.toLocaleString()),1)]}),_:1})]),_:1},8,["data"])),[[da,W.value]])]),_:1})]),_:1}),x(w,{span:12},{default:Q(()=>[x(y,null,{header:Q(()=>[z("div",T,[h[7]||(h[7]=z("span",null,"最近AI分析",-1)),x(ta,{to:"/ai-analysis-enhanced"},{default:Q(()=>[x(ea,{type:"primary",size:"small"},{default:Q(()=>h[6]||(h[6]=[$("查看全部",-1)])),_:1,__:[6]})]),_:1})])]),default:Q(()=>[L((j(),S(na,{data:Y.value,style:{width:"100%"}},{default:Q(()=>[x(la,{prop:"document_name",label:"文档名称",width:"150"},{default:Q(({row:a})=>[x(ua,{content:a.document_name,placement:"top"},{default:Q(()=>[z("span",null,A(aa(a.document_name,20)),1)]),_:2},1032,["content"])]),_:1}),x(la,{label:"分析结果",width:"100"},{default:Q(({row:a})=>{var e,t;return[a.success&&(null==(t=null==(e=a.extracted_data)?void 0:e.basic_info)?void 0:t.name)&&!a.extracted_data.basic_info.name.includes("失败")?(j(),q("span",U,A(aa(a.extracted_data.basic_info.name,15)),1)):(j(),S(sa,{key:1,type:"warning",size:"small"},{default:Q(()=>h[8]||(h[8]=[$("解析异常",-1)])),_:1,__:[8]}))]}),_:1}),x(la,{label:"置信度",width:"80"},{default:Q(({row:a})=>{return[x(sa,{type:(e=a.overall_confidence||0,e>=.8?"success":e>=.6?"warning":"danger"),size:"small"},{default:Q(()=>[$(A((100*(a.overall_confidence||0)).toFixed(0))+"% ",1)]),_:2},1032,["type"])];var e}),_:1}),x(la,{label:"状态",width:"80"},{default:Q(({row:a})=>[x(sa,{type:a.success?"success":"danger",size:"small"},{default:Q(()=>[$(A(a.success?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[da,W.value]])]),_:1})]),_:1})]),_:1}),x(b,{gutter:20,class:"content-row"},{default:Q(()=>[x(w,{span:24},{default:Q(()=>[x(y,null,{header:Q(()=>h[9]||(h[9]=[z("div",{class:"card-header"},[z("span",null,"快捷操作")],-1)])),default:Q(()=>[z("div",V,[x(ta,{to:"/quotes/create"},{default:Q(()=>[x(ea,{type:"primary",size:"large",class:"action-button"},{default:Q(()=>[x(m,null,{default:Q(()=>[x(k(f))]),_:1}),h[10]||(h[10]=$(" 创建新报价 ",-1))]),_:1,__:[10]})]),_:1}),x(ta,{to:"/products"},{default:Q(()=>[x(ea,{type:"success",size:"large",class:"action-button"},{default:Q(()=>[x(m,null,{default:Q(()=>[x(k(s))]),_:1}),h[11]||(h[11]=$(" 管理产品 ",-1))]),_:1,__:[11]})]),_:1}),x(ta,{to:"/ai-analysis-enhanced"},{default:Q(()=>[x(ea,{type:"info",size:"large",class:"action-button"},{default:Q(()=>[x(m,null,{default:Q(()=>[x(k(v))]),_:1}),h[12]||(h[12]=$(" AI智能分析 ",-1))]),_:1,__:[12]})]),_:1}),x(ta,{to:"/quotes"},{default:Q(()=>[x(ea,{type:"warning",size:"large",class:"action-button"},{default:Q(()=>[x(m,null,{default:Q(()=>[x(k(n))]),_:1}),h[13]||(h[13]=$(" 查看所有报价 ",-1))]),_:1,__:[13]})]),_:1})])]),_:1})]),_:1})]),_:1})])}}});export{W as _};
