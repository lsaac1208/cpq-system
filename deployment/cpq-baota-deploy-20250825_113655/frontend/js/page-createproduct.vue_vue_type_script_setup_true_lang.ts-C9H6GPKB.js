var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(l,a,t)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t,u=(e,l)=>{for(var a in l||(l={}))s.call(l,a)&&o(e,a,l[a]);if(t)for(var a of t(l))i.call(l,a)&&o(e,a,l[a]);return e},n=(e,t)=>l(e,a(t)),r=(e,l,a)=>new Promise((t,s)=>{var i=e=>{try{u(a.next(e))}catch(l){s(l)}},o=e=>{try{u(a.throw(e))}catch(l){s(l)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,o);u((a=a.apply(e,l)).next())});import{a as d,d as c,ak as p,v,ac as m,t as f,p as _,c as g,al as y,f as h,b,y as k,g as V,h as w,z as C,j as U,u as x,S as z,q as M,X as I,am as B,an as A,ao as P,a3 as D,T,E,_ as j,D as S,m as F,ap as G,aq as W,ar as q,I as R,i as O,V as L,as as J,at as N,au as K,av as X,aw as Y,ax as Q,r as $,H,k as Z,A as ee,a4 as le,ay as ae,az as te,G as se,aA as ie,aB as oe,aC as ue,aD as ne,aE as re}from"./element-plus-DR0qywX_.js";import{z as de,r as ce,b as pe,w as ve,A as me,C as fe,M as _e,X as ge,F as ye,S as he,K as be,P as ke,u as Ve,Q as we,B as Ce,R as Ue,a8 as xe,J as ze,aB as Me,aC as Ie,l as Be,L as Ae,n as Pe,E as De,aD as Te,Z as Ee,az as je}from"./vue-BMWQU0Ry.js";import{C as Se,s as Fe,c as Ge}from"./utils-BjNHK8wL.js";import{m as We,p as qe}from"./api-BHu6TLr6.js";import{_ as Re}from"./page-aianalysisenhanced.vue-9uq21fmn.js";const Oe={class:"fast-image-upload"},Le={class:"image-preview-area"},Je={key:0,class:"image-display"},Ne=["src","alt"],Ke={class:"image-overlay"},Xe={class:"overlay-actions"},Ye={key:1,class:"uploading-state"},Qe={class:"upload-progress"},$e={class:"upload-text"},He={key:0,class:"processing-info"},Ze={class:"processing-text"},el={key:2,class:"empty-upload-area"},ll={key:0,class:"error-message"},al={key:1,class:"compression-stats"},tl={class:"stats-card"},sl={class:"stats-header"},il={class:"stats-content"},ol={class:"stats-row"},ul={class:"stats-value"},nl={class:"stats-row"},rl={class:"stats-value compressed"},dl={class:"stats-row"},cl={class:"stats-value"},pl={class:"stats-row"},vl={class:"stats-value"},ml=Re(de({__name:"FastImageUpload",props:{productId:{default:null},initialImageUrl:{default:""},imageAlt:{default:"产品图片"},maxSizeMB:{default:2},disabled:{type:Boolean,default:!1},compressionPreset:{default:"standard"}},emits:["upload-success","upload-error","delete-success","delete-error"],setup(e,{expose:l,emit:a}){const t=e,s=a,i=ce(),o=ce(t.initialImageUrl),k=ce(!1),V=ce(!1),w=ce(0),C=ce(!1),U=ce(""),x=ce(""),z=ce(""),M=ce(null),I=ce(0),B=pe(()=>Se[t.compressionPreset]);ve(()=>t.initialImageUrl,e=>{o.value=e},{immediate:!0});const A=e=>r(this,null,function*(){var l,a,i,r;if((e=>["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?!(e.size>10485760&&(U.value="文件太大，请选择小于10MB的图片",1)):(U.value="不支持的文件格式。请使用 JPG、PNG 或 WebP 格式",!1))(e)){k.value=!0,w.value=0,U.value="",z.value="",I.value=Date.now(),x.value="开始处理图片...";try{x.value="正在压缩图片...",w.value=10;const i=yield Ge(e,B.value,(e,l)=>{w.value=10+.6*e,z.value=l});if(x.value="正在上传到服务器...",w.value=70,!t.productId)return void P(i);const r=new FormData;r.append("image",i.file);const d="/products/".concat(t.productId,"/gallery/upload"),c=yield We.post(d,r,{onUploadProgress:e=>{if(e.total){const l=e.loaded/e.total*100;w.value=70+.3*l}}});if(w.value=100,x.value="上传完成！",!c)throw new Error("上传响应为空");{const e=Date.now()-I.value,t=(null==(l=c.image)?void 0:l.image_url)||c.image_url||(null==(a=c.upload_info)?void 0:a.image_url);if(!t)throw new Error("上传响应中未找到图片URL");{o.value=t,M.value=n(u({},i),{processingTime:e});const l="图片上传成功！压缩".concat(i.compressionRatio.toFixed(1),"%，耗时").concat(e,"ms");Fe.success(l),s("upload-success",t,n(u({},c),{compressionStats:M.value}))}}}catch(d){const e=(null==(r=null==(i=d.response)?void 0:i.data)?void 0:r.error)||d.message||"图片处理或上传失败";U.value=e,s("upload-error",e),Fe.error("上传失败: ".concat(e))}finally{k.value=!1,w.value=0,x.value="",z.value="",setTimeout(()=>{k.value||(x.value="")},2e3)}}}),P=e=>{const l=new FileReader;l.onload=l=>{var a;o.value=null==(a=l.target)?void 0:a.result;const t=Date.now()-I.value;M.value=n(u({},e),{processingTime:t}),k.value=!1,w.value=0,Fe.success("图片预览就绪！压缩".concat(e.compressionRatio.toFixed(1),"%"))},l.readAsDataURL(e.file)},D=()=>r(this,null,function*(){var e,l;if(t.productId&&o.value)try{yield b.confirm("确定要删除这张图片吗？删除后无法恢复。","确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),V.value=!0,yield We.delete("/products/".concat(t.productId,"/delete-image")),o.value="",M.value=null,U.value="",Fe.success("图片删除成功"),s("delete-success")}catch(a){if("cancel"!==a){const t=(null==(l=null==(e=a.response)?void 0:e.data)?void 0:l.error)||"图片删除失败";U.value=t,s("delete-error",t),Fe.error(t)}}finally{V.value=!1}}),T=()=>{var e;t.disabled||k.value||null==(e=i.value)||e.click()},E=e=>{var l;const a=e.target,t=null==(l=a.files)?void 0:l[0];t&&A(t),a.value=""},j=e=>{t.disabled||k.value||(e.preventDefault(),C.value=!0)},S=()=>{C.value=!1},F=e=>{var l;if(t.disabled||k.value)return;e.preventDefault(),C.value=!1;const a=null==(l=e.dataTransfer)?void 0:l.files;a&&a.length>0&&A(a[0])},G=e=>{e.target.src="/images/default-product.svg"},W=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]};return l({triggerUpload:T,deleteImage:D,currentImageUrl:pe(()=>o.value),isUploading:pe(()=>k.value),compressionStats:pe(()=>M.value)}),(e,l)=>{const a=c,t=d,s=f,u=g,n=h;return Ce(),me("div",Oe,[fe("div",Le,[fe("div",{class:ye(["image-preview",{"has-image":o.value,"drag-over":C.value,uploading:k.value}]),onDragover:ge(j,["prevent"]),onDragleave:ge(S,["prevent"]),onDrop:ge(F,["prevent"]),onClick:T},[o.value&&!k.value?(Ce(),me("div",Je,[fe("img",{src:(r=o.value,r?r.startsWith("data:")||r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/api/v1")?"http://localhost:5173".concat(r):"http://localhost:5173/api/v1/products/uploads/".concat(r):""),alt:e.imageAlt||"产品图片",class:"preview-image",onError:G},null,40,Ne),fe("div",Ke,[fe("div",Xe,[he(t,{type:"primary",size:"small",onClick:ge(T,["stop"])},{default:be(()=>[he(a,null,{default:be(()=>[he(Ve(p))]),_:1}),l[1]||(l[1]=ke(" 更换图片 ",-1))]),_:1,__:[1]}),he(t,{type:"danger",size:"small",onClick:ge(D,["stop"]),disabled:V.value},{default:be(()=>[he(a,null,{default:be(()=>[he(Ve(v))]),_:1}),l[2]||(l[2]=ke(" 删除 ",-1))]),_:1,__:[2]},8,["disabled"])])])])):k.value?(Ce(),me("div",Ye,[he(a,{class:"uploading-icon"},{default:be(()=>[he(Ve(m))]),_:1}),fe("div",Qe,[he(s,{percentage:w.value,"stroke-width":8,color:w.value<30?"#409eff":(w.value,"#67c23a")},null,8,["percentage","color"])]),fe("p",$e,we(x.value),1),z.value?(Ce(),me("div",He,[fe("p",Ze,we(z.value),1)])):_e("",!0)])):(Ce(),me("div",el,[he(a,{class:"upload-icon",size:"48"},{default:be(()=>[he(Ve(_))]),_:1}),l[3]||(l[3]=fe("div",{class:"upload-hint"},[fe("p",{class:"primary-text"},"点击或拖拽图片到这里上传"),fe("p",{class:"secondary-text"}," 支持 JPG、PNG、WebP 格式，大图片将快速压缩 "),fe("p",{class:"tertiary-text"}," ⚡ 使用高性能压缩引擎，速度提升80%+ ")],-1))]))],34),U.value?(Ce(),me("div",ll,[he(u,{title:U.value,type:"error",closable:!0,onClose:l[0]||(l[0]=e=>U.value=""),"show-icon":""},null,8,["title"])])):_e("",!0),M.value&&o.value?(Ce(),me("div",al,[fe("div",tl,[fe("div",sl,[he(a,{class:"stats-icon"},{default:be(()=>[he(Ve(y))]),_:1}),l[4]||(l[4]=fe("span",{class:"stats-title"},"处理完成",-1)),he(n,{type:M.value.compressionRatio>50?"success":"info",size:"small"},{default:be(()=>[ke(" 优化 "+we(M.value.compressionRatio.toFixed(1))+"% ",1)]),_:1},8,["type"])]),fe("div",il,[fe("div",ol,[l[5]||(l[5]=fe("span",{class:"stats-label"},"原始大小:",-1)),fe("span",ul,we(W(M.value.originalSize)),1)]),fe("div",nl,[l[6]||(l[6]=fe("span",{class:"stats-label"},"压缩后:",-1)),fe("span",rl,we(W(M.value.compressedSize)),1)]),fe("div",dl,[l[7]||(l[7]=fe("span",{class:"stats-label"},"处理时间:",-1)),fe("span",cl,we(M.value.processingTime)+"ms",1)]),fe("div",pl,[l[8]||(l[8]=fe("span",{class:"stats-label"},"图片尺寸:",-1)),fe("span",vl,we(M.value.width)+"×"+we(M.value.height),1)])])])])):_e("",!0)]),fe("input",{ref_key:"fileInput",ref:i,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:E,style:{display:"none"}},null,544)]);var r}}}),[["__scopeId","data-v-f6a43a15"]]),fl={class:"batch-image-upload"},_l={class:"upload-config"},gl={key:0,class:"upload-hint"},yl={key:1,class:"uploading-state"},hl={class:"upload-progress"},bl={class:"upload-text"},kl={key:2,class:"files-preview"},Vl={class:"files-grid"},wl={class:"file-preview"},Cl=["src","alt"],Ul={key:1,class:"no-preview"},xl={key:2,class:"status-overlay uploading"},zl={key:3,class:"status-overlay success"},Ml={key:4,class:"status-overlay error"},Il={class:"file-info"},Bl={class:"file-name"},Al={class:"file-meta"},Pl={class:"file-size"},Dl={class:"upload-actions"},Tl={key:0,class:"upload-results"},El={class:"results-summary"},jl={class:"results-detail"},Sl={class:"results-list"},Fl={class:"result-icon"},Gl={class:"result-content"},Wl={class:"result-filename"},ql={key:0,class:"result-success"},Rl={key:1,class:"result-error"},Ol=Re(de({__name:"BatchImageUpload",props:{productId:{},maxFiles:{default:10}},emits:["upload-complete"],setup(e,{emit:l}){const a=e,t=l,s=ce(),i=ce([]),o=ce(!1),u=ce([]),n=ce(!1),p=ce(0),b=ce(""),D=ce({image_type:"product",auto_set_primary:!1}),T=pe(()=>u.value.filter(e=>e.success).length),E=pe(()=>u.value.filter(e=>!e.success).length),j=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},S=e=>["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?!(e.size>10485760&&(Fe.error("文件 ".concat(e.name," 过大，请选择小于10MB的图片")),1)):(Fe.error("文件 ".concat(e.name," 格式不支持，请选择 JPG、PNG 或 WebP 格式")),!1),F=e=>new Promise((l,a)=>{const t=new FileReader;t.onload=e=>{var a;return l(null==(a=e.target)?void 0:a.result)},t.onerror=a,t.readAsDataURL(e)}),G=e=>r(this,null,function*(){const l=[];for(const a of e)S(a)&&l.push(a);if(i.value.length+l.length>a.maxFiles){const e=a.maxFiles-i.value.length;l.splice(e),Fe.warning("最多只能上传 ".concat(a.maxFiles," 张图片，已自动限制为 ").concat(e," 张"))}for(const e of l){const l={file:e,name:e.name,size:e.size};try{l.preview=yield F(e)}catch(t){}i.value.push(l)}l.length>0&&Fe.success("添加了 ".concat(l.length," 张图片"))}),W=()=>{i.value=[],u.value=[],p.value=0,b.value=""},q=()=>{R()},R=()=>{var e;o.value||null==(e=s.value)||e.click()},O=e=>r(this,null,function*(){const l=e.target,a=Array.from(l.files||[]);a.length>0&&(yield G(a)),l.value=""}),L=e=>{o.value||(e.preventDefault(),n.value=!0)},J=()=>{n.value=!1},N=e=>r(this,null,function*(){var l;if(o.value)return;e.preventDefault(),n.value=!1;const a=Array.from((null==(l=e.dataTransfer)?void 0:l.files)||[]);a.length>0&&(yield G(a))}),K=()=>r(this,null,function*(){var e,l;if(0!==i.value.length){o.value=!0,u.value=[],p.value=0,b.value="准备上传...";try{const e=new FormData;i.value.forEach(l=>{e.append("images",l.file)}),e.append("image_type",D.value.image_type),e.append("auto_set_primary",D.value.auto_set_primary.toString()),b.value="上传中...";const l=yield We.post("/products/".concat(a.productId,"/gallery/batch-upload"),e,{onUploadProgress:e=>{if(e.total){const l=e.loaded/e.total*100;p.value=Math.round(l),b.value="上传中... ".concat(Math.round(l),"%")}}});b.value="处理完成",p.value=100,u.value=l.data.results||[],i.value.forEach((e,l)=>{const a=u.value.find(l=>l.filename===e.file.name);a&&(e.success=a.success,e.error=a.error)});const s=l.data.message||"上传完成: 成功 ".concat(T.value," 个，失败 ").concat(E.value," 个");0===E.value?Fe.success(s):Fe.warning(s),t("upload-complete",u.value)}catch(s){b.value="上传失败";const a=(null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.error)||"批量上传失败";Fe.error(a),i.value.forEach(e=>{e.error=a})}finally{o.value=!1,setTimeout(()=>{o.value||(b.value="")},3e3)}}});return(e,l)=>{const a=x,t=U,r=C,S=w,F=z,G=V,X=k,Y=c,Q=f,$=d,H=g,Z=h,ee=P,le=A;return Ce(),me("div",fl,[fe("div",_l,[he(X,{model:D.value,"label-width":"100px",size:"small"},{default:be(()=>[he(G,{gutter:20},{default:be(()=>[he(S,{span:12},{default:be(()=>[he(r,{label:"图片类型"},{default:be(()=>[he(t,{modelValue:D.value.image_type,"onUpdate:modelValue":l[0]||(l[0]=e=>D.value.image_type=e),style:{width:"100%"}},{default:be(()=>[he(a,{label:"产品图",value:"product"}),he(a,{label:"细节图",value:"detail"}),he(a,{label:"使用图",value:"usage"}),he(a,{label:"对比图",value:"comparison"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),he(S,{span:12},{default:be(()=>[he(r,{label:"自动主图"},{default:be(()=>[he(F,{modelValue:D.value.auto_set_primary,"onUpdate:modelValue":l[1]||(l[1]=e=>D.value.auto_set_primary=e),"active-text":"首张设为主图","inactive-text":"不设主图"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),fe("div",{class:ye(["upload-area",{"drag-over":n.value,uploading:o.value}]),onDrop:N,onDragover:ge(L,["prevent"]),onDragleave:ge(J,["prevent"]),onClick:R},[o.value||0!==i.value.length?o.value?(Ce(),me("div",yl,[he(Y,{class:"uploading-icon",size:"32"},{default:be(()=>[he(Ve(m))]),_:1}),fe("div",hl,[he(Q,{percentage:p.value,"stroke-width":8,color:"#67c23a"},null,8,["percentage"])]),fe("p",bl,we(b.value),1)])):(Ce(),me("div",kl,[fe("h4",null,"待上传文件 ("+we(i.value.length)+"/10)",1),fe("div",Vl,[(Ce(!0),me(Ue,null,xe(i.value,(e,a)=>(Ce(),me("div",{key:a,class:ye(["file-item",{uploading:e.uploading,success:e.success,error:e.error}])},[fe("div",wl,[e.preview?(Ce(),me("img",{key:0,src:e.preview,alt:e.name,class:"preview-image"},null,8,Cl)):(Ce(),me("div",Ul,[he(Y,null,{default:be(()=>[he(Ve(y))]),_:1})])),e.uploading?(Ce(),me("div",xl,[he(Y,{class:"status-icon"},{default:be(()=>[he(Ve(m))]),_:1}),l[3]||(l[3]=fe("span",{class:"status-text"},"处理中...",-1))])):e.success?(Ce(),me("div",zl,[he(Y,{class:"status-icon"},{default:be(()=>[he(Ve(M))]),_:1}),l[4]||(l[4]=fe("span",{class:"status-text"},"成功",-1))])):e.error?(Ce(),me("div",Ml,[he(Y,{class:"status-icon"},{default:be(()=>[he(Ve(I))]),_:1}),l[5]||(l[5]=fe("span",{class:"status-text"},"失败",-1))])):_e("",!0)]),fe("div",Il,[fe("div",Bl,we(e.name),1),fe("div",Al,[fe("span",Pl,we(j(e.size)),1),o.value?_e("",!0):(Ce(),ze($,{key:0,type:"danger",size:"small",text:"",onClick:e=>(e=>{i.value.splice(e,1)})(a)},{default:be(()=>l[6]||(l[6]=[ke(" 移除 ",-1)])),_:2,__:[6]},1032,["onClick"]))])])],2))),128))]),fe("div",Dl,[he($,{onClick:q},{default:be(()=>[he(Y,null,{default:be(()=>[he(Ve(_))]),_:1}),l[7]||(l[7]=ke(" 继续添加 ",-1))]),_:1,__:[7]}),he($,{onClick:W},{default:be(()=>[he(Y,null,{default:be(()=>[he(Ve(v))]),_:1}),l[8]||(l[8]=ke(" 清空全部 ",-1))]),_:1,__:[8]}),he($,{type:"primary",loading:o.value,onClick:K,disabled:0===i.value.length},{default:be(()=>[he(Y,null,{default:be(()=>[he(Ve(B))]),_:1}),ke(" 开始上传 ("+we(i.value.length)+") ",1)]),_:1},8,["loading","disabled"])])])):(Ce(),me("div",gl,[he(Y,{class:"upload-icon",size:"48"},{default:be(()=>[he(Ve(_))]),_:1}),l[2]||(l[2]=fe("div",{class:"hint-text"},[fe("p",{class:"primary-text"},"拖拽多张图片到这里或点击选择"),fe("p",{class:"secondary-text"},"支持 JPG、PNG、WebP 格式，最多同时上传10张"),fe("p",{class:"tertiary-text"},"批量上传将自动压缩优化，提升加载速度")],-1))]))],34),u.value.length>0?(Ce(),me("div",Tl,[l[11]||(l[11]=fe("h4",null,"上传结果",-1)),fe("div",El,[he(H,{title:"上传完成: 成功 ".concat(T.value," 个，失败 ").concat(E.value," 个"),type:0===E.value?"success":"warning",closable:!1,"show-icon":""},null,8,["title","type"])]),fe("div",jl,[he(le,null,{default:be(()=>[he(ee,{title:"查看详细结果",name:"details"},{default:be(()=>[fe("div",Sl,[(Ce(!0),me(Ue,null,xe(u.value,(e,a)=>{var t;return Ce(),me("div",{key:a,class:ye(["result-item",{success:e.success,error:!e.success}])},[fe("div",Fl,[e.success?(Ce(),ze(Y,{key:0,class:"success-icon"},{default:be(()=>[he(Ve(M))]),_:1})):(Ce(),ze(Y,{key:1,class:"error-icon"},{default:be(()=>[he(Ve(I))]),_:1}))]),fe("div",Gl,[fe("div",Wl,we(e.filename),1),e.success?(Ce(),me("div",ql,[l[10]||(l[10]=ke(" 上传成功 ",-1)),(null==(t=e.image)?void 0:t.is_primary)?(Ce(),ze(Z,{key:0,size:"small",type:"warning"},{default:be(()=>l[9]||(l[9]=[ke("主图",-1)])),_:1,__:[9]})):_e("",!0)])):(Ce(),me("div",Rl,we(e.error),1))])],2)}),128))])]),_:1})]),_:1})])])):_e("",!0),fe("input",{ref_key:"fileInput",ref:s,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:"",onChange:O,style:{display:"none"}},null,544)])}}}),[["__scopeId","data-v-cc96c3cc"]]),Ll={class:"gallery-manager"},Jl={class:"toolbar"},Nl={class:"toolbar-left"},Kl={class:"toolbar-right"},Xl={key:0,class:"stats-bar"},Yl={class:"stats-content"},Ql={class:"stat-item"},$l={class:"stat-value"},Hl={class:"stat-item"},Zl={class:"stat-value"},ea={class:"stat-item"},la={class:"images-grid"},aa={class:"selection-checkbox"},ta={key:0,class:"primary-badge"},sa=["onClick"],ia=["src","alt"],oa={class:"image-overlay"},ua={class:"image-info"},na={class:"image-title"},ra={class:"image-meta"},da={class:"file-size"},ca={class:"image-actions"},pa={class:"drag-handle"},va={key:0,class:"empty-state"},ma={class:"dialog-footer"},fa={key:0,class:"preview-content"},_a=["src","alt"],ga={class:"preview-info"},ya={key:0},ha={class:"preview-meta"},ba={class:"meta-item"},ka={class:"meta-item"},Va={class:"meta-item"},wa={class:"meta-item"},Ca=Re(de({__name:"ProductGalleryManager",props:Me({productId:{},images:{}},{visible:u({type:Boolean},{default:!1}),visibleModifiers:{}}),emits:Me(["refresh","update:visible"],["update:visible"]),setup(e,{emit:l}){const a=e,t=l,s=Ie(e,"visible"),i=ce(!1),o=ce([]),u=ce([]),n=ce(null),m=ce(""),f=ce(!1),g=ce(!1),y=ce(!1),V=ce(!1),w=ce(null),M=ce({title:"",description:"",alt_text:"",image_type:"product",is_primary:!1}),I=ce(null),A=pe(()=>m.value?o.value.filter(e=>e.image_type===m.value):o.value),P=e=>e?e.startsWith("data:")||e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/api/v1")?"http://localhost:5173".concat(e):"http://localhost:5173/api/v1/products/uploads/".concat(e):"/images/default-product.svg",L=e=>({product:"产品图",detail:"细节图",usage:"使用图",comparison:"对比图"}[e]||"产品图"),J=e=>({product:"primary",detail:"success",usage:"warning",comparison:"info"}[e]||"primary"),N=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},K=()=>r(this,null,function*(){var e,l;if(a.productId){i.value=!0;try{const[e,l]=yield Promise.all([We.get("/products/".concat(a.productId,"/gallery")),We.get("/products/".concat(a.productId,"/gallery/stats"))]);o.value=e.images||[],n.value=l,u.value=[]}catch(t){Fe.error((null==(l=null==(e=t.response)?void 0:e.data)?void 0:l.error)||"加载图片失败")}finally{i.value=!1}}}),X=e=>r(this,null,function*(){var l,s;try{yield We.post("/products/".concat(a.productId,"/gallery/").concat(e,"/set-primary")),Fe.success("主图设置成功"),yield K(),t("refresh")}catch(i){Fe.error((null==(s=null==(l=i.response)?void 0:l.data)?void 0:s.error)||"设置主图失败")}}),Y=e=>{w.value=e,M.value={title:e.title||"",description:e.description||"",alt_text:e.alt_text||"",image_type:e.image_type,is_primary:e.is_primary},y.value=!0},Q=()=>r(this,null,function*(){var e,l;if(w.value)try{yield We.put("/products/".concat(a.productId,"/gallery/").concat(w.value.id),M.value),Fe.success("图片信息已更新"),y.value=!1,yield K(),t("refresh")}catch(s){Fe.error((null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.error)||"更新失败")}}),$=e=>r(this,null,function*(){var l,s;try{yield b.confirm("确定要删除这张图片吗？删除后无法恢复。","确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),yield We.delete("/products/".concat(a.productId,"/gallery/").concat(e)),Fe.success("图片删除成功"),yield K(),t("refresh")}catch(i){"cancel"!==i&&Fe.error((null==(s=null==(l=i.response)?void 0:l.data)?void 0:s.error)||"删除失败")}}),H=()=>r(this,null,function*(){var e,l;if(0!==u.value.length)try{yield b.confirm("确定要删除选中的 ".concat(u.value.length," 张图片吗？删除后无法恢复。"),"批量删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const e=u.value.map(e=>We.delete("/products/".concat(a.productId,"/gallery/").concat(e)));yield Promise.all(e),Fe.success("成功删除 ".concat(u.value.length," 张图片")),u.value=[],yield K(),t("refresh")}catch(s){"cancel"!==s&&Fe.error((null==(l=null==(e=s.response)?void 0:e.data)?void 0:l.error)||"批量删除失败")}}),Z=(e,l)=>{Fe.success("图片上传成功"),f.value=!1,K(),t("refresh")},ee=e=>{Fe.error("上传失败: ".concat(e))},le=e=>{const l=e.filter(e=>e.success).length;Fe.success("批量上传完成，成功上传 ".concat(l," 张图片")),g.value=!1,K(),t("refresh")},ae=e=>{e.target.src="/images/default-product.svg"},te=()=>{s.value=!1},se=()=>{};return ve(s,e=>{e&&(K(),setTimeout(se,100))}),Be(()=>{a.images&&(o.value=a.images)}),(e,l)=>{const a=d,t=x,o=U,r=E,b=S,se=c,ie=W,oe=h,ue=R,ne=D,re=O,de=C,ce=z,pe=k,ve=j;return Ce(),ze(ne,{modelValue:s.value,"onUpdate:modelValue":l[13]||(l[13]=e=>s.value=e),title:"图片管理",width:"80%",class:"gallery-manager-dialog","before-close":te},{default:be(()=>{var s;return[fe("div",Ll,[fe("div",Jl,[fe("div",Nl,[he(a,{type:"primary",icon:Ve(_),onClick:l[0]||(l[0]=e=>f.value=!0)},{default:be(()=>l[14]||(l[14]=[ke(" 添加图片 ",-1)])),_:1,__:[14]},8,["icon"]),he(a,{icon:Ve(B),onClick:l[1]||(l[1]=e=>g.value=!0)},{default:be(()=>l[15]||(l[15]=[ke(" 批量上传 ",-1)])),_:1,__:[15]},8,["icon"]),u.value.length>0?(Ce(),ze(a,{key:0,type:"danger",icon:Ve(v),onClick:H},{default:be(()=>[ke(" 删除选中 ("+we(u.value.length)+") ",1)]),_:1},8,["icon"])):_e("",!0)]),fe("div",Kl,[he(o,{modelValue:m.value,"onUpdate:modelValue":l[2]||(l[2]=e=>m.value=e),placeholder:"筛选图片类型",clearable:"",style:{width:"140px"}},{default:be(()=>[he(t,{label:"产品图",value:"product"}),he(t,{label:"细节图",value:"detail"}),he(t,{label:"使用图",value:"usage"}),he(t,{label:"对比图",value:"comparison"})]),_:1},8,["modelValue"]),he(a,{icon:Ve(T),onClick:K,loading:i.value},{default:be(()=>l[16]||(l[16]=[ke(" 刷新 ",-1)])),_:1,__:[16]},8,["icon","loading"])])]),n.value?(Ce(),me("div",Xl,[he(r,{class:"stats-card",shadow:"never"},{default:be(()=>[fe("div",Yl,[fe("div",Ql,[l[17]||(l[17]=fe("span",{class:"stat-label"},"总图片:",-1)),fe("span",$l,we(n.value.total_images),1)]),fe("div",Hl,[l[18]||(l[18]=fe("span",{class:"stat-label"},"总大小:",-1)),fe("span",Zl,we(N(n.value.total_size)),1)]),fe("div",ea,[l[19]||(l[19]=fe("span",{class:"stat-label"},"主图:",-1)),fe("span",{class:ye(["stat-value",{"text-success":n.value.has_primary,"text-warning":!n.value.has_primary}])},we(n.value.has_primary?"已设置":"未设置"),3)])])]),_:1})])):_e("",!0),Ae((Ce(),me("div",la,[(Ce(!0),me(Ue,null,xe(A.value,e=>(Ce(),me("div",{key:e.id,class:ye(["image-card",{selected:u.value.includes(e.id),primary:e.is_primary}])},[fe("div",aa,[he(b,{"model-value":u.value.includes(e.id),onChange:l=>(e=>{const l=u.value.indexOf(e);l>-1?u.value.splice(l,1):u.value.push(e)})(e.id)},null,8,["model-value","onChange"])]),e.is_primary?(Ce(),me("div",ta,[he(se,null,{default:be(()=>[he(Ve(F))]),_:1}),l[20]||(l[20]=ke(" 主图 ",-1))])):_e("",!0),fe("div",{class:"image-preview",onClick:l=>(e=>{I.value=e,V.value=!0})(e)},[fe("img",{src:P(e.thumbnail_url||e.image_url),alt:e.title,class:"preview-img",onError:ae},null,40,ia),fe("div",oa,[he(ie,null,{default:be(()=>[he(a,{size:"small",icon:Ve(G)},{default:be(()=>l[21]||(l[21]=[ke("预览",-1)])),_:1,__:[21]},8,["icon"]),he(a,{size:"small",icon:Ve(p),onClick:ge(l=>Y(e),["stop"])},{default:be(()=>l[22]||(l[22]=[ke("编辑",-1)])),_:2,__:[22]},1032,["icon","onClick"])]),_:2},1024)])],8,sa),fe("div",ua,[fe("div",na,we(e.title||e.filename),1),fe("div",ra,[he(oe,{size:"small",type:J(e.image_type)},{default:be(()=>[ke(we(L(e.image_type)),1)]),_:2},1032,["type"]),fe("span",da,we(N(e.file_size||0)),1)])]),fe("div",ca,[he(ie,null,{default:be(()=>[e.is_primary?_e("",!0):(Ce(),ze(a,{key:0,size:"small",type:"warning",onClick:l=>X(e.id)},{default:be(()=>l[23]||(l[23]=[ke(" 设为主图 ",-1)])),_:2,__:[23]},1032,["onClick"])),he(a,{size:"small",icon:Ve(p),onClick:l=>Y(e)},{default:be(()=>l[24]||(l[24]=[ke(" 编辑 ",-1)])),_:2,__:[24]},1032,["icon","onClick"]),he(a,{size:"small",type:"danger",icon:Ve(v),onClick:l=>$(e.id)},{default:be(()=>l[25]||(l[25]=[ke(" 删除 ",-1)])),_:2,__:[25]},1032,["icon","onClick"])]),_:2},1024)]),fe("div",pa,[he(se,null,{default:be(()=>[he(Ve(q))]),_:1})])],2))),128)),i.value||0!==A.value.length?_e("",!0):(Ce(),me("div",va,[he(ue,{description:"暂无图片"})]))])),[[ve,i.value]])]),he(ne,{modelValue:f.value,"onUpdate:modelValue":l[3]||(l[3]=e=>f.value=e),title:"上传图片",width:"600px","before-close":()=>f.value=!1},{default:be(()=>[he(ml,{"product-id":e.productId,onUploadSuccess:Z,onUploadError:ee},null,8,["product-id"])]),_:1},8,["modelValue","before-close"]),he(ne,{modelValue:g.value,"onUpdate:modelValue":l[4]||(l[4]=e=>g.value=e),title:"批量上传图片",width:"700px","before-close":()=>g.value=!1},{default:be(()=>[he(Ol,{"product-id":e.productId,onUploadComplete:le},null,8,["product-id"])]),_:1},8,["modelValue","before-close"]),he(ne,{modelValue:y.value,"onUpdate:modelValue":l[11]||(l[11]=e=>y.value=e),title:"编辑图片信息",width:"500px","before-close":()=>y.value=!1},{default:be(()=>[w.value?(Ce(),ze(pe,{key:0,model:M.value,"label-width":"80px",onSubmit:ge(Q,["prevent"])},{default:be(()=>[he(de,{label:"标题"},{default:be(()=>[he(re,{modelValue:M.value.title,"onUpdate:modelValue":l[5]||(l[5]=e=>M.value.title=e),placeholder:"图片标题"},null,8,["modelValue"])]),_:1}),he(de,{label:"描述"},{default:be(()=>[he(re,{modelValue:M.value.description,"onUpdate:modelValue":l[6]||(l[6]=e=>M.value.description=e),type:"textarea",rows:3,placeholder:"图片描述"},null,8,["modelValue"])]),_:1}),he(de,{label:"替代文本"},{default:be(()=>[he(re,{modelValue:M.value.alt_text,"onUpdate:modelValue":l[7]||(l[7]=e=>M.value.alt_text=e),placeholder:"用于屏幕阅读器"},null,8,["modelValue"])]),_:1}),he(de,{label:"图片类型"},{default:be(()=>[he(o,{modelValue:M.value.image_type,"onUpdate:modelValue":l[8]||(l[8]=e=>M.value.image_type=e),style:{width:"100%"}},{default:be(()=>[he(t,{label:"产品图",value:"product"}),he(t,{label:"细节图",value:"detail"}),he(t,{label:"使用图",value:"usage"}),he(t,{label:"对比图",value:"comparison"})]),_:1},8,["modelValue"])]),_:1}),he(de,{label:"设为主图"},{default:be(()=>[he(ce,{modelValue:M.value.is_primary,"onUpdate:modelValue":l[9]||(l[9]=e=>M.value.is_primary=e)},null,8,["modelValue"])]),_:1}),fe("div",ma,[he(a,{onClick:l[10]||(l[10]=e=>y.value=!1)},{default:be(()=>l[26]||(l[26]=[ke("取消",-1)])),_:1,__:[26]}),he(a,{type:"primary",onClick:Q},{default:be(()=>l[27]||(l[27]=[ke("保存",-1)])),_:1,__:[27]})])]),_:1},8,["model"])):_e("",!0)]),_:1},8,["modelValue","before-close"]),he(ne,{modelValue:V.value,"onUpdate:modelValue":l[12]||(l[12]=e=>V.value=e),title:(null==(s=I.value)?void 0:s.title)||"图片预览",width:"80%",class:"preview-dialog","before-close":()=>V.value=!1},{default:be(()=>{var e;return[I.value?(Ce(),me("div",fa,[fe("img",{src:P(I.value.image_url),alt:I.value.title,class:"preview-image"},null,8,_a),fe("div",ga,[fe("h4",null,we(I.value.title||I.value.filename),1),I.value.description?(Ce(),me("p",ya,we(I.value.description),1)):_e("",!0),fe("div",ha,[fe("div",ba,[l[28]||(l[28]=fe("span",{class:"meta-label"},"类型:",-1)),he(oe,{type:J(I.value.image_type)},{default:be(()=>[ke(we(L(I.value.image_type)),1)]),_:1},8,["type"])]),fe("div",ka,[l[29]||(l[29]=fe("span",{class:"meta-label"},"尺寸:",-1)),fe("span",null,we(I.value.width)+"×"+we(I.value.height),1)]),fe("div",Va,[l[30]||(l[30]=fe("span",{class:"meta-label"},"大小:",-1)),fe("span",null,we(N(I.value.file_size||0)),1)]),fe("div",wa,[l[31]||(l[31]=fe("span",{class:"meta-label"},"格式:",-1)),fe("span",null,we(null==(e=I.value.format)?void 0:e.toUpperCase()),1)])])])])):_e("",!0)]}),_:1},8,["modelValue","title","before-close"])]}),_:1},8,["modelValue"])}}}),[["__scopeId","data-v-092c6b41"]]),Ua={class:"main-display"},xa={key:0,class:"image-loading"},za={key:1,class:"main-image-wrapper"},Ma=["src","alt"],Ia={key:0,class:"edit-overlay"},Ba={class:"edit-actions"},Aa={key:1,class:"image-overlay"},Pa={class:"image-info"},Da={key:0},Ta={key:1},Ea={class:"image-meta"},ja={class:"image-type"},Sa={key:0,class:"primary-badge"},Fa={key:2,class:"navigation-arrows"},Ga=["disabled"],Wa=["disabled"],qa={key:3,class:"image-counter"},Ra={key:0,class:"uploading-state"},Oa={class:"upload-progress"},La={class:"upload-text"},Ja={key:0,class:"processing-info"},Na={class:"processing-text"},Ka={key:1},Xa={class:"empty-hint"},Ya={class:"empty-text"},Qa={key:0,class:"upload-hint"},$a={class:"main-actions"},Ha={key:0,class:"thumbnails-section"},Za={key:0,class:"edit-mode-hint"},et=["onClick","draggable","onDragstart","onDrop"],lt={class:"thumbnail-wrapper"},at={key:0,class:"sort-handle"},tt=["src","alt"],st={key:1,class:"thumbnail-controls"},it={key:2,class:"primary-indicator"},ot={class:"type-indicator"},ut={class:"thumbnail-info"},nt={class:"thumbnail-title"},rt={key:0,class:"thumbnail-meta"},dt={class:"file-size"},ct=["onClick"],pt={class:"thumbnail-wrapper"},vt=["src","alt"],mt={key:0,class:"primary-indicator"},ft={class:"type-indicator"},_t={class:"thumbnail-info"},gt={class:"thumbnail-title"},yt={class:"preview-content"},ht={class:"preview-image-container"},bt=["src","alt"],kt={class:"preview-controls"},Vt={class:"zoom-info"},wt={key:0,class:"preview-navigation"},Ct={class:"preview-counter"},Ut={key:0,class:"stats-content"},xt={class:"stats-item"},zt={class:"stats-value"},Mt={class:"stats-item"},It={class:"stats-value"},Bt={class:"stats-item"},At={class:"stats-value"},Pt={class:"stats-item"},Dt={class:"type-breakdown"},Tt=Re(de({__name:"ProductGallery",props:{productId:{},editMode:{type:Boolean,default:!1},autoLoad:{type:Boolean,default:!0},showControls:{type:Boolean,default:!0},canEdit:{type:Boolean,default:!1},height:{default:"400px"}},emits:["refresh","imageChange","imagesUpdate"],setup(e,{expose:l,emit:a}){Te(e=>({"004327c8":"number"==typeof e.height?e.height+"px":e.height}));const t=e,s=a,i=ce(!1),o=ce([]),u=ce(0),n=ce(null),g=ce(!1),k=ce(!1),V=ce(!1),w=ce(!1),C=ce(!1),U=ce(!1),x=ce(!1),z=ce(0),M=ce(!1),I=ce(""),B=ce(""),A=ce(),P=ce(1),T=ce({x:0,y:0}),E=ce(!1),j=ce({x:0,y:0}),S=ce(!1),R=pe(()=>{if(!Array.isArray(o.value)||0===o.value.length)return null;const e=u.value;return e<0||e>=o.value.length?null:o.value[e]||null}),O=pe(()=>({transform:"scale(".concat(P.value,") translate(").concat(T.value.x,"px, ").concat(T.value.y,"px)"),cursor:E.value?"grabbing":"grab"})),Z=e=>e?e.startsWith("data:")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/api/v1")||e.startsWith("/")?e:"/api/v1/products/uploads/".concat(e):"/images/default-product.svg",ee=e=>({product:"产品图",detail:"细节图",usage:"使用图",comparison:"对比图"}[e]||"产品图"),le=e=>{if(0===e)return"0 B";const l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+["B","KB","MB","GB"][l]},ae=()=>r(this,null,function*(){var e,l,a;if(t.productId){i.value=!0;try{const e=yield We.get("/products/".concat(t.productId,"/gallery")),l=null==e?void 0:e.images;if(o.value=Array.isArray(l)?l:[],(null==e?void 0:e.primary_image)&&o.value.length>0){const e=o.value.findIndex(e=>e&&e.is_primary);e>=0&&(u.value=e)}try{const e=yield We.get("/products/".concat(t.productId,"/gallery/stats"));n.value=e||null}catch(r){n.value=null}s("imagesUpdate",o.value),yield Pe()}catch(d){o.value=[],s("imagesUpdate",[]),404!==(null==(e=d.response)?void 0:e.status)&&Fe.error((null==(a=null==(l=d.response)?void 0:l.data)?void 0:a.error)||"加载图片集失败")}finally{i.value=!1}}}),te=e=>{if(!Array.isArray(o.value)||e<0||e>=o.value.length)return;u.value=e;const l=o.value[e];l&&l.image_url&&s("imageChange",l.image_url)},se=()=>{Array.isArray(o.value)&&0!==o.value.length&&u.value>0&&u.value--},ie=()=>{Array.isArray(o.value)&&0!==o.value.length&&u.value<o.value.length-1&&u.value++},oe=()=>{R.value&&(k.value=!0,$e())},ue=()=>{k.value=!1,$e()},ne=()=>{g.value=!g.value},re=()=>{V.value=!0},de=e=>["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?!(e.size>10485760&&(Fe.error("文件太大，请选择小于10MB的图片"),1)):(Fe.error("不支持的文件格式。请使用 JPG、PNG 或 WebP 格式"),!1),Me=e=>r(this,null,function*(){var l,a;const i=Array.from(e).filter(de);if(0!==i.length){U.value=!0,z.value=0,B.value="",I.value="开始处理图片...";try{const e=i.map((e,l)=>r(this,null,function*(){I.value="正在处理图片 ".concat(l+1,"/").concat(i.length,"...");const a=yield Ge(e,Se.standard,(e,a)=>{const t=l/i.length*100,s=e/i.length*60;z.value=t+s,B.value=a}),s=new FormData;return s.append("image",a.file),s.append("image_type","product"),(yield We.post("/products/".concat(t.productId,"/gallery/upload"),s)).data}));yield Promise.all(e),z.value=100,I.value="上传完成！",Fe.success("成功上传 ".concat(i.length," 张图片")),yield ae(),s("refresh")}catch(o){const e=(null==(a=null==(l=o.response)?void 0:l.data)?void 0:a.error)||o.message||"图片上传失败";Fe.error(e)}finally{U.value=!1,z.value=0,I.value="",B.value=""}}else Fe.warning("请选择有效的图片文件")}),Ie=()=>{t.editMode&&(U.value||A.value&&A.value.click())},Ae=e=>{const l=e.target,a=l.files;a&&a.length>0&&Me(a),l.value=""},Ee=e=>{t.editMode&&(U.value||(e.preventDefault(),M.value=!0))},je=()=>{M.value=!1},qe=e=>{var l;if(!t.editMode)return;if(U.value)return;e.preventDefault(),M.value=!1;const a=null==(l=e.dataTransfer)?void 0:l.files;a&&a.length>0&&Me(a)},Re=e=>r(this,null,function*(){var l,a;try{yield We.put("/products/".concat(t.productId,"/gallery/").concat(e,"/primary")),Fe.success("主图设置成功"),yield ae(),s("refresh")}catch(i){Fe.error((null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.error)||"设置主图失败")}}),Oe=e=>r(this,null,function*(){var l,a;try{yield b.confirm("确定要删除这张图片吗？删除后无法恢复。","确认删除",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"}),x.value=!0,yield We.delete("/products/".concat(t.productId,"/gallery/").concat(e)),Fe.success("图片删除成功"),yield ae(),s("refresh")}catch(i){"cancel"!==i&&Fe.error((null==(a=null==(l=i.response)?void 0:l.data)?void 0:a.error)||"图片删除失败")}finally{x.value=!1}}),Le=()=>{Ie()},Je=()=>{C.value=!C.value,C.value&&Fe.info("拖拽图片进行排序，完成后点击“完成排序”")};let Ne=-1;const Ke=(e,l)=>r(this,null,function*(){var a,s;if(C.value&&-1!==Ne&&Ne!==e&&Array.isArray(o.value)&&0!==o.value.length){l.preventDefault();try{const l=[...o.value],[a]=l.splice(Ne,1);l.splice(e,0,a),o.value=l,Ne===u.value?u.value=e:Ne<u.value&&e>=u.value?u.value--:Ne>u.value&&e<=u.value&&u.value++;const s=l.map(e=>e.id);yield We.put("/products/".concat(t.productId,"/gallery/sort"),{image_ids:s}),Fe.success("图片顺序更新成功")}catch(i){Fe.error((null==(s=null==(a=i.response)?void 0:a.data)?void 0:s.error)||"排序更新失败"),yield ae()}Ne=-1}}),Xe=()=>{Ne=-1},Ye=()=>{P.value=Math.min(1.2*P.value,5)},Qe=()=>{P.value=Math.max(P.value/1.2,.1)},$e=()=>{P.value=1,T.value={x:0,y:0}},He=e=>{e.preventDefault(),e.deltaY<0?Ye():Qe()},Ze=e=>{P.value<=1||(E.value=!0,j.value={x:e.clientX,y:e.clientY})},el=e=>{if(!E.value||P.value<=1)return;const l=e.clientX-j.value.x,a=e.clientY-j.value.y;T.value.x+=l,T.value.y+=a,j.value={x:e.clientX,y:e.clientY}},ll=()=>{E.value=!1},al=()=>{if(!R.value)return;const e=document.createElement("a");e.href=Z(R.value.image_url),e.download=R.value.original_filename||R.value.filename,e.target="_blank",e.click()},tl=e=>{const l=document.querySelector(".thumbnails-scroll");if(!l)return;const a="left"===e?l.scrollLeft-200:l.scrollLeft+200;l.scrollTo({left:a,behavior:"smooth"})},sl=()=>{},il=e=>{const l=e.target;l.src,l.src.includes("default-product.svg")||(l.src="/images/default-product.svg",Fe.warning("图片加载失败，已显示默认图片"))},ol=e=>{const l=e.target;l.src,l.src.includes("default-product.svg")||(l.src="/images/default-product.svg")},ul=()=>r(this,null,function*(){yield ae()});Be(()=>r(this,null,function*(){t.autoLoad&&(yield ae()),yield Pe();const e=document.querySelector(".thumbnails-scroll"),l=document.querySelector(".thumbnails-container");e&&l&&(S.value=e.scrollWidth>l.clientWidth)}));const nl=e=>{if(k.value)switch(e.key){case"ArrowLeft":se();break;case"ArrowRight":ie();break;case"Escape":ue();break;case"+":case"=":Ye();break;case"-":Qe();break;case"0":$e()}};return l({loadGallery:ae,selectImage:te,openPreview:oe,currentImage:R,images:o}),ve(()=>t.productId,(e,l)=>{e&&e!==l&&t.autoLoad&&ae()},{immediate:!1}),Be(()=>{document.addEventListener("keydown",nl)}),(e,l)=>{var a;const t=J,s=L,r=d,b=c,T=f,E=W,j=h,ae=D;return Ce(),me("div",{class:ye(["product-gallery",{"edit-mode":e.editMode}])},[fe("div",Ua,[fe("div",{class:ye(["main-image-container",{"edit-mode":e.editMode}])},[i.value?(Ce(),me("div",xa,[he(s,{animated:""},{template:be(()=>[he(t,{variant:"image",style:{width:"100%",height:"400px"}})]),_:1})])):R.value?(Ce(),me("div",za,[fe("img",{src:Z(R.value.image_url),alt:R.value.alt_text||R.value.title||"产品图片",class:ye(["main-image",{"edit-mode":e.editMode}]),onLoad:sl,onError:il,onClick:l[0]||(l[0]=l=>!e.editMode&&oe())},null,42,Ma),e.editMode&&R.value?(Ce(),me("div",Ia,[fe("div",Ba,[he(r,{type:"primary",size:"small",icon:Ve(p),onClick:ge(Le,["stop"])},{default:be(()=>l[14]||(l[14]=[ke(" 更换主图 ",-1)])),_:1,__:[14]},8,["icon"]),R.value.is_primary?_e("",!0):(Ce(),ze(r,{key:0,type:"warning",size:"small",icon:Ve(F),onClick:l[1]||(l[1]=ge(e=>Re(R.value.id),["stop"]))},{default:be(()=>l[15]||(l[15]=[ke(" 设为主图 ",-1)])),_:1,__:[15]},8,["icon"])),he(r,{type:"danger",size:"small",icon:Ve(v),onClick:l[2]||(l[2]=ge(e=>Oe(R.value.id),["stop"])),disabled:x.value},{default:be(()=>l[16]||(l[16]=[ke(" 删除 ",-1)])),_:1,__:[16]},8,["icon","disabled"])])])):!e.editMode&&g.value&&R.value?(Ce(),me("div",Aa,[fe("div",Pa,[R.value.title?(Ce(),me("h4",Da,we(R.value.title),1)):_e("",!0),R.value.description?(Ce(),me("p",Ta,we(R.value.description),1)):_e("",!0),fe("div",Ea,[fe("span",ja,we(ee(R.value.image_type)),1),R.value.is_primary?(Ce(),me("span",Sa,"主图")):_e("",!0)])])])):_e("",!0),!e.editMode&&Array.isArray(o.value)&&o.value.length>1?(Ce(),me("div",Fa,[fe("button",{class:"nav-arrow prev",disabled:0===u.value,onClick:se},[he(b,null,{default:be(()=>[he(Ve(N))]),_:1})],8,Ga),fe("button",{class:"nav-arrow next",disabled:u.value===o.value.length-1,onClick:ie},[he(b,null,{default:be(()=>[he(Ve(K))]),_:1})],8,Wa)])):_e("",!0),Array.isArray(o.value)&&o.value.length>1?(Ce(),me("div",qa,we(u.value+1)+" / "+we(o.value.length),1)):_e("",!0)])):(Ce(),me("div",{key:2,class:ye(["empty-state",{"edit-mode":e.editMode,"drag-over":M.value,uploading:U.value}]),onDragover:l[3]||(l[3]=ge(l=>e.editMode&&Ee,["prevent"])),onDragleave:l[4]||(l[4]=ge(l=>e.editMode&&je,["prevent"])),onDrop:l[5]||(l[5]=ge(l=>e.editMode&&qe,["prevent"])),onClick:l[6]||(l[6]=l=>e.editMode&&Ie)},[U.value?(Ce(),me("div",Ra,[he(b,{class:"uploading-icon"},{default:be(()=>[he(Ve(m))]),_:1}),fe("div",Oa,[he(T,{percentage:z.value,"stroke-width":8,color:"#2563eb"},null,8,["percentage"])]),fe("p",La,we(I.value),1),B.value?(Ce(),me("div",Ja,[fe("p",Na,we(B.value),1)])):_e("",!0)])):(Ce(),me("div",Ka,[he(b,{class:"empty-icon",size:"48"},{default:be(()=>[e.editMode?(Ce(),ze(Ve(_),{key:1})):(Ce(),ze(Ve(y),{key:0}))]),_:1}),fe("div",Xa,[fe("p",Ya,we(e.editMode?"点击或拖拽图片到这里上传":"暂无产品图片"),1),e.editMode?(Ce(),me("p",Qa," 支持 JPG、PNG、WebP 格式，大图片将快速压缩 ")):_e("",!0)])]))],34))],2),fe("div",$a,[he(E,null,{default:be(()=>[e.editMode?(Ce(),me(Ue,{key:1},[he(r,{icon:Ve(_),onClick:Ie},{default:be(()=>l[19]||(l[19]=[ke(" 添加图片 ",-1)])),_:1,__:[19]},8,["icon"]),Array.isArray(o.value)&&o.value.length>0?(Ce(),ze(r,{key:0,icon:Ve(Y),onClick:Je},{default:be(()=>[ke(we(C.value?"完成排序":"排序图片"),1)]),_:1},8,["icon"])):_e("",!0),n.value?(Ce(),ze(r,{key:1,icon:Ve(X),onClick:l[7]||(l[7]=e=>w.value=!0)},{default:be(()=>l[20]||(l[20]=[ke(" 统计信息 ",-1)])),_:1,__:[20]},8,["icon"])):_e("",!0)],64)):(Ce(),me(Ue,{key:0},[R.value?(Ce(),ze(r,{key:0,icon:Ve(G),onClick:oe},{default:be(()=>l[17]||(l[17]=[ke(" 放大查看 ",-1)])),_:1,__:[17]},8,["icon"])):_e("",!0),he(r,{icon:Ve(X),onClick:ne},{default:be(()=>[ke(we(g.value?"隐藏信息":"显示信息"),1)]),_:1},8,["icon"]),e.canEdit?(Ce(),ze(r,{key:1,icon:Ve(p),onClick:re},{default:be(()=>l[18]||(l[18]=[ke(" 管理图片 ",-1)])),_:1,__:[18]},8,["icon"])):_e("",!0)],64))]),_:1})])]),Array.isArray(o.value)&&o.value.length>0?(Ce(),me("div",Ha,[fe("h4",{class:ye(["thumbnails-title",{"edit-mode":e.editMode}])},[ke(we(e.editMode?"管理图片":"所有图片")+" ("+we(Array.isArray(o.value)?o.value.length:0)+") ",1),n.value?(Ce(),ze(j,{key:0,size:"small",type:"info"},{default:be(()=>[ke(we(le(n.value.total_size)),1)]),_:1})):_e("",!0)],2),fe("div",{class:ye(["thumbnails-container",{"sort-mode":C.value,"edit-mode":e.editMode}])},[e.editMode&&!U.value&&Array.isArray(o.value)&&o.value.length>0?(Ce(),me("div",Za,[he(b,null,{default:be(()=>[he(Ve(X))]),_:1}),fe("span",null,we(C.value?"拖拽图片进行排序，完成后点击“完成排序”":"点击图片上的按钮进行编辑操作"),1)])):_e("",!0),fe("div",{class:ye(["thumbnails-scroll",{"edit-mode":e.editMode}])},[e.editMode?(Ce(!0),me(Ue,{key:0},xe(o.value,(a,t)=>(Ce(),me("div",{key:a.id,class:ye(["thumbnail-item",{active:t===u.value,primary:a.is_primary,"edit-mode":!0,"sort-mode":C.value}]),onClick:e=>!C.value&&te(t),draggable:C.value,onDragstart:e=>((e,l)=>{C.value&&(Ne=e,l.dataTransfer&&(l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/html","")))})(t,e),onDragover:l[8]||(l[8]=e=>{return l=e,void(C.value&&(l.preventDefault(),l.dataTransfer&&(l.dataTransfer.dropEffect="move")));var l}),onDrop:e=>Ke(t,e),onDragend:Xe},[fe("div",lt,[C.value?(Ce(),me("div",at,[he(b,null,{default:be(()=>[he(Ve(q))]),_:1})])):_e("",!0),fe("img",{src:Z(a.thumbnail_url||a.image_url),alt:a.title||"图片 ".concat(t+1),class:"thumbnail-image",onError:ol},null,40,tt),e.editMode&&!C.value?(Ce(),me("div",st,[a.is_primary?_e("",!0):(Ce(),ze(r,{key:0,size:"small",type:"primary",icon:Ve(F),onClick:ge(e=>Re(a.id),["stop"]),title:"设为主图",class:"control-btn"},null,8,["icon","onClick"])),he(r,{size:"small",type:"danger",icon:Ve(v),onClick:ge(e=>Oe(a.id),["stop"]),disabled:x.value,title:"删除图片",class:"control-btn"},null,8,["icon","onClick","disabled"])])):_e("",!0),a.is_primary?(Ce(),me("div",it,[he(b,null,{default:be(()=>[he(Ve(F))]),_:1})])):_e("",!0),fe("div",ot,we(ee(a.image_type)),1)]),fe("div",ut,[fe("span",nt,we(a.title||"图片 ".concat(t+1)),1),e.editMode?(Ce(),me("div",rt,[fe("span",dt,we(le(a.file_size||0)),1)])):_e("",!0)])],42,et))),128)):(Ce(!0),me(Ue,{key:1},xe(o.value,(e,l)=>(Ce(),me("div",{key:e.id,class:ye(["thumbnail-item",{active:l===u.value,primary:e.is_primary}]),onClick:e=>te(l)},[fe("div",pt,[fe("img",{src:Z(e.thumbnail_url||e.image_url),alt:e.title||"图片 ".concat(l+1),class:"thumbnail-image",onError:ol},null,40,vt),e.is_primary?(Ce(),me("div",mt,[he(b,null,{default:be(()=>[he(Ve(F))]),_:1})])):_e("",!0),fe("div",ft,we(ee(e.image_type)),1)]),fe("div",_t,[fe("span",gt,we(e.title||"图片 ".concat(l+1)),1)])],10,ct))),128))],2),S.value?(Ce(),me("button",{key:1,class:"scroll-control left",onClick:l[9]||(l[9]=e=>tl("left"))},[he(b,null,{default:be(()=>[he(Ve(N))]),_:1})])):_e("",!0),S.value?(Ce(),me("button",{key:2,class:"scroll-control right",onClick:l[10]||(l[10]=e=>tl("right"))},[he(b,null,{default:be(()=>[he(Ve(K))]),_:1})])):_e("",!0)],2)])):_e("",!0),he(ae,{modelValue:k.value,"onUpdate:modelValue":l[11]||(l[11]=e=>k.value=e),title:(null==(a=R.value)?void 0:a.title)||"图片预览",width:"90%","align-center":"",class:"preview-dialog","before-close":ue},{default:be(()=>[fe("div",yt,[fe("div",ht,[R.value?(Ce(),me("img",{key:0,src:Z(R.value.image_url),alt:R.value.alt_text||R.value.title,class:"preview-image",style:De(O.value),onWheel:He,onMousedown:Ze,onMousemove:el,onMouseup:ll,onMouseleave:ll},null,44,bt)):_e("",!0)]),fe("div",kt,[he(E,null,{default:be(()=>[he(r,{icon:Ve(G),onClick:Ye},{default:be(()=>l[21]||(l[21]=[ke("放大",-1)])),_:1,__:[21]},8,["icon"]),he(r,{icon:Ve(Q),onClick:Qe},{default:be(()=>l[22]||(l[22]=[ke("缩小",-1)])),_:1,__:[22]},8,["icon"]),he(r,{icon:Ve($),onClick:$e},{default:be(()=>l[23]||(l[23]=[ke("重置",-1)])),_:1,__:[23]},8,["icon"]),he(r,{icon:Ve(H),onClick:al},{default:be(()=>l[24]||(l[24]=[ke("下载",-1)])),_:1,__:[24]},8,["icon"])]),_:1}),fe("div",Vt,we(Math.round(100*P.value))+"% ",1)]),Array.isArray(o.value)&&o.value.length>1?(Ce(),me("div",wt,[he(r,{disabled:0===u.value,onClick:se},{default:be(()=>[he(b,null,{default:be(()=>[he(Ve(N))]),_:1}),l[25]||(l[25]=ke(" 上一张 ",-1))]),_:1,__:[25]},8,["disabled"]),fe("span",Ct,we(u.value+1)+" / "+we(Array.isArray(o.value)?o.value.length:0),1),he(r,{disabled:!Array.isArray(o.value)||u.value===o.value.length-1,onClick:ie},{default:be(()=>[l[26]||(l[26]=ke(" 下一张 ",-1)),he(b,null,{default:be(()=>[he(Ve(K))]),_:1})]),_:1,__:[26]},8,["disabled"])])):_e("",!0)])]),_:1},8,["modelValue","title"]),V.value?(Ce(),ze(Ca,{key:1,visible:V.value,"onUpdate:visible":l[12]||(l[12]=e=>V.value=e),"product-id":e.productId,images:o.value,onRefresh:ul},null,8,["visible","product-id","images"])):_e("",!0),he(ae,{modelValue:w.value,"onUpdate:modelValue":l[13]||(l[13]=e=>w.value=e),title:"图片集统计",width:"500px","align-center":""},{default:be(()=>[n.value?(Ce(),me("div",Ut,[fe("div",xt,[l[27]||(l[27]=fe("span",{class:"stats-label"},"图片总数：",-1)),fe("span",zt,we(n.value.total_images)+" 张",1)]),fe("div",Mt,[l[28]||(l[28]=fe("span",{class:"stats-label"},"总大小：",-1)),fe("span",It,we(le(n.value.total_size)),1)]),fe("div",Bt,[l[29]||(l[29]=fe("span",{class:"stats-label"},"主图设置：",-1)),fe("span",At,we(n.value.has_primary?"已设置":"未设置"),1)]),fe("div",Pt,[l[30]||(l[30]=fe("span",{class:"stats-label"},"图片类型：",-1)),fe("div",Dt,[(Ce(!0),me(Ue,null,xe(n.value.by_type,(e,l)=>(Ce(),me("div",{key:l,class:"type-item"},[he(j,{size:"small"},{default:be(()=>[ke(we(ee(l)),1)]),_:2},1024),fe("span",null,we(e)+" 张",1)]))),128))])])])):_e("",!0)]),_:1},8,["modelValue"]),fe("input",{ref_key:"fileInput",ref:A,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp",multiple:"",onChange:Ae,style:{display:"none"}},null,544)],2)}}}),[["__scopeId","data-v-5ca2bff5"]]),Et={class:"product-form"},jt={class:"image-upload-mode"},St={key:0},Ft={key:1},Gt={class:"section-header"},Wt={key:0,class:"empty-state"},qt={class:"section-header"},Rt={key:0,class:"empty-state"},Ot={key:0},Lt={key:1},Jt={class:"subsection"},Nt={class:"subsection-header"},Kt={key:0,class:"empty-state"},Xt={class:"item-info"},Yt={class:"section-header"},Qt={key:0,class:"empty-state"},$t={class:"section-header"},Ht={class:"section-actions"},Zt={key:0,class:"empty-state"},es={key:1,class:"accessory-section"},ls={key:2,class:"accessory-section"},as={class:"section-header"},ts={key:0,class:"empty-state"},ss={class:"certificate-actions"},is={class:"subsection"},os={class:"warranty-terms"},us={class:"terms-header"},ns={class:"subsection"},rs={class:"subsection"},ds={class:"subsection-header"},cs={class:"form-actions"},ps=Re(de({__name:"ProductForm",props:{product:{default:null},categories:{default:()=>[]},loading:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(e,{expose:l,emit:a}){const t=e,s=a,i=ce(),o=ce(null),p=ce(null),m=ce("single"),f=ce(null),g=pe(()=>!!t.product),y=Ee({name:"",code:"",description:"",category:"",base_price:0,image_url:"",specifications:{},configuration_schema:{},is_active:!0,is_configurable:!1,detailed_description:"",application_scenarios:[],features:[],accessories:[],certificates:[],support_info:{warranty:{period:"",coverage:"",terms:[]},contact_info:{sales_phone:"",sales_email:"",support_phone:"",support_email:"",service_wechat:""},service_promises:[]}}),b=ce(null),M=ce([]),I=ce([]),B={name:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:1,max:200,message:"长度应为1到200个字符",trigger:"blur"}],code:[{required:!0,message:"请输入产品代码",trigger:"blur"},{min:1,max:50,message:"长度应为1到50个字符",trigger:"blur"}],category:[{required:!0,message:"请选择或输入分类",trigger:"blur"}],base_price:[{required:!0,message:"请输入基础价格",trigger:"blur"},{type:"number",min:0,message:"价格不能为负数",trigger:"blur"}],detailed_description:[{max:2e3,message:"详细介绍不能超过2000个字符",trigger:"blur"}]};ve(()=>t.product,e=>r(this,null,function*(){if(e){if(l=e,Object.assign(y,{name:l.name,code:l.code,description:l.description||"",category:l.category,base_price:l.base_price,image_url:l.image_url||"",specifications:l.specifications||{},configuration_schema:l.configuration_schema||{},is_active:l.is_active,is_configurable:l.is_configurable,detailed_description:l.detailed_description||"",application_scenarios:l.application_scenarios||[],features:l.features||[],accessories:l.accessories||[],certificates:l.certificates||[],support_info:l.support_info||{warranty:{period:"",coverage:"",terms:[]},contact_info:{},service_promises:[]}}),b.value=l.id||null,M.value=Object.entries(y.specifications).map(([e,l])=>({id:Math.random().toString(36).substr(2,9),name:e,value:l.value||l,unit:l.unit||"",description:l.description||""})),I.value=Object.entries(y.configuration_schema).map(([e,l])=>({id:Math.random().toString(36).substr(2,9),name:e,type:l.type||"text",label:l.label||e,description:l.description||"",required:l.required||!1,default:l.default,options:l.options||[],validation:l.validation||{}})),e.id&&g.value)try{m.value="single"}catch(a){m.value="single"}}else Object.assign(y,{name:"",code:"",description:"",category:"",base_price:0,image_url:"",specifications:{},configuration_schema:{},is_active:!0,is_configurable:!1,detailed_description:"",application_scenarios:[],features:[],accessories:[],certificates:[],support_info:{warranty:{period:"",coverage:"",terms:[]},contact_info:{sales_phone:"",sales_email:"",support_phone:"",support_email:"",service_wechat:""},service_promises:[]}}),M.value=[],I.value=[],b.value=null,m.value="single";var l}),{immediate:!0});const A=()=>{M.value.push({id:Math.random().toString(36).substr(2,9),name:"",value:"",unit:"",description:""})},P=()=>{I.value.push({id:Math.random().toString(36).substr(2,9),name:"",type:"text",label:"",description:"",required:!1,default:"",options:[],validation:{}})},D=()=>{y.application_scenarios.push({id:Math.random().toString(36).substr(2,9),name:"",icon:"",sort_order:y.application_scenarios.length})},T=()=>{y.features.push({id:Math.random().toString(36).substr(2,9),icon:"",title:"",description:"",sort_order:y.features.length})},j=(e="standard")=>{y.accessories.push({id:Math.random().toString(36).substr(2,9),name:"",description:"",type:e,sort_order:y.accessories.length})},F=e=>{y.accessories.splice(e,1)},G=()=>{y.certificates.push({id:Math.random().toString(36).substr(2,9),name:"",description:"",certificate_number:"",type:"quality",sort_order:y.certificates.length})},W=()=>{y.support_info.warranty.terms.push("")},q=()=>{y.support_info.service_promises.push("")},L=()=>r(this,null,function*(){if(i.value)try{yield i.value.validate();const e=(()=>{const e=[];return e.push(...(()=>{const e=[];return y.features.forEach((l,a)=>{l.title.trim()||e.push("第".concat(a+1,"个产品特点的标题不能为空")),l.description.trim()||e.push("第".concat(a+1,"个产品特点的描述不能为空"))}),e})()),e.push(...(()=>{const e=[];return y.accessories.forEach((l,a)=>{l.name.trim()||e.push("第".concat(a+1,"个配件的名称不能为空")),l.description.trim()||e.push("第".concat(a+1,"个配件的描述不能为空"))}),e})()),e.push(...(()=>{const e=[];return y.certificates.forEach((l,a)=>{l.name.trim()||e.push("第".concat(a+1,"个证书的名称不能为空")),l.description.trim()||e.push("第".concat(a+1,"个证书的描述不能为空"))}),e})()),e.push(...(()=>{const e=[];y.support_info.warranty.terms.forEach((l,a)=>{l.trim()||e.push("第".concat(a+1,"个质保条款不能为空"))}),y.support_info.service_promises.forEach((l,a)=>{l.trim()||e.push("第".concat(a+1,"个服务承诺不能为空"))});const l=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return y.support_info.contact_info.sales_email&&!l.test(y.support_info.contact_info.sales_email)&&e.push("销售邮箱格式不正确"),y.support_info.contact_info.support_email&&!l.test(y.support_info.contact_info.support_email)&&e.push("技术支持邮箱格式不正确"),e})()),e})();if(e.length>0)return void Fe.error({message:"表单验证失败：\n".concat(e.join("\n")),duration:6e3,showClose:!0});const l=(()=>{const e={};M.value.forEach(l=>{l.name&&(e[l.name]={value:l.value,unit:l.unit,description:l.description})});const l={};return I.value.forEach(e=>{e.name&&(l[e.name]={type:e.type,label:e.label,description:e.description,required:e.required,default:e.default,options:e.options,validation:e.validation})}),n(u({},y),{specifications:e,configuration_schema:l})})();!g.value&&f.value?s("submit",l,f.value):s("submit",l)}catch(e){Fe.error("请修复表单错误")}});l({uploadImageAfterCreate:e=>r(this,null,function*(){try{b.value=parseInt(e),"single"===m.value&&o.value?f.value&&Fe.info("正在上传产品图片..."):"gallery"===m.value&&p.value&&(yield p.value.loadGallery(),Fe.success("产品创建成功，现在可以上传图集")),Fe.success("产品创建成功")}catch(l){Fe.warning("产品创建成功，但图片处理可能有问题")}})});const J=(e,l)=>{y.image_url=e,Fe.success("产品图片上传成功")},N=e=>{Fe.error("图片上传失败: ".concat(e))},K=()=>{y.image_url="",Fe.success("产品图片删除成功")},X=e=>{Fe.error("图片删除失败: ".concat(e))},Y=()=>{Fe.success("图集已刷新")},Q=e=>{e&&e!==y.image_url&&(y.image_url=e,Fe.info("主图已更新"))},$=e=>{const l=e.find(e=>e.is_primary);l&&l.image_url!==y.image_url&&(y.image_url=l.image_url)};return(e,l)=>{const a=O,t=C,s=w,u=V,n=x,r=U,f=Z,H=z,ae=E,te=le,se=ee,ie=c,oe=d,ue=R,ne=S,re=h,de=k;return Ce(),me("div",Et,[he(de,{ref_key:"productFormRef",ref:i,model:y,rules:B,"label-width":"140px",onSubmit:ge(L,["prevent"])},{default:be(()=>[he(ae,{class:"form-section"},{header:be(()=>l[19]||(l[19]=[fe("span",{class:"section-title"},"基本信息",-1)])),default:be(()=>[he(u,{gutter:20},{default:be(()=>[he(s,{span:12},{default:be(()=>[he(t,{label:"产品名称",prop:"name"},{default:be(()=>[he(a,{modelValue:y.name,"onUpdate:modelValue":l[0]||(l[0]=e=>y.name=e),placeholder:"请输入产品名称",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1}),he(s,{span:12},{default:be(()=>[he(t,{label:"产品代码",prop:"code"},{default:be(()=>[he(a,{modelValue:y.code,"onUpdate:modelValue":l[1]||(l[1]=e=>y.code=e),placeholder:"请输入唯一产品代码",maxlength:"50","show-word-limit":"",disabled:g.value},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),he(u,{gutter:20},{default:be(()=>[he(s,{span:12},{default:be(()=>[he(t,{label:"分类",prop:"category"},{default:be(()=>[he(r,{modelValue:y.category,"onUpdate:modelValue":l[2]||(l[2]=e=>y.category=e),placeholder:"选择或输入分类",filterable:"","allow-create":"","default-first-option":"",style:{width:"100%"}},{default:be(()=>[(Ce(!0),me(Ue,null,xe(e.categories,e=>(Ce(),ze(n,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),he(s,{span:12},{default:be(()=>[he(t,{label:"基础价格",prop:"base_price"},{default:be(()=>[he(f,{modelValue:y.base_price,"onUpdate:modelValue":l[3]||(l[3]=e=>y.base_price=e),precision:2,min:0,max:999999.99,style:{width:"100%"},"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),he(t,{label:"产品描述"},{default:be(()=>[he(a,{modelValue:y.description,"onUpdate:modelValue":l[4]||(l[4]=e=>y.description=e),type:"textarea",rows:3,placeholder:"请输入产品描述",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),he(u,{gutter:20},{default:be(()=>[he(s,{span:12},{default:be(()=>[he(t,{label:"状态"},{default:be(()=>[he(H,{modelValue:y.is_active,"onUpdate:modelValue":l[5]||(l[5]=e=>y.is_active=e),"active-text":"活跃","inactive-text":"非活跃"},null,8,["modelValue"])]),_:1})]),_:1}),he(s,{span:12},{default:be(()=>[he(t,{label:"可配置"},{default:be(()=>[he(H,{modelValue:y.is_configurable,"onUpdate:modelValue":l[6]||(l[6]=e=>y.is_configurable=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),he(ae,{class:"form-section"},{header:be(()=>l[20]||(l[20]=[fe("span",{class:"section-title"},"产品图片",-1)])),default:be(()=>[fe("div",jt,[he(se,{modelValue:m.value,"onUpdate:modelValue":l[7]||(l[7]=e=>m.value=e),class:"mode-selector"},{default:be(()=>[he(te,{value:"single"},{default:be(()=>l[21]||(l[21]=[ke("单图上传",-1)])),_:1,__:[21]}),he(te,{value:"gallery"},{default:be(()=>l[22]||(l[22]=[ke("图集管理",-1)])),_:1,__:[22]})]),_:1},8,["modelValue"])]),"single"===m.value?(Ce(),me("div",St,[he(ml,{ref_key:"fastImageUploadRef",ref:o,"product-id":b.value,"initial-image-url":y.image_url,disabled:e.loading,"compression-preset":"standard",onUploadSuccess:J,onUploadError:N,onDeleteSuccess:K,onDeleteError:X},null,8,["product-id","initial-image-url","disabled"])])):(Ce(),me("div",Ft,[he(Tt,{ref_key:"productGalleryRef",ref:p,"product-id":b.value,"edit-mode":!0,"can-edit":!0,"auto-load":"",onRefresh:Y,onImageChange:Q,onImagesUpdate:$},null,8,["product-id"])]))]),_:1}),he(ae,{class:"form-section"},{header:be(()=>[fe("div",Gt,[l[24]||(l[24]=fe("span",{class:"section-title"},"技术规格",-1)),he(oe,{type:"primary",size:"small",onClick:A},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[23]||(l[23]=ke(" 添加规格 ",-1))]),_:1,__:[23]})])]),default:be(()=>[0===M.value.length?(Ce(),me("div",Wt,[he(ue,{description:"尚未添加规格"})])):_e("",!0),(Ce(!0),me(Ue,null,xe(M.value,(e,l)=>(Ce(),me("div",{key:e.id,class:"specification-item"},[he(u,{gutter:16,align:"middle"},{default:be(()=>[he(s,{span:6},{default:be(()=>[he(a,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,placeholder:"规格名称",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:6},{default:be(()=>[he(a,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:"值",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:4},{default:be(()=>[he(a,{modelValue:e.unit,"onUpdate:modelValue":l=>e.unit=l,placeholder:"单位（可选）",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:6},{default:be(()=>[he(a,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,placeholder:"描述（可选）",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:e=>(e=>{M.value.splice(e,1)})(l)},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),y.is_configurable?(Ce(),ze(ae,{key:0,class:"form-section"},{header:be(()=>[fe("div",qt,[l[26]||(l[26]=fe("span",{class:"section-title"},"配置架构",-1)),he(oe,{type:"primary",size:"small",onClick:P},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[25]||(l[25]=ke(" 添加字段 ",-1))]),_:1,__:[25]})])]),default:be(()=>[0===I.value.length?(Ce(),me("div",Rt,[he(ue,{description:"尚未添加配置字段"})])):_e("",!0),(Ce(!0),me(Ue,null,xe(I.value,(e,i)=>(Ce(),me("div",{key:e.id,class:"config-field-item"},[he(ae,{size:"small"},{default:be(()=>[he(u,{gutter:16},{default:be(()=>[he(s,{span:8},{default:be(()=>[he(t,{label:"字段名称",size:"small"},{default:be(()=>[he(a,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,placeholder:"字段名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{label:"标签",size:"small"},{default:be(()=>[he(a,{modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,placeholder:"显示标签"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{label:"类型",size:"small"},{default:be(()=>[he(r,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,style:{width:"100%"}},{default:be(()=>[he(n,{label:"文本",value:"text"}),he(n,{label:"数字",value:"number"}),he(n,{label:"布尔",value:"boolean"}),he(n,{label:"选择",value:"select"}),he(n,{label:"多选",value:"multiselect"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),he(s,{span:8},{default:be(()=>[he(t,{label:"描述",size:"small"},{default:be(()=>[he(a,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,type:"textarea",rows:2,placeholder:"字段描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{label:"默认值",size:"small"},{default:be(()=>[he(a,{modelValue:e.default,"onUpdate:modelValue":l=>e.default=l,placeholder:"默认值"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{size:"small"},{default:be(()=>[he(ne,{modelValue:e.required,"onUpdate:modelValue":l=>e.required=l},{default:be(()=>l[27]||(l[27]=[ke("必填",-1)])),_:2,__:[27]},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),he(s,{span:6},{default:be(()=>[["select","multiselect"].includes(e.type)?(Ce(),me("div",Ot,[he(t,{label:"选项",size:"small"},{default:be(()=>[(Ce(!0),me(Ue,null,xe(e.options,(e,l)=>(Ce(),me("div",{key:l,class:"option-item"},[he(u,{gutter:8,align:"middle"},{default:be(()=>[he(s,{span:10},{default:be(()=>[he(a,{modelValue:e.label,"onUpdate:modelValue":l=>e.label=l,placeholder:"标签",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:10},{default:be(()=>[he(a,{modelValue:e.value,"onUpdate:modelValue":l=>e.value=l,placeholder:"值",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:4},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:e=>{return a=i,t=l,void I.value[a].options.splice(t,1);var a,t}},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),he(oe,{link:"",size:"small",onClick:e=>{return l=i,I.value[l].options||(I.value[l].options=[]),void I.value[l].options.push({label:"",value:""});var l}},{default:be(()=>l[28]||(l[28]=[ke(" 添加选项 ",-1)])),_:2,__:[28]},1032,["onClick"])]),_:2},1024)])):_e("",!0),"number"===e.type?(Ce(),me("div",Lt,[he(t,{label:"最小值",size:"small"},{default:be(()=>[he(f,{modelValue:e.validation.min,"onUpdate:modelValue":l=>e.validation.min=l,size:"small",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{label:"最大值",size:"small"},{default:be(()=>[he(f,{modelValue:e.validation.max,"onUpdate:modelValue":l=>e.validation.max=l,size:"small",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])):_e("",!0)]),_:2},1024),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:e=>(e=>{I.value.splice(e,1)})(i)},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1}),l[29]||(l[29]=ke(" 删除 ",-1))]),_:2,__:[29]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):_e("",!0),he(ae,{class:"form-section"},{header:be(()=>l[30]||(l[30]=[fe("span",{class:"section-title"},"产品详情",-1)])),default:be(()=>[he(t,{label:"详细介绍"},{default:be(()=>[he(a,{modelValue:y.detailed_description,"onUpdate:modelValue":l[8]||(l[8]=e=>y.detailed_description=e),type:"textarea",rows:6,placeholder:"请输入产品详细介绍，支持应用场景、工作原理等详细描述",maxlength:"2000","show-word-limit":""},null,8,["modelValue"])]),_:1}),fe("div",Jt,[fe("div",Nt,[l[32]||(l[32]=fe("span",{class:"subsection-title"},"应用场景",-1)),he(oe,{type:"primary",size:"small",onClick:D},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[31]||(l[31]=ke(" 添加场景 ",-1))]),_:1,__:[31]})]),0===y.application_scenarios.length?(Ce(),me("div",Kt,[he(ue,{description:"尚未添加应用场景"})])):_e("",!0),(Ce(!0),me(Ue,null,xe(y.application_scenarios,(e,l)=>(Ce(),me("div",{key:e.id,class:"list-item"},[he(u,{gutter:16,align:"middle"},{default:be(()=>[he(s,{span:6},{default:be(()=>[he(a,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,placeholder:"场景名称",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:6},{default:be(()=>[he(a,{modelValue:e.icon,"onUpdate:modelValue":l=>e.icon=l,placeholder:"图标类名（可选）",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:10},{default:be(()=>[fe("span",Xt,"排序: "+we(l+1),1)]),_:2},1024),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:e=>(e=>{y.application_scenarios.splice(e,1)})(l)},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1}),he(ae,{class:"form-section"},{header:be(()=>[fe("div",Yt,[l[34]||(l[34]=fe("span",{class:"section-title"},"产品特点",-1)),he(oe,{type:"primary",size:"small",onClick:T},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[33]||(l[33]=ke(" 添加特点 ",-1))]),_:1,__:[33]})])]),default:be(()=>[0===y.features.length?(Ce(),me("div",Qt,[he(ue,{description:"尚未添加产品特点"})])):_e("",!0),(Ce(!0),me(Ue,null,xe(y.features,(e,i)=>(Ce(),me("div",{key:e.id,class:"feature-item"},[he(ae,{size:"small",class:"feature-card"},{default:be(()=>[he(u,{gutter:16},{default:be(()=>[he(s,{span:12},{default:be(()=>[he(t,{label:"特点标题",size:"small"},{default:be(()=>[he(a,{modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,placeholder:"特点标题"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{label:"图标类名",size:"small"},{default:be(()=>[he(a,{modelValue:e.icon,"onUpdate:modelValue":l=>e.icon=l,placeholder:"图标类名（可选）"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),he(s,{span:10},{default:be(()=>[he(t,{label:"特点描述",size:"small"},{default:be(()=>[he(a,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,type:"textarea",rows:3,placeholder:"详细描述该产品特点"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:e=>(e=>{y.features.splice(e,1)})(i)},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1}),l[35]||(l[35]=ke(" 删除 ",-1))]),_:2,__:[35]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),he(ae,{class:"form-section"},{header:be(()=>[fe("div",$t,[l[38]||(l[38]=fe("span",{class:"section-title"},"附件配件",-1)),fe("div",Ht,[he(oe,{type:"primary",size:"small",onClick:l[9]||(l[9]=e=>j("standard"))},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[36]||(l[36]=ke(" 标准配置 ",-1))]),_:1,__:[36]}),he(oe,{type:"success",size:"small",onClick:l[10]||(l[10]=e=>j("optional"))},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[37]||(l[37]=ke(" 可选配件 ",-1))]),_:1,__:[37]})])])]),default:be(()=>[0===y.accessories.length?(Ce(),me("div",Zt,[he(ue,{description:"尚未添加附件配件"})])):_e("",!0),y.accessories.some(e=>"standard"===e.type)?(Ce(),me("div",es,[l[40]||(l[40]=fe("h4",{class:"accessory-section-title"},"标准配置",-1)),(Ce(!0),me(Ue,null,xe(y.accessories.filter(e=>"standard"===e.type),(e,t)=>(Ce(),me("div",{key:e.id,class:"accessory-item"},[he(u,{gutter:16,align:"middle"},{default:be(()=>[he(s,{span:6},{default:be(()=>[he(a,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,placeholder:"配件名称",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:14},{default:be(()=>[he(a,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,placeholder:"配件描述",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:2},{default:be(()=>[he(re,{type:"primary",size:"small"},{default:be(()=>l[39]||(l[39]=[ke("标准",-1)])),_:1,__:[39]})]),_:1}),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:l=>F(y.accessories.findIndex(l=>l.id===e.id))},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])):_e("",!0),y.accessories.some(e=>"optional"===e.type)?(Ce(),me("div",ls,[l[42]||(l[42]=fe("h4",{class:"accessory-section-title"},"可选配件",-1)),(Ce(!0),me(Ue,null,xe(y.accessories.filter(e=>"optional"===e.type),(e,t)=>(Ce(),me("div",{key:e.id,class:"accessory-item"},[he(u,{gutter:16,align:"middle"},{default:be(()=>[he(s,{span:6},{default:be(()=>[he(a,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,placeholder:"配件名称",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:14},{default:be(()=>[he(a,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,placeholder:"配件描述",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:2},{default:be(()=>[he(re,{type:"success",size:"small"},{default:be(()=>l[41]||(l[41]=[ke("可选",-1)])),_:1,__:[41]})]),_:1}),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:l=>F(y.accessories.findIndex(l=>l.id===e.id))},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])):_e("",!0)]),_:1}),he(ae,{class:"form-section"},{header:be(()=>[fe("div",as,[l[44]||(l[44]=fe("span",{class:"section-title"},"检定证书",-1)),he(oe,{type:"primary",size:"small",onClick:G},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[43]||(l[43]=ke(" 添加证书 ",-1))]),_:1,__:[43]})])]),default:be(()=>[0===y.certificates.length?(Ce(),me("div",ts,[he(ue,{description:"尚未添加证书信息"})])):_e("",!0),(Ce(!0),me(Ue,null,xe(y.certificates,(e,i)=>(Ce(),me("div",{key:e.id,class:"certificate-item"},[he(ae,{size:"small"},{default:be(()=>[he(u,{gutter:16},{default:be(()=>[he(s,{span:8},{default:be(()=>[he(t,{label:"证书名称",size:"small"},{default:be(()=>[he(a,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,placeholder:"证书名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{label:"证书类型",size:"small"},{default:be(()=>[he(r,{modelValue:e.type,"onUpdate:modelValue":l=>e.type=l,placeholder:"选择类型",style:{width:"100%"}},{default:be(()=>[he(n,{label:"质量认证",value:"quality"}),he(n,{label:"安全认证",value:"safety"}),he(n,{label:"合规认证",value:"compliance"}),he(n,{label:"计量检定",value:"metrology"}),he(n,{label:"其他",value:"other"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),he(s,{span:8},{default:be(()=>[he(t,{label:"证书编号",size:"small"},{default:be(()=>[he(a,{modelValue:e.certificate_number,"onUpdate:modelValue":l=>e.certificate_number=l,placeholder:"证书编号"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(t,{label:"证书描述",size:"small"},{default:be(()=>[he(a,{modelValue:e.description,"onUpdate:modelValue":l=>e.description=l,type:"textarea",rows:2,placeholder:"证书描述"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),he(s,{span:6},{default:be(()=>[fe("div",ss,[he(oe,{type:"danger",size:"small",onClick:e=>(e=>{y.certificates.splice(e,1)})(i)},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1}),l[45]||(l[45]=ke(" 删除证书 ",-1))]),_:2,__:[45]},1032,["onClick"])])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),he(ae,{class:"form-section"},{header:be(()=>l[46]||(l[46]=[fe("span",{class:"section-title"},"售后保障",-1)])),default:be(()=>[fe("div",is,[l[49]||(l[49]=fe("h4",{class:"subsection-title"},"质保信息",-1)),he(u,{gutter:20},{default:be(()=>[he(s,{span:8},{default:be(()=>[he(t,{label:"质保期限"},{default:be(()=>[he(a,{modelValue:y.support_info.warranty.period,"onUpdate:modelValue":l[11]||(l[11]=e=>y.support_info.warranty.period=e),placeholder:"例：3年"},null,8,["modelValue"])]),_:1})]),_:1}),he(s,{span:16},{default:be(()=>[he(t,{label:"质保内容"},{default:be(()=>[he(a,{modelValue:y.support_info.warranty.coverage,"onUpdate:modelValue":l[12]||(l[12]=e=>y.support_info.warranty.coverage=e),placeholder:"例：产品质保期3年，终身维护服务"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),fe("div",os,[fe("div",us,[l[48]||(l[48]=fe("span",{class:"terms-title"},"质保条款",-1)),he(oe,{link:"",size:"small",onClick:W},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[47]||(l[47]=ke(" 添加条款 ",-1))]),_:1,__:[47]})]),(Ce(!0),me(Ue,null,xe(y.support_info.warranty.terms,(e,l)=>(Ce(),me("div",{key:l,class:"term-item"},[he(u,{gutter:8,align:"middle"},{default:be(()=>[he(s,{span:22},{default:be(()=>[he(a,{modelValue:y.support_info.warranty.terms[l],"onUpdate:modelValue":e=>y.support_info.warranty.terms[l]=e,placeholder:"质保条款内容",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:e=>(e=>{y.support_info.warranty.terms.splice(e,1)})(l)},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),fe("div",ns,[l[50]||(l[50]=fe("h4",{class:"subsection-title"},"联系方式",-1)),he(u,{gutter:20},{default:be(()=>[he(s,{span:12},{default:be(()=>[he(t,{label:"销售热线"},{default:be(()=>[he(a,{modelValue:y.support_info.contact_info.sales_phone,"onUpdate:modelValue":l[13]||(l[13]=e=>y.support_info.contact_info.sales_phone=e),placeholder:"销售热线电话"},null,8,["modelValue"])]),_:1})]),_:1}),he(s,{span:12},{default:be(()=>[he(t,{label:"销售邮箱"},{default:be(()=>[he(a,{modelValue:y.support_info.contact_info.sales_email,"onUpdate:modelValue":l[14]||(l[14]=e=>y.support_info.contact_info.sales_email=e),placeholder:"sales@company.com"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),he(u,{gutter:20},{default:be(()=>[he(s,{span:8},{default:be(()=>[he(t,{label:"技术支持"},{default:be(()=>[he(a,{modelValue:y.support_info.contact_info.support_phone,"onUpdate:modelValue":l[15]||(l[15]=e=>y.support_info.contact_info.support_phone=e),placeholder:"技术支持电话"},null,8,["modelValue"])]),_:1})]),_:1}),he(s,{span:8},{default:be(()=>[he(t,{label:"技术邮箱"},{default:be(()=>[he(a,{modelValue:y.support_info.contact_info.support_email,"onUpdate:modelValue":l[16]||(l[16]=e=>y.support_info.contact_info.support_email=e),placeholder:"tech@company.com"},null,8,["modelValue"])]),_:1})]),_:1}),he(s,{span:8},{default:be(()=>[he(t,{label:"服务微信"},{default:be(()=>[he(a,{modelValue:y.support_info.contact_info.service_wechat,"onUpdate:modelValue":l[17]||(l[17]=e=>y.support_info.contact_info.service_wechat=e),placeholder:"服务微信号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),fe("div",rs,[fe("div",ds,[l[52]||(l[52]=fe("span",{class:"subsection-title"},"服务承诺",-1)),he(oe,{link:"",size:"small",onClick:q},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(_))]),_:1}),l[51]||(l[51]=ke(" 添加承诺 ",-1))]),_:1,__:[51]})]),(Ce(!0),me(Ue,null,xe(y.support_info.service_promises,(e,l)=>(Ce(),me("div",{key:l,class:"promise-item"},[he(u,{gutter:8,align:"middle"},{default:be(()=>[he(s,{span:22},{default:be(()=>[he(a,{modelValue:y.support_info.service_promises[l],"onUpdate:modelValue":e=>y.support_info.service_promises[l]=e,placeholder:"服务承诺内容",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),he(s,{span:2},{default:be(()=>[he(oe,{type:"danger",size:"small",onClick:e=>(e=>{y.support_info.service_promises.splice(e,1)})(l)},{default:be(()=>[he(ie,null,{default:be(()=>[he(Ve(v))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])]),_:1}),fe("div",cs,[he(oe,{onClick:l[18]||(l[18]=l=>e.$emit("cancel"))},{default:be(()=>l[53]||(l[53]=[ke("取消",-1)])),_:1,__:[53]}),he(oe,{type:"primary",onClick:L,loading:e.loading},{default:be(()=>[ke(we(g.value?"更新产品":"创建产品"),1)]),_:1},8,["loading"])])]),_:1},8,["model"])])}}}),[["__scopeId","data-v-d715b7c4"]]),vs={class:"create-product"},ms={class:"page-header"},fs={class:"header-content"},_s={class:"page-title"},gs={class:"card-title"},ys={class:"mode-options"},hs={class:"mode-option active"},bs={class:"mode-icon"},ks={class:"mode-status"},Vs={class:"mode-icon"},ws={class:"mode-status"},Cs={class:"card-title"},Us={class:"card-title"},xs=de({__name:"CreateProduct",setup(e){const l=je(),a=ce(!1),t=ce([]),s=ce(["basic"]),i=ce();Be(()=>r(this,null,function*(){yield o()}));const o=()=>r(this,null,function*(){try{const e=yield qe.getCategories();t.value=e.categories||[]}catch(e){Fe.error("加载产品分类失败")}}),u=(e,t)=>r(this,null,function*(){var s,o,u;a.value=!0;try{const a=yield qe.createProduct(e);a&&a.product&&a.product.id?(Fe.success("产品创建成功！"),t&&(null==(s=i.value)?void 0:s.uploadImageAfterCreate)&&(yield i.value.uploadImageAfterCreate(a.product.id.toString())),setTimeout(()=>{l.push({name:"ProductDetail",params:{id:a.product.id}})},1500)):Fe.error("产品创建失败：服务器响应异常")}catch(n){let e="产品创建失败";(null==(u=null==(o=n.response)?void 0:o.data)?void 0:u.error)?e=n.response.data.error:n.message&&(e=n.message),Fe.error(e)}finally{a.value=!1}}),n=()=>{b.confirm("确定要离开吗？未保存的数据将会丢失。","确认离开",{confirmButtonText:"确定离开",cancelButtonText:"继续编辑",type:"warning"}).then(()=>{l.push({name:"Products"})}).catch(()=>{})},v=()=>{b.confirm("切换到AI智能创建模式？当前填写的数据将会丢失。","切换创建模式",{confirmButtonText:"切换到AI模式",cancelButtonText:"继续手动创建",type:"info"}).then(()=>{l.push({name:"CreateProductAI"})}).catch(()=>{})},m=()=>{b.confirm("确定要重置表单吗？所有填写的数据将会清空。","重置表单",{confirmButtonText:"确定重置",cancelButtonText:"取消",type:"warning"}).then(()=>{i.value&&location.reload(),Fe.success("表单已重置")}).catch(()=>{})};return document.title="创建产品 - CPQ系统",(e,l)=>{const o=te,r=ae,f=c,g=h,y=d,b=E,k=ue,V=P,w=A;return Ce(),me("div",vs,[fe("div",ms,[he(r,{separator:"/"},{default:be(()=>[he(o,{to:{name:"Products"}},{default:be(()=>l[1]||(l[1]=[ke("产品管理",-1)])),_:1,__:[1]}),he(o,null,{default:be(()=>l[2]||(l[2]=[ke("创建产品",-1)])),_:1,__:[2]})]),_:1}),fe("div",fs,[fe("h1",_s,[he(f,null,{default:be(()=>[he(Ve(_))]),_:1}),l[3]||(l[3]=ke(" 创建产品 ",-1))]),l[4]||(l[4]=fe("p",{class:"page-description"}," 手动录入产品详细信息，支持完整的产品信息管理 ",-1))])]),he(b,{class:"mode-selection-card"},{header:be(()=>[fe("span",gs,[he(f,null,{default:be(()=>[he(Ve(oe))]),_:1}),l[5]||(l[5]=ke(" 创建模式选择 ",-1))])]),default:be(()=>[fe("div",ys,[fe("div",hs,[fe("div",bs,[he(f,null,{default:be(()=>[he(Ve(p))]),_:1})]),l[7]||(l[7]=fe("div",{class:"mode-info"},[fe("h3",null,"手动创建"),fe("p",null,"逐步填写产品信息，适合精确控制产品详情")],-1)),fe("div",ks,[he(g,{type:"primary"},{default:be(()=>l[6]||(l[6]=[ke("当前模式",-1)])),_:1,__:[6]})])]),fe("div",{class:"mode-option",onClick:v},[fe("div",Vs,[he(f,null,{default:be(()=>[he(Ve(se))]),_:1})]),l[9]||(l[9]=fe("div",{class:"mode-info"},[fe("h3",null,"AI智能创建"),fe("p",null,"上传文档，AI自动提取产品信息，快速高效")],-1)),fe("div",ws,[he(y,{type:"success",size:"small"},{default:be(()=>[he(f,null,{default:be(()=>[he(Ve(ie))]),_:1}),l[8]||(l[8]=ke(" 切换模式 ",-1))]),_:1,__:[8]})])])])]),_:1}),he(ps,{ref_key:"productFormRef",ref:i,categories:t.value,loading:a.value,onSubmit:u,onCancel:n},null,8,["categories","loading"]),he(b,{class:"quick-actions"},{header:be(()=>[fe("span",Cs,[he(f,null,{default:be(()=>[he(Ve(oe))]),_:1}),l[10]||(l[10]=ke(" 快速操作 ",-1))])]),default:be(()=>[he(k,{wrap:""},{default:be(()=>[he(y,{onClick:n},{default:be(()=>[he(f,null,{default:be(()=>[he(Ve(ne))]),_:1}),l[11]||(l[11]=ke(" 返回列表 ",-1))]),_:1,__:[11]}),he(y,{type:"success",onClick:v},{default:be(()=>[he(f,null,{default:be(()=>[he(Ve(se))]),_:1}),l[12]||(l[12]=ke(" AI智能创建 ",-1))]),_:1,__:[12]}),he(y,{type:"warning",onClick:m},{default:be(()=>[he(f,null,{default:be(()=>[he(Ve($))]),_:1}),l[13]||(l[13]=ke(" 重置表单 ",-1))]),_:1,__:[13]})]),_:1})]),_:1}),he(b,{class:"help-card"},{header:be(()=>[fe("span",Us,[he(f,null,{default:be(()=>[he(Ve(re))]),_:1}),l[14]||(l[14]=ke(" 填写指南 ",-1))])]),default:be(()=>[he(w,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value=e)},{default:be(()=>[he(V,{title:"基本信息填写",name:"basic"},{default:be(()=>l[15]||(l[15]=[fe("div",{class:"help-content"},[fe("p",null,[fe("strong",null,"产品名称:"),ke(" 简洁明了的产品名称，便于识别和搜索")]),fe("p",null,[fe("strong",null,"产品代码:"),ke(" 唯一的产品标识符，建议使用字母数字组合")]),fe("p",null,[fe("strong",null,"分类:"),ke(" 产品所属类别，可选择现有分类或创建新分类")]),fe("p",null,[fe("strong",null,"基础价格:"),ke(" 产品的标准价格，支持小数")])],-1)])),_:1,__:[15]}),he(V,{title:"技术规格说明",name:"specifications"},{default:be(()=>l[16]||(l[16]=[fe("div",{class:"help-content"},[fe("ul",null,[fe("li",null,"技术规格用于描述产品的具体参数"),fe("li",null,"每个规格包含名称、值、单位和描述"),fe("li",null,"建议按重要性和类型分组填写"),fe("li",null,"单位字段可选，但建议填写以提高专业性")])],-1)])),_:1,__:[16]}),he(V,{title:"配置架构设置",name:"configuration"},{default:be(()=>l[17]||(l[17]=[fe("div",{class:"help-content"},[fe("p",null,"当产品支持配置时，需要定义配置架构："),fe("ul",null,[fe("li",null,[fe("strong",null,"文本类型:"),ke(" 适用于名称、描述等文本输入")]),fe("li",null,[fe("strong",null,"数字类型:"),ke(" 适用于尺寸、重量等数值输入")]),fe("li",null,[fe("strong",null,"布尔类型:"),ke(" 适用于是/否选择")]),fe("li",null,[fe("strong",null,"选择类型:"),ke(" 单选，需要预设选项")]),fe("li",null,[fe("strong",null,"多选类型:"),ke(" 多选，需要预设选项")])])],-1)])),_:1,__:[17]}),he(V,{title:"图片上传建议",name:"images"},{default:be(()=>l[18]||(l[18]=[fe("div",{class:"help-content"},[fe("div",{class:"image-tips"},[fe("h4",null,"单图模式:"),fe("ul",null,[fe("li",null,"适合只有一张主图的产品"),fe("li",null,"支持快速上传和压缩优化"),fe("li",null,"建议图片尺寸不小于 800x600")]),fe("h4",null,"图集模式:"),fe("ul",null,[fe("li",null,"适合多角度、多规格的产品展示"),fe("li",null,"支持批量上传和图集管理"),fe("li",null,"可设置主图和排序")])])],-1)])),_:1,__:[18]})]),_:1},8,["modelValue"])]),_:1})])}}});export{Tt as P,xs as _,ps as a};
