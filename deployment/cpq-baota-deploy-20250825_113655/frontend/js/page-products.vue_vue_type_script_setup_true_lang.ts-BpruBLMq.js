var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,u=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a,l)=>new Promise((t,u)=>{var o=e=>{try{i(l.next(e))}catch(a){u(a)}},r=e=>{try{i(l.throw(e))}catch(a){u(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,r);i((l=l.apply(e,a)).next())});import{a as s,E as n,a3 as c,d,p,g as v,h as f,i as _,U as y,j as m,u as b,k as g,R as h,_ as k,$ as w,f as C,a0 as V,a2 as j,aa as P,ab as O,a1 as U}from"./element-plus-DR0qywX_.js";import{z as x,r as z,Z as S,b as q,l as A,A as E,C as D,S as F,M as R,J as I,K as L,u as T,P as $,an as K,Q as M,R as Q,a8 as B,L as J,az as Z,B as G}from"./vue-BMWQU0Ry.js";import{u as H}from"./page-createquote.vue_vue_type_script_setup_true_lang.ts-3HW_4Kwy.js";import{u as N}from"./api-BHu6TLr6.js";import{s as W,g as X}from"./utils-BjNHK8wL.js";import{a as Y}from"./page-createproduct.vue_vue_type_script_setup_true_lang.ts-C9H6GPKB.js";const ee={class:"products"},ae={class:"page-header"},le={class:"header-actions"},te={key:0,class:"quote-actions"},ue={class:"result-count"},oe={key:0,class:"advanced-filters"},re={class:"product-name"},ie={key:0,class:"product-description"},se={class:"pagination-wrapper"},ne={key:0,class:"product-detail"},ce={key:0,class:"mt-4"},de={key:1,class:"mt-4"},pe=x({__name:"Products",setup(e){const x=Z(),pe=H(),ve=N(),fe=z(!1),_e=z(!1),ye=z(null),me=z(null),be=z([]),ge=z(1),he=z(20),ke=z(),we=z(""),Ce=z(!1),Ve=z([]),je=z(!1),Pe=z(),Oe=S({category:"",is_active:!0,configurable:"",min_price:null,max_price:null,search:""}),Ue=S({key:"",value:""}),xe=z([]),ze=z([]),Se=q(()=>{var e;return(null==(e=me.value)?void 0:e.specifications)?Object.entries(me.value.specifications).map(([e,a])=>({name:e,value:"object"==typeof a?a.value:a,unit:"object"==typeof a?a.unit:"",description:"object"==typeof a?a.description:""})):[]}),qe=q(()=>{var e;return(null==(e=me.value)?void 0:e.configuration_schema)?Object.entries(me.value.configuration_schema).map(([e,a])=>({name:e,label:a.label||e,type:a.type||"text",required:a.required||!1,description:a.description||""})):[]}),Ae=()=>{Pe.value&&clearTimeout(Pe.value),Pe.value=setTimeout(()=>{Oe.search=we.value,ge.value=1,Qe()},300)},Ee=()=>{we.value="",Oe.search="",Qe()},De=()=>{Ce.value=!Ce.value,Ce.value&&Te()},Fe=()=>{we.value="",Oe.category="",Oe.is_active=!0,Oe.configurable="",Oe.min_price=null,Oe.max_price=null,Oe.search="",Ue.key="",Ue.value="",ge.value=1,Qe()},Re=e=>{Ve.value=e},Ie=()=>{Ve.value=[],ke.value&&ke.value.clearSelection()},Le=()=>{if(0===Ve.value.length)return void W.warning("Please select at least one product");const e=Ve.value.map(e=>e.id);x.push({name:"CreateQuote",query:{products:e.join(",")}})},Te=()=>i(this,null,function*(){try{const e=new Map;pe.products.forEach(a=>{a.specifications&&Object.keys(a.specifications).forEach(a=>{e.has(a)||e.set(a,a.charAt(0).toUpperCase()+a.slice(1).replace(/_/g," "))})}),xe.value=Array.from(e.entries()).map(([e,a])=>({key:e,label:a}))}catch(e){}}),$e=()=>{if(!Ue.key)return void(ze.value=[]);const e=new Set;pe.products.forEach(a=>{if(a.specifications&&a.specifications[Ue.key]){const l=a.specifications[Ue.key],t="object"==typeof l?l.value:l;t&&e.add(String(t))}}),ze.value=Array.from(e).sort()},Ke=()=>{Qe()},Me=()=>{Ue.key="",Ue.value="",ze.value=[],Qe()},Qe=()=>i(this,null,function*(){try{yield pe.loadProducts((e=((e,a)=>{for(var l in a||(a={}))u.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&r(e,l,a[l]);return e})({},Oe),i={page:ge.value,per_page:he.value},a(e,l(i))))}catch(s){W.error("Failed to load products")}var e,i}),Be=e=>{ge.value=e,Qe()},Je=z(null),Ze=(e,a)=>i(this,null,function*(){var l;try{if(ye.value)yield pe.updateProduct(ye.value.id,e),W.success("产品更新成功");else{const t=yield pe.createProduct(e);a&&(null==(l=t.product)?void 0:l.id)&&Je.value?yield Je.value.uploadImageAfterCreate(t.product.id.toString()):W.success("产品创建成功")}He(),Qe()}catch(t){W.error("保存产品失败")}}),Ge=e=>i(this,null,function*(){try{yield pe.deleteProduct(e),W.success("Product deactivated successfully"),Qe()}catch(a){W.error("Failed to delete product")}}),He=()=>{fe.value=!1,ye.value=null},Ne=()=>i(this,null,function*(){try{je.value=!0;const e=yield pe.loadAllProductsForCatalog();if(0===e.length)return void W.warning("没有可导出的产品");yield X(e),W.success("产品目录导出成功")}catch(e){W.error("导出产品目录失败")}finally{je.value=!1}});return A(()=>i(this,null,function*(){try{yield Qe();const e=yield pe.loadCategories();be.value=Array.isArray(e)?e:[]}catch(e){be.value=[]}})),(e,a)=>{var l;const t=K("Document"),u=d,o=s,r=_,i=f,z=v,S=b,q=m,A=g,Z=h,H=n,N=w,W=C,X=V,Pe=U,Te=j,We=c,Xe=O,Ye=P,ea=k;return G(),E("div",ee,[D("div",ae,[a[15]||(a[15]=D("h1",null,"产品管理",-1)),D("div",le,[Ve.value.length>0?(G(),E("div",te,[F(o,{type:"success",onClick:Le,size:"large"},{default:L(()=>[F(u,null,{default:L(()=>[F(t)]),_:1}),$(" 创建报价 (已选择"+M(Ve.value.length)+"个) ",1)]),_:1}),F(o,{type:"info",onClick:Ie,size:"large"},{default:L(()=>a[12]||(a[12]=[$(" 清除选择 ",-1)])),_:1,__:[12]})])):R("",!0),T(ve).canEditProducts?(G(),I(o,{key:1,type:"primary",onClick:a[0]||(a[0]=e=>fe.value=!0)},{default:L(()=>[F(u,null,{default:L(()=>[F(T(p))]),_:1}),a[13]||(a[13]=$(" 添加产品 ",-1))]),_:1,__:[13]})):R("",!0),F(o,{type:"success",onClick:Ne,loading:je.value,icon:"Download"},{default:L(()=>a[14]||(a[14]=[$(" 导出产品目录 ",-1)])),_:1,__:[14]},8,["loading"])])]),F(H,{class:"filter-card"},{default:L(()=>[F(z,{gutter:20,class:"search-row"},{default:L(()=>[F(i,{span:24},{default:L(()=>[F(r,{modelValue:we.value,"onUpdate:modelValue":a[1]||(a[1]=e=>we.value=e),placeholder:"按产品名称、SKU或描述搜索...",clearable:"",size:"large",onInput:Ae,onClear:Ee},{prefix:L(()=>[F(u,null,{default:L(()=>[F(T(y))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),F(z,{gutter:20,class:"filter-row"},{default:L(()=>[F(i,{span:6},{default:L(()=>[F(q,{modelValue:Oe.category,"onUpdate:modelValue":a[2]||(a[2]=e=>Oe.category=e),placeholder:"所有分类",clearable:"",onChange:Qe,style:{width:"100%"}},{default:L(()=>[F(S,{label:"所有分类",value:""}),(G(!0),E(Q,null,B(be.value,e=>(G(),I(S,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),F(i,{span:4},{default:L(()=>[F(q,{modelValue:Oe.is_active,"onUpdate:modelValue":a[3]||(a[3]=e=>Oe.is_active=e),placeholder:"状态",onChange:Qe,style:{width:"100%"}},{default:L(()=>[F(S,{label:"所有状态",value:""}),F(S,{label:"活跃",value:!0}),F(S,{label:"非活跃",value:!1})]),_:1},8,["modelValue"])]),_:1}),F(i,{span:4},{default:L(()=>[F(q,{modelValue:Oe.configurable,"onUpdate:modelValue":a[4]||(a[4]=e=>Oe.configurable=e),placeholder:"可配置性",clearable:"",onChange:Qe,style:{width:"100%"}},{default:L(()=>[F(S,{label:"所有类型",value:""}),F(S,{label:"可配置",value:!0}),F(S,{label:"标准",value:!1})]),_:1},8,["modelValue"])]),_:1}),F(i,{span:5},{default:L(()=>[F(A,{modelValue:Oe.min_price,"onUpdate:modelValue":a[5]||(a[5]=e=>Oe.min_price=e),placeholder:"最低价格",min:0,precision:2,onChange:Qe,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),F(i,{span:5},{default:L(()=>[F(A,{modelValue:Oe.max_price,"onUpdate:modelValue":a[6]||(a[6]=e=>Oe.max_price=e),placeholder:"最高价格",min:0,precision:2,onChange:Qe,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),F(z,{gutter:20,class:"action-row"},{default:L(()=>[F(i,{span:12},{default:L(()=>[F(o,{onClick:Fe,icon:"Refresh"},{default:L(()=>a[16]||(a[16]=[$("重置筛选",-1)])),_:1,__:[16]}),F(o,{onClick:De,link:""},{default:L(()=>[$(M(Ce.value?"隐藏":"显示")+"高级筛选 ",1)]),_:1})]),_:1}),F(i,{span:12,class:"text-right"},{default:L(()=>[D("span",ue,"找到 "+M(T(pe).total)+" 个产品",1)]),_:1})]),_:1}),Ce.value?(G(),E("div",oe,[F(Z,{"content-position":"left"},{default:L(()=>a[17]||(a[17]=[$("技术规格",-1)])),_:1,__:[17]}),F(z,{gutter:20},{default:L(()=>[F(i,{span:8},{default:L(()=>[F(q,{modelValue:Ue.key,"onUpdate:modelValue":a[7]||(a[7]=e=>Ue.key=e),placeholder:"选择规格",clearable:"",onChange:$e,style:{width:"100%"}},{default:L(()=>[(G(!0),E(Q,null,B(xe.value,e=>(G(),I(S,{key:e.key,label:e.label,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),F(i,{span:8},{default:L(()=>[F(q,{modelValue:Ue.value,"onUpdate:modelValue":a[8]||(a[8]=e=>Ue.value=e),placeholder:"选择值",clearable:"",disabled:!Ue.key,onChange:Ke,style:{width:"100%"}},{default:L(()=>[(G(!0),E(Q,null,B(ze.value,e=>(G(),I(S,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),F(i,{span:8},{default:L(()=>[F(o,{onClick:Me,icon:"Close"},{default:L(()=>a[18]||(a[18]=[$("清除",-1)])),_:1,__:[18]})]),_:1})]),_:1})])):R("",!0)]),_:1}),F(H,null,{default:L(()=>[J((G(),I(Pe,{data:T(pe).products,style:{width:"100%"},onSelectionChange:Re,ref_key:"productTable",ref:ke},{default:L(()=>[F(N,{type:"selection",width:"55",selectable:e=>e.is_active},null,8,["selectable"]),F(N,{prop:"code",label:"产品代码",width:"120"}),F(N,{prop:"name",label:"产品名称","min-width":"200"},{default:L(({row:e})=>[D("div",re,[D("strong",null,M(e.name),1),e.description?(G(),E("div",ie,M(e.description),1)):R("",!0)])]),_:1}),F(N,{prop:"category",label:"分类",width:"120"}),F(N,{prop:"base_price",label:"基础价格",width:"120"},{default:L(({row:e})=>{var a;return[$(" $"+M(null==(a=e.base_price)?void 0:a.toLocaleString()),1)]}),_:1}),F(N,{prop:"is_configurable",label:"类型",width:"100"},{default:L(({row:e})=>[F(W,{type:e.is_configurable?"warning":"info",size:"small"},{default:L(()=>[$(M(e.is_configurable?"可配置":"标准"),1)]),_:2},1032,["type"])]),_:1}),F(N,{prop:"is_active",label:"状态",width:"100"},{default:L(({row:e})=>[F(W,{type:e.is_active?"success":"danger",size:"small"},{default:L(()=>[$(M(e.is_active?"活跃":"非活跃"),1)]),_:2},1032,["type"])]),_:1}),F(N,{label:"操作",width:"200"},{default:L(({row:e})=>[F(o,{size:"small",onClick:a=>{return l=e,void x.push("/products/".concat(l.id));var l}},{default:L(()=>a[19]||(a[19]=[$("查看详情",-1)])),_:2,__:[19]},1032,["onClick"]),T(ve).canEditProducts?(G(),I(o,{key:0,size:"small",type:"primary",onClick:a=>{return l=e,ye.value=l,void(fe.value=!0);var l}},{default:L(()=>a[20]||(a[20]=[$(" 快速编辑 ",-1)])),_:2,__:[20]},1032,["onClick"])):R("",!0),T(ve).canDeleteProducts?(G(),I(X,{key:1,title:"确定要停用该产品吗？","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:a=>Ge(e.id)},{reference:L(()=>[F(o,{size:"small",type:"danger",disabled:!e.is_active},{default:L(()=>a[21]||(a[21]=[$(" 删除 ",-1)])),_:2,__:[21]},1032,["disabled"])]),_:2},1032,["onConfirm"])):R("",!0)]),_:1})]),_:1},8,["data"])),[[ea,T(pe).loading]]),D("div",se,[F(Te,{"current-page":ge.value,"onUpdate:currentPage":a[9]||(a[9]=e=>ge.value=e),"page-size":he.value,total:T(pe).total,layout:"total, prev, pager, next",onCurrentChange:Be},null,8,["current-page","page-size","total"])])]),_:1}),F(We,{modelValue:fe.value,"onUpdate:modelValue":a[10]||(a[10]=e=>fe.value=e),title:ye.value?"编辑产品":"创建产品",width:"90%","close-on-click-modal":!1,"close-on-press-escape":!1},{default:L(()=>[F(Y,{ref_key:"productFormRef",ref:Je,product:ye.value,categories:be.value,loading:T(pe).loading,onSubmit:Ze,onCancel:He},null,8,["product","categories","loading"])]),_:1},8,["modelValue","title"]),F(We,{modelValue:_e.value,"onUpdate:modelValue":a[11]||(a[11]=e=>_e.value=e),title:null==(l=me.value)?void 0:l.name,width:"80%"},{default:L(()=>[me.value?(G(),E("div",ne,[F(Ye,{title:"基本信息",column:2,border:""},{default:L(()=>[F(Xe,{label:"产品代码"},{default:L(()=>[$(M(me.value.code),1)]),_:1}),F(Xe,{label:"分类"},{default:L(()=>[$(M(me.value.category),1)]),_:1}),F(Xe,{label:"基础价格"},{default:L(()=>{var e;return[$(" $"+M(null==(e=me.value.base_price)?void 0:e.toLocaleString()),1)]}),_:1}),F(Xe,{label:"状态"},{default:L(()=>[F(W,{type:me.value.is_active?"success":"danger"},{default:L(()=>[$(M(me.value.is_active?"活跃":"非活跃"),1)]),_:1},8,["type"])]),_:1}),F(Xe,{label:"可配置"},{default:L(()=>[F(W,{type:me.value.is_configurable?"success":"info"},{default:L(()=>[$(M(me.value.is_configurable?"是":"否"),1)]),_:1},8,["type"])]),_:1}),F(Xe,{label:"描述",span:2},{default:L(()=>[$(M(me.value.description||"暂无描述"),1)]),_:1})]),_:1}),me.value.specifications&&Object.keys(me.value.specifications).length>0?(G(),E("div",ce,[a[22]||(a[22]=D("h3",null,"技术规格",-1)),F(Pe,{data:Se.value,style:{width:"100%"}},{default:L(()=>[F(N,{prop:"name",label:"规格"}),F(N,{prop:"value",label:"值"}),F(N,{prop:"unit",label:"单位"}),F(N,{prop:"description",label:"描述"})]),_:1},8,["data"])])):R("",!0),me.value.configuration_schema&&Object.keys(me.value.configuration_schema).length>0?(G(),E("div",de,[a[23]||(a[23]=D("h3",null,"配置字段",-1)),F(Pe,{data:qe.value,style:{width:"100%"}},{default:L(()=>[F(N,{prop:"name",label:"字段名"}),F(N,{prop:"label",label:"标签"}),F(N,{prop:"type",label:"类型"}),F(N,{prop:"required",label:"必填"},{default:L(({row:e})=>[F(W,{type:e.required?"success":"info"},{default:L(()=>[$(M(e.required?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),F(N,{prop:"description",label:"描述"})]),_:1},8,["data"])])):R("",!0)])):R("",!0)]),_:1},8,["modelValue","title"])])}}});export{pe as _};
