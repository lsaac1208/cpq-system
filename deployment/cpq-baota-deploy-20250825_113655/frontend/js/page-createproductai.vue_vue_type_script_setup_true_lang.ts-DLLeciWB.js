var e=(e,a,l)=>new Promise((t,s)=>{var n=e=>{try{u(l.next(e))}catch(a){s(a)}},i=e=>{try{u(l.throw(e))}catch(a){s(a)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(n,i);u((l=l.apply(e,a)).next())});import{d as a,aF as l,aG as t,t as s,a as n,a9 as i,ac as u,aH as o,X as r,aI as c,a8 as d,f as v,T as m,a7 as p,E as _,c as f,w as y,x as g,G as h,aJ as w,aK as k,an as b,ao as x,o as T,al as C,av as z,aE as A,r as S,v as I,aL as D,b as M,ay as R,aM as O,az as P,aC as E,at as j,aD as F,ak as B,aB as q}from"./element-plus-DR0qywX_.js";import{r as U,b as L,l as V,V as G,z as H,A as X,C as J,M as N,F as Q,u as W,S as K,K as Y,Q as Z,J as $,P as ee,R as ae,a8 as le,B as te,L as se,T as ne,az as ie,n as ue}from"./vue-BMWQU0Ry.js";import{s as oe}from"./utils-BjNHK8wL.js";import{n as re,a as ce,p as de}from"./api-BHu6TLr6.js";import{_ as ve}from"./page-aianalysisenhanced.vue-9uq21fmn.js";import{A as me}from"./page-aianalysisenhanced.vue_vue_type_script_setup_true_lang.ts-ClScGMKq.js";function pe(){const a=U({status:"unknown",queue_size:0,processing_count:0,max_concurrent:3,last_check:(new Date).toISOString()}),l=U({isAnalyzing:!1,estimatedTime:0,actualStartTime:null,remainingTime:0,confidence:0}),t=U({isOnline:navigator.onLine,latency:0,lastCheck:Date.now()}),s=L(()=>"healthy"===a.value.status),n=L(()=>"unavailable"!==a.value.status),i=L(()=>Math.round(a.value.queue_size/50*100)),u=L(()=>Math.round(a.value.processing_count/a.value.max_concurrent*100)),o=L(()=>{switch(a.value.status){case"healthy":return"服务正常";case"degraded":return"服务繁忙";case"unavailable":return"服务不可用";default:return"检查中..."}}),r=L(()=>{switch(a.value.status){case"healthy":return"success";case"degraded":return"warning";case"unavailable":return"danger";default:return"info"}});let c=null,d=null;const v=()=>e(this,null,function*(){var e,l,t,s;try{const n=yield fetch("/api/v1/system/health");if(!n.ok)throw new Error("HTTP ".concat(n.status));const i=yield n.json(),u={status:"healthy"===i.status?"healthy":"warning"===i.status?"degraded":"unavailable",queue_size:(null==(e=i.ai_analysis)?void 0:e.queue_size)||0,processing_count:(null==(l=i.ai_analysis)?void 0:l.processing_count)||0,max_concurrent:(null==(t=i.ai_analysis)?void 0:t.max_concurrent)||3,estimated_wait_time:m((null==(s=i.ai_analysis)?void 0:s.queue_size)||0),last_check:(new Date).toISOString()};return"healthy"!==u.status&&(u.recommendations=p(u)),a.value=u,u}catch(n){return a.value={status:"unknown",queue_size:0,processing_count:0,max_concurrent:3,last_check:(new Date).toISOString()},a.value}}),m=e=>{const l=a.value.max_concurrent;return Math.ceil(45*e/l)},p=e=>{const a=[];return e.queue_size>20&&a.push("当前队列较长，建议稍后重试"),e.processing_count>=e.max_concurrent&&a.push("服务器处理能力已满，请等待当前任务完成"),"degraded"===e.status&&a.push("服务正在降级模式运行，处理时间可能延长"),"unavailable"===e.status&&a.push("服务暂时不可用，请检查网络连接或稍后重试"),a},_=(e,l)=>{let t=30;switch(t+=e/1048576*5,l.toLowerCase()){case"pdf":t*=1.5;break;case"docx":case"doc":t*=1.3;break;case"txt":t*=.8;break;case"png":case"jpg":case"jpeg":t*=2}"degraded"===a.value.status&&(t*=1.5);const s=a.value.estimated_wait_time||0;return Math.round(t+s)},f=()=>{d&&(clearInterval(d),d=null),l.value.isAnalyzing=!1,l.value.remainingTime=0},y=e=>{let l=75;return"healthy"===a.value.status?l+=15:"degraded"===a.value.status?l-=20:l-=40,t.value.isOnline&&t.value.latency<200?l+=10:l-=15,Math.max(10,Math.min(95,l))},g=()=>e(this,null,function*(){const e=Date.now();try{yield fetch("/api/v1/system/health",{method:"HEAD"}),t.value.latency=Date.now()-e,t.value.lastCheck=Date.now()}catch(a){t.value.latency=9999}}),h=()=>{v(),g(),c=window.setInterval(()=>{v(),g()},3e4)},w=()=>{c&&(clearInterval(c),c=null),f()},k=()=>{t.value.isOnline=!0,v(),oe.success("网络连接已恢复")},b=()=>{t.value.isOnline=!1,oe.warning("网络连接已断开")};return V(()=>{h(),window.addEventListener("online",k),window.addEventListener("offline",b)}),G(()=>{w(),window.removeEventListener("online",k),window.removeEventListener("offline",b)}),{serviceStatus:L(()=>a.value),analysisStatus:L(()=>l.value),networkStatus:L(()=>t.value),isServiceHealthy:s,isServiceAvailable:n,queueUtilization:i,processingUtilization:u,serviceStatusText:o,serviceStatusColor:r,checkServiceStatus:v,estimateAnalysisTime:_,startAnalysisTimer:(e,a)=>{const t=_(e,a);l.value={isAnalyzing:!0,estimatedTime:t,actualStartTime:Date.now(),remainingTime:t,confidence:y()},d=window.setInterval(()=>{const e=(Date.now()-(l.value.actualStartTime||0))/1e3,a=Math.max(0,l.value.estimatedTime-e);l.value.remainingTime=a,e>1.2*l.value.estimatedTime&&(l.value.confidence=Math.max(20,l.value.confidence-10))},1e3)},stopAnalysisTimer:f,getRetryRecommendation:e=>{const l=a.value.queue_size,s=a.value.status;return"timeout"===e?"healthy"===s&&l<10?{shouldRetry:!0,retryDelay:5e3,reason:"服务状态良好，建议立即重试"}:{shouldRetry:!0,retryDelay:3e4,reason:"服务繁忙，建议稍后重试"}:"network"===e?{shouldRetry:t.value.isOnline,retryDelay:t.value.isOnline?1e4:6e4,reason:t.value.isOnline?"网络已恢复，可以重试":"请检查网络连接"}:"unavailable"===s?{shouldRetry:!1,retryDelay:0,reason:"服务暂时不可用，请稍后再试"}:{shouldRetry:!0,retryDelay:15e3,reason:"可以重试，建议等待15秒"}},formatTime:e=>{if(e<60)return"".concat(Math.round(e),"秒");if(e<3600){const a=Math.floor(e/60),l=Math.round(e%60);return"".concat(a,"分").concat(l,"秒")}{const a=Math.floor(e/3600),l=Math.floor(e%3600/60);return"".concat(a,"小时").concat(l,"分钟")}},startStatusMonitoring:h,stopStatusMonitoring:w}}const _e={class:"ai-service-status"},fe={class:"status-content"},ye={class:"status-icon"},ge={class:"status-text"},he={class:"status-value"},we={key:0,class:"status-metrics"},ke={class:"metric"},be={class:"metric"},xe={class:"status-actions"},Te={class:"status-details"},Ce={class:"detail-section"},ze={class:"detail-grid"},Ae={class:"detail-item"},Se={class:"detail-item"},Ie={class:"detail-item"},De={key:0,class:"detail-item"},Me={key:0,class:"detail-section"},Re={class:"recommendation-list"},Oe={class:"detail-section"},Pe={class:"detail-grid"},Ee={class:"detail-item"},je={class:"detail-item"},Fe={class:"detail-actions"},Be={key:0,class:"analysis-progress-bar"},qe={class:"progress-header"},Ue={class:"progress-time"},Le={class:"progress-footer"},Ve={class:"confidence-indicator"},Ge={key:1,class:"offline-banner"},He=ve(H({__name:"AIServiceStatus",setup(_){const{serviceStatus:f,analysisStatus:y,networkStatus:g,isServiceAvailable:h,queueUtilization:w,processingUtilization:k,serviceStatusText:b,serviceStatusColor:x,checkServiceStatus:T,formatTime:C}=pe(),z=U(!1),A=U(!1),S=L(()=>y.value.isAnalyzing),I=L(()=>y.value.remainingTime),D=L(()=>g.value.latency),M=L(()=>g.value.isOnline),R=L(()=>{if(!S.value)return 0;const{estimatedTime:e,actualStartTime:a}=y.value;if(!a)return 0;const l=(Date.now()-a)/1e3,t=Math.min(95,l/e*100);return Math.round(t)}),O=()=>e(this,null,function*(){z.value=!0;try{yield T(),oe.success("状态已更新")}catch(e){oe.error("刷新失败")}finally{z.value=!1}}),P=()=>e(this,null,function*(){A.value=!0;try{yield fetch("/api/v1/system/health",{method:"HEAD",cache:"no-cache"}),oe.success("网络连接正常")}catch(e){oe.error("网络连接失败")}finally{A.value=!1}});return(e,_)=>{const g=a,T=l,E=n,j=v,F=t,B=s;return te(),X("div",_e,[J("div",{class:Q(["status-bar","status-".concat(W(x))])},[J("div",fe,[J("div",ye,[K(g,{class:Q(["status-indicator",{pulse:S.value}])},{default:Y(()=>["success"===W(x)?(te(),$(W(i),{key:0})):"info"===W(x)?(te(),$(W(u),{key:1})):"warning"===W(x)?(te(),$(W(o),{key:2})):(te(),$(W(r),{key:3}))]),_:1},8,["class"])]),J("div",ge,[_[0]||(_[0]=J("span",{class:"status-label"},"AI分析服务",-1)),J("span",he,Z(W(b)),1)]),W(h)?(te(),X("div",we,[K(T,{content:"队列使用率",placement:"top"},{default:Y(()=>[J("div",ke,[K(g,null,{default:Y(()=>[K(W(c))]),_:1}),J("span",null,Z(W(w))+"%",1)])]),_:1}),K(T,{content:"处理器使用率",placement:"top"},{default:Y(()=>[J("div",be,[K(g,null,{default:Y(()=>[K(W(d))]),_:1}),J("span",null,Z(W(k))+"%",1)])]),_:1}),D.value<9999?(te(),$(T,{key:0,content:"网络延迟: ".concat(D.value,"ms"),placement:"top"},{default:Y(()=>[J("div",{class:Q(["metric",{"metric-warning":D.value>500}])},[K(g,null,{default:Y(()=>[K(W(i))]),_:1}),J("span",null,Z(D.value)+"ms",1)],2)]),_:1},8,["content"])):N("",!0)])):N("",!0),J("div",xe,[M.value?N("",!0):(te(),$(E,{key:0,type:"warning",size:"small",icon:"Refresh",onClick:P,loading:A.value},{default:Y(()=>_[1]||(_[1]=[ee(" 重连 ",-1)])),_:1,__:[1]},8,["loading"])),K(F,{placement:"bottom-end",title:"服务详情",width:"320",trigger:"click"},{reference:Y(()=>[K(E,{type:"primary",size:"small",icon:"InfoFilled",circle:"",disabled:!W(h)},null,8,["disabled"])]),default:Y(()=>{var e;return[J("div",Te,[J("div",Ce,[_[6]||(_[6]=J("h4",null,"服务状态",-1)),J("div",ze,[J("div",Ae,[_[2]||(_[2]=J("span",{class:"detail-label"},"状态:",-1)),K(j,{type:W(x),size:"small"},{default:Y(()=>[ee(Z(W(b)),1)]),_:1},8,["type"])]),J("div",Se,[_[3]||(_[3]=J("span",{class:"detail-label"},"队列长度:",-1)),J("span",null,Z(W(f).queue_size),1)]),J("div",Ie,[_[4]||(_[4]=J("span",{class:"detail-label"},"处理中:",-1)),J("span",null,Z(W(f).processing_count)+"/"+Z(W(f).max_concurrent),1)]),W(f).estimated_wait_time?(te(),X("div",De,[_[5]||(_[5]=J("span",{class:"detail-label"},"预计等待:",-1)),J("span",null,Z(W(C)(W(f).estimated_wait_time)),1)])):N("",!0)])]),(null==(e=W(f).recommendations)?void 0:e.length)?(te(),X("div",Me,[_[7]||(_[7]=J("h4",null,"建议",-1)),J("ul",Re,[(te(!0),X(ae,null,le(W(f).recommendations,e=>(te(),X("li",{key:e},Z(e),1))),128))])])):N("",!0),J("div",Oe,[_[10]||(_[10]=J("h4",null,"网络状态",-1)),J("div",Pe,[J("div",Ee,[_[8]||(_[8]=J("span",{class:"detail-label"},"连接:",-1)),K(j,{type:M.value?"success":"danger",size:"small"},{default:Y(()=>[ee(Z(M.value?"正常":"断开"),1)]),_:1},8,["type"])]),J("div",je,[_[9]||(_[9]=J("span",{class:"detail-label"},"延迟:",-1)),J("span",null,Z(D.value<9999?"".concat(D.value,"ms"):"无法测量"),1)])])]),J("div",Fe,[K(E,{size:"small",onClick:O,loading:z.value},{default:Y(()=>[K(g,null,{default:Y(()=>[K(W(m))]),_:1}),_[11]||(_[11]=ee(" 刷新状态 ",-1))]),_:1,__:[11]},8,["loading"])])])]}),_:1})])])],2),S.value?(te(),X("div",Be,[J("div",qe,[_[12]||(_[12]=J("span",{class:"progress-title"},"正在分析文档...",-1)),J("span",Ue,Z(I.value>0?"剩余约 ".concat(W(C)(I.value)):"即将完成"),1)]),K(B,{percentage:R.value,"show-text":!1,"stroke-width":6,color:"#409EFF",class:"progress-bar"},null,8,["percentage"]),J("div",Le,[J("span",Ve,[K(g,null,{default:Y(()=>[K(W(p))]),_:1}),ee(" 预估准确度: "+Z(W(y).confidence)+"% ",1)])])])):N("",!0),M.value?N("",!0):(te(),X("div",Ge,[K(g,null,{default:Y(()=>[K(W(r))]),_:1}),_[14]||(_[14]=J("span",null,"网络连接已断开，请检查网络设置",-1)),K(E,{type:"text",onClick:P},{default:Y(()=>_[13]||(_[13]=[ee("重试连接",-1)])),_:1,__:[13]})]))])}}}),[["__scopeId","data-v-c0e9c927"]]),Xe={class:"ai-document-upload"},Je={class:"card-header"},Ne={class:"card-title"},Qe={class:"upload-area"},We={class:"upload-content"},Ke={class:"upload-text"},Ye={class:"upload-hint"},Ze={key:0,class:"upload-actions"},$e={key:1,class:"analysis-progress"},ea={class:"progress-text"},aa={class:"progress-steps"},la={class:"format-info"},ta={class:"format-details"},sa={class:"format-category"},na={class:"format-desc"},ia={key:0,class:"format-category"},ua={class:"format-note"},oa={key:0,class:"error-container"},ra={class:"error-content"},ca={class:"error-message"},da={class:"error-detail-list"},va={key:1,class:"error-suggestions"},ma={class:"suggestion-list"},pa={class:"error-actions"},_a=ve(H({__name:"AIDocumentUpload",props:{disabled:{type:Boolean,default:!1},maxSize:{default:10}},emits:["analysis-start","analysis-success","analysis-error","analysis-complete"],setup(l,{expose:t,emit:i}){const u=l,o=i,{serviceStatus:r,isServiceAvailable:c,estimateAnalysisTime:d,startAnalysisTimer:m,stopAnalysisTimer:p,getRetryRecommendation:R,formatTime:O}=pe(),P=U(),E=U(null),j=U(!1),F=U(0),B=U(""),q=U(0),G=U(""),H=U(null),Q=U([]),se=U(null),ne=U(null),ie=L(()=>{var e;return!!(null==(e=ne.value)?void 0:e.ai_available)&&c.value}),ue=L(()=>{var e,a,l;return(null==(l=null==(a=null==(e=ne.value)?void 0:e.document_formats)?void 0:a.availability)?void 0:l.ocr)||!1}),de=L(()=>{if(!ne.value)return[];const e=ne.value.document_formats.availability;return[{ext:"txt",description:"纯文本文件",available:!0},{ext:"pdf",description:"PDF文档",available:e.pdf},{ext:"docx",description:"Word文档",available:e.docx},{ext:"doc",description:"旧版Word文档",available:e.docx}]}),ve=L(()=>["png","jpg","jpeg"]),me=L(()=>{var e,a,l,t,s,n;const i=["TXT"];return(null==(l=null==(a=null==(e=ne.value)?void 0:e.document_formats)?void 0:a.availability)?void 0:l.pdf)&&i.push("PDF"),(null==(n=null==(s=null==(t=ne.value)?void 0:t.document_formats)?void 0:s.availability)?void 0:n.docx)&&i.push("DOCX","DOC"),ue.value&&i.push(...ve.value.map(e=>e.toUpperCase())),i}),_e=L(()=>{var e,a,l,t,s,n;const i=[".txt"];return(null==(l=null==(a=null==(e=ne.value)?void 0:e.document_formats)?void 0:a.availability)?void 0:l.pdf)&&i.push(".pdf"),(null==(n=null==(s=null==(t=ne.value)?void 0:t.document_formats)?void 0:s.availability)?void 0:n.docx)&&i.push(".docx",".doc"),ue.value&&i.push(".png",".jpg",".jpeg"),i.join(",")});V(()=>e(this,null,function*(){yield fe()}));const fe=()=>e(this,null,function*(){try{const e=yield re();ne.value=e.formats,e.formats.ai_available||oe.warning("AI分析服务当前不可用，请检查配置")}catch(e){oe.error("获取支持格式失败")}}),ye=e=>{var a;const l=1024*u.maxSize*1024;if(e.size>l)return oe.error("文件大小不能超过 ".concat(u.maxSize,"MB")),!1;const t=null==(a=e.name.split(".").pop())?void 0:a.toLowerCase();return!(!t||!["txt","pdf","docx","doc","png","jpg","jpeg"].includes(t))||(oe.error("不支持的文件格式"),!1)},ge=(e,a)=>{e.raw&&(E.value=e.raw,ke())},he=()=>{E.value=null,ke()},we=()=>{var e;null==(e=P.value)||e.clearFiles(),E.value=null,ke(),Se(),p(),be()},ke=()=>{G.value="",H.value=null},be=()=>{F.value=0,q.value=0,B.value=""},xe=(e,a,l)=>{if(q.value=e,B.value=a,void 0!==l)F.value=l;else{const a=[10,40,85,100];F.value=a[e]||0}},Te=()=>e(this,null,function*(){var e,a,l,t,s;if(!E.value||!ie.value)return;j.value=!0,be(),o("analysis-start");const n=(null==(e=E.value.name.split(".").pop())?void 0:e.toLowerCase())||"";d(E.value.size,n),r.value.estimated_wait_time&&r.value.estimated_wait_time>10&&oe.info("当前队列较长，预计等待 ".concat(O(r.value.estimated_wait_time))),m(E.value.size,n);try{xe(0,"准备上传文件..."),yield new Promise(e=>setTimeout(e,500)),xe(1,"正在解析文档内容...");const e="degraded"===r.value.status?"正在进行AI分析 (降级模式)...":"正在进行AI智能分析...";xe(2,e);const a=yield ce(E.value);if(xe(3,"分析完成！",100),yield new Promise(e=>setTimeout(e,500)),!a.success)throw new Error(a.error||"分析失败");p(),oe.success("文档分析完成！"),o("analysis-success",a)}catch(i){p();const e=(null==(a=i.response)?void 0:a.data)||{},n=Ce(i),u=R(n);if(e.error_type&&e.error_details)H.value={title:(null==(l=e.error_details)?void 0:l.title)||"文档分析失败",message:e.error||"分析过程中出现错误",details:(null==(t=e.error_details)?void 0:t.details)||[],suggestions:[...(null==(s=e.error_details)?void 0:s.suggestions)||[],u.reason],error_type:e.error_type,retry_recommendation:u};else{const a=e.error||i.message||"分析过程中出现错误";H.value={title:"文档分析失败",message:a,details:["系统遇到了预期之外的问题"],suggestions:[u.reason,"检查文档是否正常","尝试其他格式的文档","联系技术支持"],error_type:n,retry_recommendation:u}}u.shouldRetry&&u.retryDelay>0&&ze(u.retryDelay),oe.error(H.value.message),o("analysis-error",H.value.message),be()}finally{j.value=!1,o("analysis-complete")}}),Ce=e=>{var a,l,t;return"ECONNABORTED"===e.code||(null==(a=e.message)?void 0:a.includes("timeout"))?"timeout":"NETWORK_ERROR"!==e.code&&navigator.onLine?(null==(l=e.response)?void 0:l.status)>=500?"server":429===(null==(t=e.response)?void 0:t.status)?"rate_limit":"unknown":"network"},ze=e=>{se.value&&clearTimeout(se.value);let a=Math.ceil(e/1e3);const l=setInterval(()=>{a>0?(oe.info("将在 ".concat(a," 秒后自动重试..."),{duration:1e3}),a--):clearInterval(l)},1e3);se.value=window.setTimeout(()=>{var e,a;clearInterval(l),E.value&&(null==(a=null==(e=H.value)?void 0:e.retry_recommendation)?void 0:a.shouldRetry)&&(oe.info("正在自动重试..."),Ae())},e)},Ae=()=>{E.value&&(ke(),Se(),Te())},Se=()=>{se.value&&(clearTimeout(se.value),se.value=null)},Ie=()=>{var e,a,l;M.alert("请联系技术支持并提供以下信息：\n\n• 错误类型: ".concat((null==(e=H.value)?void 0:e.error_type)||"未知","\n• 文件名称: ").concat((null==(a=E.value)?void 0:a.name)||"未知","\n• 文件大小: ").concat(E.value?(E.value.size/1024/1024).toFixed(2)+"MB":"未知","\n• 错误信息: ").concat((null==(l=H.value)?void 0:l.message)||"未知","\n\n技术支持邮箱: support@example.com\n技术支持QQ群: 123456789"),"联系技术支持",{confirmButtonText:"复制信息",showCancelButton:!0,cancelButtonText:"关闭",type:"info"}).then(()=>{var e,a,l;const t="错误类型: ".concat((null==(e=H.value)?void 0:e.error_type)||"未知","\n文件名称: ").concat((null==(a=E.value)?void 0:a.name)||"未知","\n文件大小: ").concat(E.value?(E.value.size/1024/1024).toFixed(2)+"MB":"未知","\n错误信息: ").concat((null==(l=H.value)?void 0:l.message)||"未知");navigator.clipboard?navigator.clipboard.writeText(t).then(()=>{oe.success("错误信息已复制到剪贴板")}):oe.info("请手动复制错误信息")}).catch(()=>{})};return t({clearFile:we,startAnalysis:Te,retryAnalysis:Ae}),(e,l)=>{const t=a,i=v,u=y,o=n,r=s,c=k,d=w,m=x,p=b,M=_,R=f;return te(),X("div",Xe,[K(He,{class:"service-status"}),K(M,{class:"upload-card"},{header:Y(()=>[J("div",Je,[J("span",Ne,[K(t,null,{default:Y(()=>[K(W(T))]),_:1}),l[1]||(l[1]=ee(" AI文档分析 ",-1))]),ie.value?N("",!0):(te(),$(i,{key:0,type:"warning",size:"small"},{default:Y(()=>l[2]||(l[2]=[ee(" AI服务不可用 ",-1)])),_:1,__:[2]}))])]),default:Y(()=>[J("div",Qe,[K(u,{ref_key:"uploadRef",ref:P,class:"document-upload",drag:"",action:"","auto-upload":!1,"show-file-list":!0,accept:_e.value,"before-upload":ye,"on-change":ge,"on-remove":he,disabled:j.value||!ie.value},{default:Y(()=>[J("div",We,[K(t,{class:"upload-icon"},{default:Y(()=>[K(W(g))]),_:1}),J("div",Ke,[l[3]||(l[3]=J("p",null,[ee("拖拽文件到这里，或"),J("em",null,"点击选择文件")],-1)),J("p",Ye," 支持格式: "+Z(me.value.join(", ")),1),l[4]||(l[4]=J("p",{class:"upload-size"},"文件大小限制: 10MB",-1))])])]),_:1},8,["accept","disabled"]),E.value?(te(),X("div",Ze,[K(o,{type:"primary",size:"large",loading:j.value,disabled:!E.value||!ie.value,onClick:Te},{default:Y(()=>[K(t,null,{default:Y(()=>[K(W(h))]),_:1}),ee(" "+Z(j.value?"正在分析中...":"开始AI分析"),1)]),_:1},8,["loading","disabled"]),j.value?N("",!0):(te(),$(o,{key:0,size:"large",onClick:we},{default:Y(()=>l[5]||(l[5]=[ee(" 清除文件 ",-1)])),_:1,__:[5]}))])):N("",!0),j.value?(te(),X("div",$e,[K(r,{percentage:F.value,"show-text":!1,"stroke-width":8,color:"#409EFF"},null,8,["percentage"]),J("p",ea,Z(B.value),1),J("div",aa,[K(d,{active:q.value,"align-center":""},{default:Y(()=>[K(c,{title:"上传文件",icon:"Upload"}),K(c,{title:"文档解析",icon:"Reading"}),K(c,{title:"AI分析",icon:"MagicStick"}),K(c,{title:"完成",icon:"Check"})]),_:1},8,["active"])])])):N("",!0)]),J("div",la,[K(p,{modelValue:Q.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Q.value=e)},{default:Y(()=>[K(m,{title:"支持的文档格式",name:"formats"},{default:Y(()=>[J("div",ta,[J("div",sa,[J("h4",null,[K(t,null,{default:Y(()=>[K(W(T))]),_:1}),l[6]||(l[6]=ee("文本文档",-1))]),(te(!0),X(ae,null,le(de.value,e=>(te(),$(i,{key:e.ext,type:e.available?"success":"info",size:"small",class:"format-tag"},{default:Y(()=>[ee(Z(e.ext.toUpperCase())+" ",1),J("span",na,Z(e.description),1)]),_:2},1032,["type"]))),128))]),ue.value?(te(),X("div",ia,[J("h4",null,[K(t,null,{default:Y(()=>[K(W(C))]),_:1}),l[7]||(l[7]=ee("图片文档 (OCR)",-1))]),(te(!0),X(ae,null,le(ve.value,e=>(te(),$(i,{key:e,type:"warning",size:"small",class:"format-tag"},{default:Y(()=>[ee(Z(e.toUpperCase()),1)]),_:2},1024))),128)),J("p",ua,[K(t,null,{default:Y(()=>[K(W(z))]),_:1}),l[8]||(l[8]=ee(" 图片将通过OCR技术提取文字内容进行分析 ",-1))])])):N("",!0)])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),H.value?(te(),X("div",oa,[K(R,{title:H.value.title||"文档分析失败",type:"error",closable:!0,onClose:ke,class:"error-alert","show-icon":""},{default:Y(()=>[J("div",ra,[J("p",ca,Z(H.value.message),1),H.value.details?(te(),$(p,{key:0,class:"error-details"},{default:Y(()=>[K(m,{title:"错误详情",name:"details"},{default:Y(()=>[J("ul",da,[(te(!0),X(ae,null,le(H.value.details,e=>(te(),X("li",{key:e},Z(e),1))),128))])]),_:1})]),_:1})):N("",!0),H.value.suggestions?(te(),X("div",va,[J("h4",null,[K(t,null,{default:Y(()=>[K(W(A))]),_:1}),l[9]||(l[9]=ee("解决建议：",-1))]),J("ul",ma,[(te(!0),X(ae,null,le(H.value.suggestions,e=>(te(),X("li",{key:e},Z(e),1))),128))])])):N("",!0),J("div",pa,[K(o,{type:"primary",size:"small",onClick:Ae,disabled:!E.value},{default:Y(()=>[K(t,null,{default:Y(()=>[K(W(S))]),_:1}),l[10]||(l[10]=ee(" 重新尝试 ",-1))]),_:1,__:[10]},8,["disabled"]),K(o,{size:"small",onClick:we},{default:Y(()=>[K(t,null,{default:Y(()=>[K(W(I))]),_:1}),l[11]||(l[11]=ee(" 清除文件 ",-1))]),_:1,__:[11]}),K(o,{size:"small",onClick:Ie},{default:Y(()=>[K(t,null,{default:Y(()=>[K(W(D))]),_:1}),l[12]||(l[12]=ee(" 联系支持 ",-1))]),_:1,__:[12]})])])]),_:1},8,["title"])])):N("",!0)])}}}),[["__scopeId","data-v-33919a90"]]),fa={class:"create-product-ai"},ya={class:"page-header"},ga={class:"header-content"},ha={class:"page-title"},wa={class:"step-content"},ka={class:"step-content"},ba={class:"card-title"},xa={class:"card-title"},Ta={class:"help-content"},Ca=H({__name:"CreateProductAI",setup(l){const t=ie(),s=U(0),i=U(null),u=U(null),o=U([]),r=U([]),c=U(),d=U();V(()=>e(this,null,function*(){yield m()})),L(()=>["上传文档","AI分析","结果预览","创建产品"]);const m=()=>e(this,null,function*(){try{const e=yield de.getCategories();o.value=e.categories||[]}catch(e){}}),p=()=>{s.value=1,i.value=null,oe.info("开始分析文档...")},f=e=>{i.value=e,s.value=2,oe.success("文档分析完成！请检查提取的信息"),ue(()=>{var e;null==(e=document.querySelector(".step-content"))||e.scrollIntoView({behavior:"smooth",block:"start"})})},y=e=>{oe.error("分析失败: ".concat(e)),s.value=0},g=()=>{},T=e=>{i.value&&(u.value={id:e,name:i.value.extracted_data.basic_info.name,code:i.value.extracted_data.basic_info.code}),s.value=3,oe.success("产品创建成功！正在跳转到产品详情页...")},C=()=>{M.confirm("确定要取消当前操作吗？未保存的数据将会丢失。","确认取消",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}).then(()=>{G()}).catch(()=>{})},z=(e,a)=>{},I=()=>{s.value>0&&s.value--},D=()=>{M.confirm("确定要重新开始吗？当前进度将会丢失。","重新开始",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{s.value=0,i.value=null,u.value=null,c.value&&c.value.clearFile(),oe.success("已重置，请重新上传文档")}).catch(()=>{})},G=()=>{t.push({name:"Products"})},H=()=>{t.push({name:"CreateProduct"})},Q=()=>{u.value&&t.push({name:"ProductDetail",params:{id:u.value.id}})},Z=()=>{D()};return document.title="AI智能产品创建 - CPQ系统",(e,l)=>{var t;const m=P,M=R,U=a,L=k,V=w,ae=_,le=n,ie=E,ue=O,oe=x,re=v,ce=b;return te(),X("div",fa,[J("div",ya,[K(M,{separator:"/"},{default:Y(()=>[K(m,{to:{name:"products"}},{default:Y(()=>l[1]||(l[1]=[ee("产品管理",-1)])),_:1,__:[1]}),K(m,null,{default:Y(()=>l[2]||(l[2]=[ee("AI智能创建",-1)])),_:1,__:[2]})]),_:1}),J("div",ga,[J("h1",ha,[K(U,null,{default:Y(()=>[K(W(h))]),_:1}),l[3]||(l[3]=ee(" AI智能产品创建 ",-1))]),l[4]||(l[4]=J("p",{class:"page-description"}," 上传产品相关文档，AI将自动分析并提取产品信息，大幅提升产品录入效率 ",-1))])]),K(ae,{class:"steps-card"},{default:Y(()=>[K(V,{active:s.value,"align-center":""},{default:Y(()=>[K(L,{title:"上传文档",icon:"Upload"},{description:Y(()=>l[5]||(l[5]=[ee(" 上传产品相关文档 ",-1)])),_:1}),K(L,{title:"AI分析",icon:"MagicStick"},{description:Y(()=>l[6]||(l[6]=[ee(" AI智能提取产品信息 ",-1)])),_:1}),K(L,{title:"结果预览",icon:"View"},{description:Y(()=>l[7]||(l[7]=[ee(" 预览并确认分析结果 ",-1)])),_:1}),K(L,{title:"创建产品",icon:"Check"},{description:Y(()=>l[8]||(l[8]=[ee(" 确认创建产品 ",-1)])),_:1})]),_:1},8,["active"])]),_:1}),se(J("div",wa,[K(_a,{ref_key:"documentUploadRef",ref:c,onAnalysisStart:p,onAnalysisSuccess:f,onAnalysisError:y,onAnalysisComplete:g},null,512)],512),[[ne,0===s.value]]),se(J("div",ka,[K(me,{ref_key:"analysisPreviewRef",ref:d,"analysis-result":i.value,categories:o.value,onProductCreated:T,onCancel:C,onFieldModified:z},null,8,["analysis-result","categories"])],512),[[ne,s.value>=1&&i.value]]),3===s.value&&u.value?(te(),$(ue,{key:0,icon:"success",title:"产品创建成功！","sub-title":"产品 "+((null==(t=u.value)?void 0:t.name)||"")+" 已成功创建",class:"success-result"},{extra:Y(()=>[K(ie,null,{default:Y(()=>[K(le,{type:"primary",onClick:Q},{default:Y(()=>l[9]||(l[9]=[ee(" 查看产品详情 ",-1)])),_:1,__:[9]}),K(le,{onClick:Z},{default:Y(()=>l[10]||(l[10]=[ee(" 继续创建 ",-1)])),_:1,__:[10]}),K(le,{onClick:G},{default:Y(()=>l[11]||(l[11]=[ee(" 返回产品列表 ",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["sub-title"])):N("",!0),s.value<3?(te(),$(ae,{key:1,class:"quick-actions"},{header:Y(()=>[J("span",ba,[K(U,null,{default:Y(()=>[K(W(q))]),_:1}),l[12]||(l[12]=ee(" 快速操作 ",-1))])]),default:Y(()=>[K(ie,{wrap:""},{default:Y(()=>[s.value>0?(te(),$(le,{key:0,type:"info",onClick:I},{default:Y(()=>[K(U,null,{default:Y(()=>[K(W(j))]),_:1}),l[13]||(l[13]=ee(" 上一步 ",-1))]),_:1,__:[13]})):N("",!0),K(le,{type:"warning",onClick:D},{default:Y(()=>[K(U,null,{default:Y(()=>[K(W(S))]),_:1}),l[14]||(l[14]=ee(" 重新开始 ",-1))]),_:1,__:[14]}),K(le,{onClick:G},{default:Y(()=>[K(U,null,{default:Y(()=>[K(W(F))]),_:1}),l[15]||(l[15]=ee(" 返回列表 ",-1))]),_:1,__:[15]}),K(le,{type:"success",onClick:H},{default:Y(()=>[K(U,null,{default:Y(()=>[K(W(B))]),_:1}),l[16]||(l[16]=ee(" 传统创建 ",-1))]),_:1,__:[16]})]),_:1})]),_:1})):N("",!0),K(ae,{class:"help-card"},{header:Y(()=>[J("span",xa,[K(U,null,{default:Y(()=>[K(W(A))]),_:1}),l[17]||(l[17]=ee(" 使用帮助 ",-1))])]),default:Y(()=>[K(ce,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value=e)},{default:Y(()=>[K(oe,{title:"支持的文档格式",name:"formats"},{default:Y(()=>l[18]||(l[18]=[J("div",{class:"help-content"},[J("p",null,[J("strong",null,"文本文档:"),ee(" TXT, PDF, Word文档 (DOC/DOCX)")]),J("p",null,[J("strong",null,"图片文档:"),ee(" PNG, JPG, JPEG (通过OCR识别)")]),J("p",null,[J("strong",null,"建议:"),ee(" 文档内容越详细，AI提取的信息越准确")])],-1)])),_:1,__:[18]}),K(oe,{title:"最佳实践",name:"best-practices"},{default:Y(()=>l[19]||(l[19]=[J("div",{class:"help-content"},[J("ul",null,[J("li",null,"使用包含完整产品规格的正式文档"),J("li",null,"确保文档中包含产品名称、型号等关键信息"),J("li",null,"技术参数表格式的文档效果更好"),J("li",null,"分析后请仔细检查并修正AI提取的信息")])],-1)])),_:1,__:[19]}),K(oe,{title:"置信度说明",name:"confidence"},{default:Y(()=>[J("div",Ta,[J("p",null,[l[21]||(l[21]=J("strong",null,"高置信度 (80%+):",-1)),l[22]||(l[22]=ee()),K(re,{type:"success",size:"small"},{default:Y(()=>l[20]||(l[20]=[ee("绿色",-1)])),_:1,__:[20]}),l[23]||(l[23]=ee(" 信息准确，可直接使用",-1))]),J("p",null,[l[25]||(l[25]=J("strong",null,"中等置信度 (60-79%):",-1)),l[26]||(l[26]=ee()),K(re,{type:"warning",size:"small"},{default:Y(()=>l[24]||(l[24]=[ee("黄色",-1)])),_:1,__:[24]}),l[27]||(l[27]=ee(" 建议人工核实",-1))]),J("p",null,[l[29]||(l[29]=J("strong",null,"低置信度 (<60%):",-1)),l[30]||(l[30]=ee()),K(re,{type:"danger",size:"small"},{default:Y(()=>l[28]||(l[28]=[ee("红色",-1)])),_:1,__:[28]}),l[31]||(l[31]=ee(" 需要人工修正",-1))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}});export{Ca as _};
