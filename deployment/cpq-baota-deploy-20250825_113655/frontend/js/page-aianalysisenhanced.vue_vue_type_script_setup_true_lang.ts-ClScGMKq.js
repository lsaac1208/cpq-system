const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/api-BHu6TLr6.js","js/vendor-http-BEJhHwQz.js","js/utils-BjNHK8wL.js","js/element-plus-DR0qywX_.js","js/vue-BMWQU0Ry.js","js/vendor-B3dkwCfs.js","assets/element-plus-5WCGhEuA.css","js/vendor-pdf-BGK3fMt2.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,c=(e,a)=>{for(var l in a||(a={}))t.call(a,l)&&n(e,l,a[l]);if(s)for(var l of s(a))i.call(a,l)&&n(e,l,a[l]);return e},o=(e,a,l)=>new Promise((s,t)=>{var i=e=>{try{c(l.next(e))}catch(a){t(a)}},n=e=>{try{c(l.throw(e))}catch(a){t(a)}},c=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,n);c((l=l.apply(e,a)).next())});import{E as r,a as d,b as u,c as f,d as p,e as v,f as m,g as _,h as y,i as h,j as g,k as b,l as w,p as k,s as x,m as C,n as A,o as z,q as V,r as j,t as O,u as I,v as R,w as M,x as P,y as E,z as U,A as F,B as T,C as L,D,F as S,G as B,H as $,I as N,J as G,K as q,L as J,M as W,N as K,O as X,P as H,Q}from"./element-plus-DR0qywX_.js";import{z as Z,r as Y,b as ee,Z as ae,w as le,A as se,S as te,J as ie,M as ne,C as ce,K as oe,az as re,Q as de,R as ue,a8 as fe,P as pe,u as ve,F as me,B as _e,an as ye,X as he,l as ge}from"./vue-BMWQU0Ry.js";import{c as be,u as we,_ as ke,a as xe,g as Ce}from"./api-BHu6TLr6.js";import{s as Ae}from"./utils-BjNHK8wL.js";import{_ as ze}from"./page-aianalysisenhanced.vue-9uq21fmn.js";const Ve={class:"ai-analysis-preview"},je={class:"card-header"},Oe={class:"card-title"},Ie={class:"summary-content"},Re={class:"summary-item"},Me={class:"value"},Pe={class:"summary-item"},Ee={class:"value"},Ue={class:"summary-item"},Fe={class:"value"},Te={class:"confidence-breakdown"},Le={class:"confidence-items"},De={class:"confidence-label"},Se={class:"confidence-value"},Be={class:"section-header"},$e={class:"section-title"},Ne={class:"editable-fields"},Ge={class:"field-item"},qe={class:"field-item"},Je={class:"field-item"},We={class:"field-item"},Ke={class:"field-item"},Xe={class:"section-header"},He={class:"section-title"},Qe={class:"specifications-list"},Ze={class:"section-header"},Ye={class:"section-title"},ea={class:"features-list"},aa={class:"section-header"},la={class:"section-title"},sa={class:"text-content"},ta={class:"text-preview-content"},ia={class:"action-buttons"},na=ze(Z({__name:"AIAnalysisPreview",props:{analysisResult:{},categories:{default:()=>[]}},emits:["product-created","cancel","field-modified"],setup(e,{emit:n}){const M=e,P=n,E=re(),U=Y(!1),F=Y(!1),T=Y(new Set);ee(()=>{var e;return(null==(e=M.analysisResult)?void 0:e.extracted_data)||{}});const L=ee(()=>{var e;return(null==(e=M.analysisResult)?void 0:e.confidence_scores)||{}}),D=ee(()=>{var e;return(null==(e=M.analysisResult)?void 0:e.document_info)||{}}),S=ee(()=>{var e;return(null==(e=M.analysisResult)?void 0:e.summary)||""}),B=ee(()=>{var e;return(null==(e=M.analysisResult)?void 0:e.text_preview)||""}),$=ae({basic_info:{name:"",code:"",category:"",base_price:0,description:""},specifications:{},features:[],application_scenarios:[],accessories:[],certificates:[],support_info:{warranty:{period:"",coverage:"",terms:[]},contact_info:{},service_promises:[]}}),N=["变压器","开关设备","保护装置","测量仪表","控制设备","电源设备","传输设备","其他"],G=ee(()=>{var e;const a=(null==(e=L.value)?void 0:e.overall)||0;return a>=.8?"success":a>=.6?"warning":"danger"}),q=ee(()=>{const e=L.value||{},{overall:a}=e;return((e,a)=>{var l={};for(var n in e)t.call(e,n)&&a.indexOf(n)<0&&(l[n]=e[n]);if(null!=e&&s)for(var n of s(e))a.indexOf(n)<0&&i.call(e,n)&&(l[n]=e[n]);return l})(e,["overall"])}),J=ee(()=>Object.keys($.specifications).length>0),W=ee(()=>$.features.length>0),K=ee(()=>{var e,a,l;const s=[];return(null==(e=$.basic_info.name)?void 0:e.trim())||s.push("产品名称不能为空"),(null==(a=$.basic_info.code)?void 0:a.trim())||s.push("产品代码不能为空"),(null==(l=$.basic_info.category)?void 0:l.trim())||s.push("产品分类不能为空"),s}),X=(e,a)=>{if(!a||"object"!=typeof a||Array.isArray(a))return e;const l=c({},e);for(const s in a)if(a.hasOwnProperty(s)){const e=a[s],t=l[s];null!=e&&(Array.isArray(e)?l[s]=[...e]:"object"!=typeof e||"object"!=typeof t||Array.isArray(t)?l[s]=e:l[s]=X(t||{},e))}return l},H=e=>{var a,l,s,t,i,n,c,o;const r=[],d=[];return(null==(l=null==(a=e.basic_info)?void 0:a.name)?void 0:l.trim())||r.push("产品名称缺失"),(null==(t=null==(s=e.basic_info)?void 0:s.code)?void 0:t.trim())||r.push("产品代码缺失"),(null==(n=null==(i=e.basic_info)?void 0:i.category)?void 0:n.trim())||d.push("产品分类缺失"),(null==(o=null==(c=e.basic_info)?void 0:c.description)?void 0:o.trim())||d.push("产品描述缺失"),0===(e.specifications?Object.keys(e.specifications).length:0)&&d.push("技术规格参数缺失"),{issues:r,warnings:d,valid:0===r.length}},Q=(e,a)=>{try{const e=a.summary||"",l=a.extracted_data||{};let s=!1;const t={};if(e){const a=e.match(/Product:\s*([^|]+?)(?:\s*\||\s*$)/i),l=e.match(/Model:\s*([^|]+?)(?:\s*\||\s*$)/i),i=e.match(/Category:\s*([^|]+?)(?:\s*\||\s*$)/i);a&&a[1]&&(t.name=a[1].trim(),s=!0),l&&l[1]&&(t.code=l[1].trim(),s=!0),i&&i[1]&&(t.category=i[1].trim(),s=!0)}if(!s&&l.specifications&&Object.keys(l.specifications).length>0){const e=Object.keys(l.specifications).join(" ").toLowerCase();e.includes("继电")||e.includes("保护")||e.includes("测试")?(t.name=t.name||"继电保护测试设备",t.category=t.category||"保护装置",s=!0):e.includes("变压器")?(t.name=t.name||"电力变压器",t.category=t.category||"变压器设备",s=!0):(t.name=t.name||"电力设备",t.category=t.category||"电力设备",s=!0),t.code||(t.code="AUTO_".concat(Date.now()))}return{repaired:s,data:t}}catch(l){return{repaired:!1,data:{}}}};le(()=>M.analysisResult,e=>{var a,l,s,t,i,n,c,o,r,d,u,f,p,v,m,_;if(null==e?void 0:e.extracted_data){e.extracted_data.basic_info;try{const a=X({basic_info:{name:"",code:"",category:"",base_price:0,description:""},specifications:{},features:[],application_scenarios:[],accessories:[],certificates:[],support_info:{warranty:{period:"",coverage:"",terms:[]},contact_info:{},service_promises:[]}},e.extracted_data);if(!a.basic_info.name||!a.basic_info.code||!a.basic_info.category){const l=Q(0,e);l.repaired&&Object.assign(a.basic_info,l.data)}Object.assign($,a),a.basic_info,H(a)}catch(y){try{const y={basic_info:{name:(null==(l=null==(a=e.extracted_data)?void 0:a.basic_info)?void 0:l.name)||"",code:(null==(t=null==(s=e.extracted_data)?void 0:s.basic_info)?void 0:t.code)||"",category:(null==(n=null==(i=e.extracted_data)?void 0:i.basic_info)?void 0:n.category)||"",description:(null==(o=null==(c=e.extracted_data)?void 0:c.basic_info)?void 0:o.description)||"",base_price:(null==(d=null==(r=e.extracted_data)?void 0:r.basic_info)?void 0:d.base_price)||0,is_active:!0,is_configurable:!1},specifications:(null==(u=e.extracted_data)?void 0:u.specifications)||{},features:(null==(f=e.extracted_data)?void 0:f.features)||[],application_scenarios:(null==(p=e.extracted_data)?void 0:p.application_scenarios)||[],accessories:(null==(v=e.extracted_data)?void 0:v.accessories)||[],certificates:(null==(m=e.extracted_data)?void 0:m.certificates)||[],support_info:(null==(_=e.extracted_data)?void 0:_.support_info)||{warranty:{period:"",coverage:"",terms:[]},contact_info:{},service_promises:[]}};if(!y.basic_info.name&&e.summary){const a=Q(0,e);a.repaired&&Object.assign(y.basic_info,a.data)}Object.assign($,y)}catch(h){}}}},{immediate:!0,deep:!0});const Z=e=>({basic_info:"基础信息",specifications:"技术规格",features:"产品特性",applications:"应用场景",certificates:"认证信息"}[e]||e),ye=e=>e>=.8?"#67C23A":e>=.6?"#E6A23C":"#F56C6C",he=e=>e>=.8?"success":e>=.6?"warning":"danger",ge=(e,a)=>{var l;const s="".concat(e,".").concat(a),t=(null==(l=L.value)?void 0:l[e])||0;return T.value.has(s)?"field-modified":t>=.8?"field-high-confidence":t>=.6?"field-medium-confidence":"field-low-confidence"},we=e=>{const a=e.split(".");let l=$;for(const s of a)l=null==l?void 0:l[s];return l},ke=e=>{T.value.add(e),P("field-modified",e,we(e))},xe=()=>{const e="规格".concat(Object.keys($.specifications).length+1);$.specifications[e]={value:"",unit:"",description:""}},Ce=()=>{$.features.push({title:"",description:"",icon:"",sort_order:$.features.length})},ze=()=>{var e;(null==(e=M.analysisResult)?void 0:e.extracted_data)&&(Object.assign($,M.analysisResult.extracted_data),T.value.clear(),Ae.success("已重置为原始分析结果"))},na=()=>o(this,null,function*(){var e,s,t,i,n,o,r,d,f;if(K.value.length>0)Ae.error("请先解决表单验证问题");else if((null==(e=$.basic_info.name)?void 0:e.trim())&&(null==(s=$.basic_info.code)?void 0:s.trim())&&(null==(t=$.basic_info.category)?void 0:t.trim()))try{if(yield u.confirm("确认要基于这些信息创建产品吗？","确认创建",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}),U.value=!0,!H($).valid){const e=Q(0,M.analysisResult);e.repaired&&(Object.assign($.basic_info,e.data),Ae.success("已自动修复部分缺失的产品信息"))}const e=(e=>{const a={},l=[/^h$/i,/^[a-z]$/i,/^\d+$/,/hyperlink/i,/^(EMBED|MERGEFORMAT|CERTIFICATE|PACKING|PAGE|TEST)$/i,/^(Toc\d+|_Toc|_Ref)/i,/^\d+\s+(HYPERLINK|PAGE|EMBED)/i,/^[\s\-_=]+$/],s=["电压","电流","功率","频率","温度","湿度","精度","范围","容量","voltage","current","power","frequency","temperature","V","A","W","Hz","℃","℉","%","Ω"];for(const[t,i]of Object.entries(e)){if(!t||!t.trim())continue;const e=t.trim(),n="object"==typeof i?(null==i?void 0:i.value)||"":String(i),c="".concat(e," ").concat(n).toLowerCase();let o=!1;for(const a of l)if((a.test(e)||a.test(c))&&!s.some(e=>c.includes(e.toLowerCase()))){o=!0;break}o||(a[e]=i)}return a})($.specifications);if(Object.keys(e).length!==Object.keys($.specifications).length){const a=Object.keys($.specifications).length-Object.keys(e).length;$.specifications=e,Ae.info("已自动过滤 ".concat(a," 个无效的规格参数"))}const s={name:String($.basic_info.name||"").trim().replace(/<[^>]*>/g,"").substring(0,200),code:String($.basic_info.code||"").trim().replace(/[^a-zA-Z0-9\-_]/g,"").substring(0,50),category:String($.basic_info.category||"").trim().replace(/<[^>]*>/g,"").substring(0,100),description:String($.basic_info.description||"").trim().replace(/<script[^>]*>.*?<\/script>/gi,"").substring(0,2e3),base_price:Math.max(0,Math.min(Number($.basic_info.base_price)||0,1e7)),is_active:Boolean(!1!==$.basic_info.is_active),is_configurable:Boolean($.basic_info.is_configurable)};if(!s.name||!s.code||!s.category)throw new Error("处理后的基础信息仍然不完整，请检查数据");const t=Object.fromEntries(Array.from(T.value).map(e=>[e,we(e)])),o={analysis_id:M.analysisResult.analysis_id,product_data:(d=c({},$),f={basic_info:s},a(d,l(f))),user_modifications:t},r=yield be(o),v=(null==r?void 0:r.data)||r;if(!v||!v.success){let e="创建失败";throw(null==v?void 0:v.error)?e="string"==typeof v.error?v.error:v.error.message||v.error.detail||"创建失败":(null==v?void 0:v.message)?e=v.message:v||(e="服务器无响应，请检查网络连接"),new Error(e)}Ae.success("产品创建成功，正在跳转到产品详情页..."),P("product-created",(null==(i=v.product)?void 0:i.id)||(null==(n=v.data)?void 0:n.id));try{const e=useProductsStore();yield e.refreshProducts()}catch(p){}setTimeout(()=>{var e,a;const l=(null==(e=v.product)?void 0:e.id)||(null==(a=v.data)?void 0:a.id);l&&E.push("/products/".concat(l))},1500)}catch(v){if("cancel"!==v){let e="创建产品失败";if(null==(r=null==(o=v.response)?void 0:o.data)?void 0:r.error){const a=v.response.data.error;if(a.includes("Product code already exists")){e="产品代码已存在，正在自动生成新代码",Ae.warning(e);const a=Date.now().toString().slice(-6);return $.basic_info.code="".concat($.basic_info.code,"_").concat(a),ke("basic_info.code"),void setTimeout(()=>{Ae.info("正在重新尝试创建产品..."),na()},1e3)}e=a.includes("Unable to generate unique product code")?"无法生成唯一的产品代码，请手动修改产品代码后重试":a.includes("Data validation failed")?"产品数据验证失败，请检查必填字段是否完整":a.includes("analysis_id")?"分析记录异常，请重新分析文档":a}else v.message&&(e=v.message);Ae.error(e)}}finally{U.value=!1}else Ae.error("请确保产品名称、代码和分类都已填写")});return(e,a)=>{const l=p,s=m,t=O,i=r,n=h,c=y,o=_,u=I,M=g,P=b,E=d,T=A,X=f;return _e(),se("div",Ve,[te(i,{class:"summary-card"},{header:oe(()=>[ce("div",je,[ce("span",Oe,[te(l,null,{default:oe(()=>[te(ve(v))]),_:1}),a[12]||(a[12]=pe(" 分析结果概览 ",-1))]),te(s,{type:G.value,size:"large"},{default:oe(()=>{var e;return[pe(" 总体置信度: "+de((100*(null==(e=L.value)?void 0:e.overall)||0).toFixed(0))+"% ",1)]}),_:1},8,["type"])])]),default:oe(()=>{var e,l;return[ce("div",Ie,[ce("div",Re,[a[13]||(a[13]=ce("span",{class:"label"},"文档名称:",-1)),ce("span",Me,de((null==(e=D.value)?void 0:e.filename)||"N/A"),1)]),ce("div",Pe,[a[14]||(a[14]=ce("span",{class:"label"},"分析摘要:",-1)),ce("span",Ee,de(S.value||"无摘要信息"),1)]),ce("div",Ue,[a[15]||(a[15]=ce("span",{class:"label"},"分析时长:",-1)),ce("span",Fe,de((null==(l=D.value)?void 0:l.analysis_duration)||0)+"秒",1)])]),ce("div",Te,[a[16]||(a[16]=ce("h4",null,"各模块置信度",-1)),ce("div",Le,[(_e(!0),se(ue,null,fe(q.value,(e,a)=>(_e(),se("div",{key:a,class:"confidence-item"},[ce("span",De,de(Z(a)),1),te(t,{percentage:100*(e||0),color:ye(e||0),"stroke-width":8},null,8,["percentage","color"]),ce("span",Se,de((100*(e||0)).toFixed(0))+"%",1)]))),128))])])]}),_:1}),te(i,{class:"data-section"},{header:oe(()=>{var e;return[ce("div",Be,[ce("span",$e,[te(l,null,{default:oe(()=>[te(ve(w))]),_:1}),a[17]||(a[17]=pe(" 基础信息 ",-1))]),te(s,{type:he((null==(e=L.value)?void 0:e.basic_info)||0),size:"small"},{default:oe(()=>{var e;return[pe(de((100*(null==(e=L.value)?void 0:e.basic_info)||0).toFixed(0))+"% ",1)]}),_:1},8,["type"])])]}),default:oe(()=>[ce("div",Ne,[te(o,{gutter:20},{default:oe(()=>[te(c,{span:12},{default:oe(()=>[ce("div",Ge,[a[18]||(a[18]=ce("label",{class:"field-label"},"产品名称 *",-1)),te(n,{modelValue:$.basic_info.name,"onUpdate:modelValue":a[0]||(a[0]=e=>$.basic_info.name=e),class:me(ge("basic_info","name")),placeholder:"请输入产品名称",onChange:a[1]||(a[1]=e=>ke("basic_info.name"))},null,8,["modelValue","class"])])]),_:1}),te(c,{span:12},{default:oe(()=>[ce("div",qe,[a[19]||(a[19]=ce("label",{class:"field-label"},"产品代码 *",-1)),te(n,{modelValue:$.basic_info.code,"onUpdate:modelValue":a[2]||(a[2]=e=>$.basic_info.code=e),class:me(ge("basic_info","code")),placeholder:"请输入产品代码",onChange:a[3]||(a[3]=e=>ke("basic_info.code"))},null,8,["modelValue","class"])])]),_:1})]),_:1}),te(o,{gutter:20},{default:oe(()=>[te(c,{span:12},{default:oe(()=>[ce("div",Je,[a[20]||(a[20]=ce("label",{class:"field-label"},"产品分类 *",-1)),te(M,{modelValue:$.basic_info.category,"onUpdate:modelValue":a[4]||(a[4]=e=>$.basic_info.category=e),class:me(ge("basic_info","category")),placeholder:"选择或输入分类",filterable:"","allow-create":"",style:{width:"100%"},onChange:a[5]||(a[5]=e=>ke("basic_info.category"))},{default:oe(()=>[(_e(),se(ue,null,fe(N,e=>te(u,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue","class"])])]),_:1}),te(c,{span:12},{default:oe(()=>[ce("div",We,[a[21]||(a[21]=ce("label",{class:"field-label"},"基础价格",-1)),te(P,{modelValue:$.basic_info.base_price,"onUpdate:modelValue":a[6]||(a[6]=e=>$.basic_info.base_price=e),class:me(ge("basic_info","base_price")),precision:2,min:0,style:{width:"100%"},onChange:a[7]||(a[7]=e=>ke("basic_info.base_price"))},null,8,["modelValue","class"])])]),_:1})]),_:1}),ce("div",Ke,[a[22]||(a[22]=ce("label",{class:"field-label"},"产品描述",-1)),te(n,{modelValue:$.basic_info.description,"onUpdate:modelValue":a[8]||(a[8]=e=>$.basic_info.description=e),class:me(ge("basic_info","description")),type:"textarea",rows:3,placeholder:"请输入产品描述",onChange:a[9]||(a[9]=e=>ke("basic_info.description"))},null,8,["modelValue","class"])])])]),_:1}),J.value?(_e(),ie(i,{key:0,class:"data-section"},{header:oe(()=>{var e;return[ce("div",Xe,[ce("span",He,[te(l,null,{default:oe(()=>[te(ve(x))]),_:1}),a[23]||(a[23]=pe(" 技术规格 ",-1))]),te(s,{type:he((null==(e=L.value)?void 0:e.specifications)||0),size:"small"},{default:oe(()=>{var e;return[pe(de((100*(null==(e=L.value)?void 0:e.specifications)||0).toFixed(0))+"% ",1)]}),_:1},8,["type"])])]}),default:oe(()=>[ce("div",Qe,[(_e(!0),se(ue,null,fe($.specifications,(e,a)=>(_e(),se("div",{key:a,class:"spec-item"},[te(o,{gutter:16,align:"middle"},{default:oe(()=>[te(c,{span:6},{default:oe(()=>[te(n,{value:a,readonly:"",size:"small",class:"spec-key"},null,8,["value"])]),_:2},1024),te(c,{span:6},{default:oe(()=>[te(n,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,size:"small",placeholder:"值",onChange:e=>ke("specifications.".concat(a,".value"))},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),te(c,{span:4},{default:oe(()=>[te(n,{modelValue:e.unit,"onUpdate:modelValue":a=>e.unit=a,size:"small",placeholder:"单位",onChange:e=>ke("specifications.".concat(a,".unit"))},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),te(c,{span:6},{default:oe(()=>[te(n,{modelValue:e.description,"onUpdate:modelValue":a=>e.description=a,size:"small",placeholder:"描述",onChange:e=>ke("specifications.".concat(a,".description"))},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1024),te(c,{span:2},{default:oe(()=>[te(E,{type:"danger",size:"small",onClick:e=>(e=>{delete $.specifications[e]})(a)},{default:oe(()=>[te(l,null,{default:oe(()=>[te(ve(R))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),te(E,{type:"primary",size:"small",onClick:xe},{default:oe(()=>[te(l,null,{default:oe(()=>[te(ve(k))]),_:1}),a[24]||(a[24]=pe(" 添加规格 ",-1))]),_:1,__:[24]})])]),_:1})):ne("",!0),W.value?(_e(),ie(i,{key:1,class:"data-section"},{header:oe(()=>{var e;return[ce("div",Ze,[ce("span",Ye,[te(l,null,{default:oe(()=>[te(ve(C))]),_:1}),a[25]||(a[25]=pe(" 产品特性 ",-1))]),te(s,{type:he((null==(e=L.value)?void 0:e.features)||0),size:"small"},{default:oe(()=>{var e;return[pe(de((100*(null==(e=L.value)?void 0:e.features)||0).toFixed(0))+"% ",1)]}),_:1},8,["type"])])]}),default:oe(()=>[ce("div",ea,[(_e(!0),se(ue,null,fe($.features,(e,s)=>(_e(),se("div",{key:s,class:"feature-item"},[te(i,{size:"small"},{default:oe(()=>[te(o,{gutter:16},{default:oe(()=>[te(c,{span:8},{default:oe(()=>[a[26]||(a[26]=ce("label",{class:"field-label"},"特性标题",-1)),te(n,{modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,placeholder:"特性标题",onChange:e=>ke("features.".concat(s,".title"))},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2,__:[26]},1024),te(c,{span:14},{default:oe(()=>[a[27]||(a[27]=ce("label",{class:"field-label"},"特性描述",-1)),te(n,{modelValue:e.description,"onUpdate:modelValue":a=>e.description=a,type:"textarea",rows:2,placeholder:"详细描述",onChange:e=>ke("features.".concat(s,".description"))},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2,__:[27]},1024),te(c,{span:2},{default:oe(()=>[te(E,{type:"danger",size:"small",onClick:e=>(e=>{$.features.splice(e,1)})(s)},{default:oe(()=>[te(l,null,{default:oe(()=>[te(ve(R))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),te(E,{type:"primary",size:"small",onClick:Ce},{default:oe(()=>[te(l,null,{default:oe(()=>[te(ve(k))]),_:1}),a[28]||(a[28]=pe(" 添加特性 ",-1))]),_:1,__:[28]})])]),_:1})):ne("",!0),te(i,{class:"text-preview"},{header:oe(()=>[ce("div",aa,[ce("span",la,[te(l,null,{default:oe(()=>[te(ve(z))]),_:1}),a[29]||(a[29]=pe(" 文档内容预览 ",-1))]),te(E,{size:"small",onClick:a[10]||(a[10]=e=>F.value=!F.value)},{default:oe(()=>[pe(de(F.value?"收起":"展开"),1)]),_:1})])]),default:oe(()=>[ce("div",sa,[te(T,{height:F.value?"300px":"100px"},{default:oe(()=>[ce("pre",ta,de(B.value),1)]),_:1},8,["height"])])]),_:1}),ce("div",ia,[te(E,{type:"primary",size:"large",loading:U.value,onClick:na},{default:oe(()=>[te(l,null,{default:oe(()=>[te(ve(V))]),_:1}),pe(" "+de(U.value?"创建中...":"创建产品并查看详情"),1)]),_:1},8,["loading"]),te(E,{size:"large",onClick:a[11]||(a[11]=a=>e.$emit("cancel"))},{default:oe(()=>a[30]||(a[30]=[pe(" 取消 ",-1)])),_:1,__:[30]}),te(E,{type:"info",size:"large",onClick:ze},{default:oe(()=>[te(l,null,{default:oe(()=>[te(ve(j))]),_:1}),a[31]||(a[31]=pe(" 重置修改 ",-1))]),_:1,__:[31]})]),K.value.length>0?(_e(),ie(X,{key:2,title:"发现 ".concat(K.value.length," 个问题需要处理"),type:"warning",closable:!1,class:"validation-alert"},{default:oe(()=>[ce("ul",null,[(_e(!0),se(ue,null,fe(K.value,e=>(_e(),se("li",{key:e},de(e),1))),128))])]),_:1},8,["title"])):ne("",!0)])}}}),[["__scopeId","data-v-824ece81"]]),ca={class:"enhanced-single-analysis"},oa={class:"upload-content"},ra={key:0,class:"file-info"},da={class:"file-item"},ua={class:"file-details"},fa={class:"file-name"},pa={class:"file-size"},va={class:"file-type"},ma={class:"analysis-actions"},_a={key:0,class:"analysis-progress"},ya={class:"progress-text"},ha={class:"progress-time"},ga={class:"model-status"},ba={class:"status-item"},wa={class:"status-item"},ka={class:"status-value"},xa={class:"status-item"},Ca={class:"document-preview"},Aa={class:"preview-content"},za={class:"preview-meta"},Va={key:0,class:"analysis-results"},ja={class:"result-header"},Oa={class:"result-actions"},Ia=ze(Z({__name:"EnhancedSingleAnalysis",emits:["analysis-success","analysis-error"],setup(e,{emit:a}){const l=a,s=Y(),t=Y(!1),i=Y([]),n=Y(null),c=Y(null),u=ae({type:"comprehensive",depth:"detailed",focus:["basic_info","specifications","features"],confidence_threshold:.7}),f=ae({percentage:0,status:"",text:"准备开始分析...",estimated_time:0}),v=ae({online:!0,response_time:850,load:45}),h=Y(null),b=ee(()=>n.value&&!t.value),w=(e,a)=>{i.value=a,e.raw&&(n.value=e.raw,A(e.raw))},x=()=>{i.value=[],n.value=null,h.value=null,c.value=null},C=e=>{const a=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain"].includes(e.type),l=e.size/1024/1024<10;return a?(l||Ae.error("文件大小不能超过 10MB"),!1):(Ae.error("只支持 PDF、Word、TXT 格式的文件"),!1)},A=e=>o(this,null,function*(){const a=yield j(e);h.value={text_preview:a.substring(0,300)+(a.length>300?"...":""),word_count:a.split(/\s+/).length,page_count:Math.ceil(a.length/2e3),language:R(a)}}),j=e=>new Promise(a=>{if("text/plain"===e.type){const l=new FileReader;l.onload=e=>{var l;a((null==(l=e.target)?void 0:l.result)||"")},l.readAsText(e)}else a("这是一个示例文档内容，实际内容将通过服务器端解析获取...")}),R=e=>/[\u4e00-\u9fff]/.test(e)?"中文":"英文",N=()=>o(this,null,function*(){if(n.value)try{t.value=!0,c.value=null,f.percentage=0,f.status="",f.text="准备开始分析...",f.estimated_time=60;const a=we();if(a.userRole,!a.isAuthenticated)throw new Error("请先登录后再使用AI分析功能");f.text="检查AI服务状态...";try{yield ke(()=>import("./api-BHu6TLr6.js").then(e=>e.B),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>e.getSupportedFormats())}catch(e){throw new Error("AI分析服务暂时不可用，请稍后重试或联系管理员")}if(!["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain"].includes(n.value.type))throw new Error("不支持的文件格式：".concat(n.value.type,"，请上传 PDF、Word 或 TXT 文件"));const s=setInterval(()=>{f.percentage<90&&(f.percentage+=10*Math.random(),f.estimated_time=Math.max(0,f.estimated_time-3),f.percentage<30?f.text="正在解析文档结构...":f.percentage<60?f.text="正在提取关键信息...":f.text="正在生成分析结果...")},1e3);f.text="连接AI分析服务...";const i=yield xe(n.value);clearInterval(s);const o=i.data;if(!o||!o.success){let e="分析失败，请稍后重试";throw(null==o?void 0:o.error)&&(e=o.error.includes("No document file")?"未检测到文档文件，请重新上传":o.error.includes("Document contains no readable text")?"文档内容无法读取，请检查文件是否损坏或为空白文档":o.error.includes("Document analysis failed")?"AI分析引擎暂时无法处理此文档，请稍后重试":o.error.includes("timeout")?"分析超时，请尝试上传较小的文档或稍后重试":o.error.includes("permission")?"权限不足，请联系管理员":"分析失败：".concat(o.error)),new Error(e)}f.percentage=100,f.status="success",f.text="分析完成！",f.estimated_time=0,c.value=o,l("analysis-success",o),Ae.success("文档分析完成！")}catch(a){let e="分析过程中发生未知错误",s="";if(a instanceof Error)e=a.message,s=e.includes("权限不足")?"请联系管理员授予分析权限":e.includes("网络")?"请检查网络连接":e.includes("服务不可用")?"请稍后重试或联系技术支持":e.includes("文件格式")?"请上传支持的文件格式（PDF/Word/TXT）":e.includes("超时")?"请尝试上传较小的文件":"请稍后重试，如问题持续请联系技术支持";else if("string"==typeof a)e=a;else if(a&&"object"==typeof a)if(a.response){const l=a.response.status;switch(l){case 401:e="登录已过期，请重新登录",s="重新登录后再试";break;case 403:e="权限不足，无法访问AI分析功能",s="请联系管理员授予相应权限";break;case 404:e="AI分析服务未找到",s="请联系技术支持检查服务配置";break;case 500:e="服务器内部错误",s="请稍后重试或联系技术支持";break;default:e="服务请求失败 (".concat(l,")"),s="请稍后重试"}}else e=JSON.stringify(a);f.status="exception",f.text="分析失败";const t=s?"".concat(e,"。建议：").concat(s):e;l("analysis-error",t),Ae.error(t)}finally{t.value=!1}}),G=()=>{Ae.success("分析结果已保存")},q=()=>{c.value&&Ae.info("正在跳转到产品创建页面...")},J=()=>{if(c.value){const e=JSON.stringify(c.value,null,2),a=new Blob([e],{type:"application/json"}),l=URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download="analysis-result-".concat(Date.now(),".json"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l),Ae.success("分析结果已导出")}},W=e=>{Ae.success("产品创建成功，ID: ".concat(e))},K=(e,a)=>{},X=e=>{if(e<60)return"".concat(e,"秒");const a=Math.floor(e/60),l=e%60;return"".concat(a,"分").concat(l,"秒")};return(e,a)=>{const l=p,o=M,A=r,j=I,R=g,H=U,Q=T,Z=F,Y=D,ee=L,ae=S,le=E,re=y,ue=d,fe=O,me=m,ye=_;return _e(),se("div",ca,[te(ye,{gutter:20},{default:oe(()=>[te(re,{span:12},{default:oe(()=>[te(A,{class:"upload-card"},{header:oe(()=>a[4]||(a[4]=[ce("h3",null,"文档上传",-1)])),default:oe(()=>{return[te(o,{ref_key:"uploadRef",ref:s,class:"document-uploader",drag:"","auto-upload":!1,multiple:!1,"file-list":i.value,"on-change":w,"on-remove":x,"before-upload":C,accept:".pdf,.docx,.doc,.txt"},{default:oe(()=>[ce("div",oa,[te(l,{class:"upload-icon"},{default:oe(()=>[te(ve(P))]),_:1}),a[5]||(a[5]=ce("div",{class:"upload-text"},[ce("p",null,[pe("将文档拖拽到此处或"),ce("em",null,"点击上传")]),ce("p",{class:"upload-tip"},"支持 PDF、Word、TXT 格式，单个文件不超过10MB")],-1))])]),_:1},8,["file-list"]),n.value?(_e(),se("div",ra,[ce("div",da,[te(l,{class:"file-icon"},{default:oe(()=>[te(ve(z))]),_:1}),ce("div",ua,[ce("div",fa,de(n.value.name),1),ce("div",pa,de((t=n.value.size,t<1024?"".concat(t," B"):t<1048576?"".concat((t/1024).toFixed(1)," KB"):"".concat((t/1024/1024).toFixed(1)," MB"))),1),ce("div",va,de((e=n.value.type,{"application/pdf":"PDF文档","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word文档","application/msword":"Word文档","text/plain":"文本文件"}[e]||"未知格式")),1)])])])):ne("",!0)];var e,t}),_:1}),te(A,{class:"config-card"},{header:oe(()=>a[6]||(a[6]=[ce("h3",null,"分析配置",-1)])),default:oe(()=>[te(le,{"label-width":"100px"},{default:oe(()=>[te(H,{label:"分析类型"},{default:oe(()=>[te(R,{modelValue:u.type,"onUpdate:modelValue":a[0]||(a[0]=e=>u.type=e),style:{width:"100%"}},{default:oe(()=>[te(j,{label:"产品信息提取",value:"product_extraction"}),te(j,{label:"文档分类",value:"document_classification"}),te(j,{label:"质量评估",value:"quality_assessment"}),te(j,{label:"综合分析",value:"comprehensive"})]),_:1},8,["modelValue"])]),_:1}),te(H,{label:"分析深度"},{default:oe(()=>[te(Z,{modelValue:u.depth,"onUpdate:modelValue":a[1]||(a[1]=e=>u.depth=e)},{default:oe(()=>[te(Q,{value:"basic"},{default:oe(()=>a[7]||(a[7]=[pe("基础",-1)])),_:1,__:[7]}),te(Q,{value:"detailed"},{default:oe(()=>a[8]||(a[8]=[pe("详细",-1)])),_:1,__:[8]}),te(Q,{value:"comprehensive"},{default:oe(()=>a[9]||(a[9]=[pe("全面",-1)])),_:1,__:[9]})]),_:1},8,["modelValue"])]),_:1}),te(H,{label:"提取重点"},{default:oe(()=>[te(ee,{modelValue:u.focus,"onUpdate:modelValue":a[2]||(a[2]=e=>u.focus=e)},{default:oe(()=>[te(Y,{value:"basic_info"},{default:oe(()=>a[10]||(a[10]=[pe("基本信息",-1)])),_:1,__:[10]}),te(Y,{value:"specifications"},{default:oe(()=>a[11]||(a[11]=[pe("技术规格",-1)])),_:1,__:[11]}),te(Y,{value:"features"},{default:oe(()=>a[12]||(a[12]=[pe("产品特性",-1)])),_:1,__:[12]}),te(Y,{value:"pricing"},{default:oe(()=>a[13]||(a[13]=[pe("价格信息",-1)])),_:1,__:[13]}),te(Y,{value:"quality"},{default:oe(()=>a[14]||(a[14]=[pe("质量标准",-1)])),_:1,__:[14]})]),_:1},8,["modelValue"])]),_:1}),te(H,{label:"置信度"},{default:oe(()=>[te(ae,{modelValue:u.confidence_threshold,"onUpdate:modelValue":a[3]||(a[3]=e=>u.confidence_threshold=e),min:.3,max:.9,step:.1,"show-stops":"","show-input":"","input-size":"small"},null,8,["modelValue"]),a[15]||(a[15]=ce("div",{class:"config-tip"},"设置最低置信度阈值，低于此值的结果将被标记",-1))]),_:1,__:[15]})]),_:1})]),_:1})]),_:1}),te(re,{span:12},{default:oe(()=>[te(A,{class:"action-card"},{header:oe(()=>a[16]||(a[16]=[ce("h3",null,"分析控制",-1)])),default:oe(()=>[ce("div",ma,[te(ue,{type:"primary",size:"large",loading:t.value,onClick:N,disabled:!b.value,class:"analyze-btn"},{icon:oe(()=>[te(l,null,{default:oe(()=>[te(ve(B))]),_:1})]),default:oe(()=>[pe(" "+de(t.value?"分析中...":"开始智能分析"),1)]),_:1},8,["loading","disabled"]),t.value?(_e(),se("div",_a,[te(fe,{percentage:f.percentage,status:f.status,"stroke-width":8},null,8,["percentage","status"]),ce("div",ya,de(f.text),1),ce("div",ha," 预计剩余时间: "+de(X(f.estimated_time)),1)])):ne("",!0)])]),_:1}),te(A,{class:"model-status-card"},{header:oe(()=>a[17]||(a[17]=[ce("h3",null,"AI模型状态",-1)])),default:oe(()=>{return[ce("div",ga,[ce("div",ba,[a[18]||(a[18]=ce("span",{class:"status-label"},"智谱AI GLM-4",-1)),te(me,{type:v.online?"success":"danger",size:"small"},{default:oe(()=>[pe(de(v.online?"在线":"离线"),1)]),_:1},8,["type"])]),ce("div",wa,[a[19]||(a[19]=ce("span",{class:"status-label"},"响应时间",-1)),ce("span",ka,de(v.response_time)+"ms",1)]),ce("div",xa,[a[20]||(a[20]=ce("span",{class:"status-label"},"负载状态",-1)),te(fe,{percentage:v.load,color:(e=v.load,e<50?"#67c23a":e<80?"#e6a23c":"#f56c6c"),"show-text":!1,"stroke-width":6},null,8,["percentage","color"])])])];var e}),_:1}),h.value?(_e(),ie(A,{key:0,class:"preview-card"},{header:oe(()=>a[21]||(a[21]=[ce("h3",null,"文档预览",-1)])),default:oe(()=>[ce("div",Ca,[ce("div",Aa,de(h.value.text_preview),1),ce("div",za,[ce("span",null,"字数: "+de(h.value.word_count),1),ce("span",null,"页数: "+de(h.value.page_count),1),ce("span",null,"语言: "+de(h.value.language),1)])])]),_:1})):ne("",!0)]),_:1})]),_:1}),c.value?(_e(),se("div",Va,[te(A,{class:"result-card"},{header:oe(()=>[ce("div",ja,[a[25]||(a[25]=ce("h3",null,"分析结果",-1)),ce("div",Oa,[te(ue,{type:"success",size:"small",onClick:G},{icon:oe(()=>[te(l,null,{default:oe(()=>[te(ve(V))]),_:1})]),default:oe(()=>[a[22]||(a[22]=pe(" 保存结果 ",-1))]),_:1,__:[22]}),te(ue,{type:"primary",size:"small",onClick:q},{icon:oe(()=>[te(l,null,{default:oe(()=>[te(ve(k))]),_:1})]),default:oe(()=>[a[23]||(a[23]=pe(" 创建产品 ",-1))]),_:1,__:[23]}),te(ue,{type:"info",size:"small",onClick:J},{icon:oe(()=>[te(l,null,{default:oe(()=>[te(ve($))]),_:1})]),default:oe(()=>[a[24]||(a[24]=pe(" 导出结果 ",-1))]),_:1,__:[24]})])])]),default:oe(()=>[te(na,{analysisResult:c.value,onProductCreated:W,onFieldModified:K},null,8,["analysisResult"])]),_:1})])):ne("",!0)])}}}),[["__scopeId","data-v-a9e1ed2a"]]),Ra={class:"recent-analysis-results"},Ma={key:0,class:"empty-state"},Pa={key:1,class:"results-list"},Ea=["onClick"],Ua={class:"result-header"},Fa={class:"result-title"},Ta={class:"document-name"},La={class:"result-status"},Da={key:0,class:"result-content"},Sa={class:"result-summary"},Ba={class:"result-details"},$a={class:"detail-item"},Na={class:"detail-item"},Ga={class:"detail-item"},qa={class:"result-metrics"},Ja={class:"metric-item"},Wa={class:"metric-value"},Ka={class:"metric-item"},Xa={class:"metric-value"},Ha={class:"result-features"},Qa={class:"feature-count"},Za={class:"feature-count"},Ya={class:"feature-count"},el={key:1,class:"result-error"},al={class:"result-footer"},ll={class:"result-meta"},sl={class:"meta-item"},tl={class:"meta-item"},il={key:0,class:"meta-item"},nl={class:"result-actions"},cl=ze(Z({__name:"RecentAnalysisResults",props:{results:{}},emits:["result-selected","start-analysis"],setup(e,{emit:a}){const l=a,s=e=>{const a=new Date(e),l=(new Date).getTime()-a.getTime(),s=Math.floor(l/6e4),t=Math.floor(l/36e5),i=Math.floor(l/864e5);return s<1?"刚刚":s<60?"".concat(s,"分钟前"):t<24?"".concat(t,"小时前"):i<7?"".concat(i,"天前"):a.toLocaleDateString("zh-CN")},t=(e,a="待确认")=>{if(!e||"string"==typeof e&&!e.trim())return a;if("string"==typeof e){const l=e.trim();return["未识别","未知","unknown","N/A","null","undefined","待定","无"].some(e=>l.toLowerCase().includes(e.toLowerCase()))||l.length<2?a:l}if("number"==typeof e)return e.toString();if("object"==typeof e){if(Array.isArray(e))return e.length>0?"".concat(e.length,"项"):a;if(void 0!==e.value)return t(e.value,a)}return String(e)||a},i=e=>{const a=t(e,"");return!e||a.includes("待确认")||a.includes("待定")?"value-pending":"string"==typeof e&&e.trim().length>=2||"number"==typeof e&&e>0?"value-valid":"value-normal"};return(e,a)=>{const n=d,c=N,o=p,r=m,u=O,v=ye("Menu"),_=f;return _e(),se("div",Ra,[0===e.results.length?(_e(),se("div",Ma,[te(c,{description:"暂无分析结果"},{default:oe(()=>[te(n,{type:"primary",onClick:a[0]||(a[0]=a=>e.$emit("start-analysis"))},{default:oe(()=>a[1]||(a[1]=[pe("开始分析",-1)])),_:1,__:[1]})]),_:1})])):(_e(),se("div",Pa,[(_e(!0),se(ue,null,fe(e.results,(c,d)=>{var f,p,m,y,h,g,b,w,k,x,A,V,j,O,I,R,M,P,E,U,F,T,L,D,S,B;return _e(),se("div",{key:d,class:"result-item",onClick:a=>e.$emit("result-selected",c)},[ce("div",Ua,[ce("div",Fa,[te(o,{class:"result-icon"},{default:oe(()=>[c.success?(_e(),ie(ve(z),{key:0})):(_e(),ie(ve(G),{key:1}))]),_:2},1024),ce("span",Ta,de(c.document_info.filename),1)]),ce("div",La,[te(r,{type:c.success?"success":"danger",size:"small"},{default:oe(()=>[pe(de(c.success?"成功":"失败"),1)]),_:2},1032,["type"])])]),c.success?(_e(),se("div",Da,[ce("div",Sa,de(c.summary),1),ce("div",Ba,[ce("div",$a,[a[2]||(a[2]=ce("span",{class:"detail-label"},"产品名称:",-1)),ce("span",{class:me(["detail-value",i(null==(p=null==(f=c.extracted_data)?void 0:f.basic_info)?void 0:p.name)])},de(t(null==(y=null==(m=c.extracted_data)?void 0:m.basic_info)?void 0:y.name,"产品名称待确认")),3)]),ce("div",Na,[a[3]||(a[3]=ce("span",{class:"detail-label"},"产品代码:",-1)),ce("span",{class:me(["detail-value",i(null==(g=null==(h=c.extracted_data)?void 0:h.basic_info)?void 0:g.code)])},de(t(null==(w=null==(b=c.extracted_data)?void 0:b.basic_info)?void 0:w.code,"代码待确认")),3)]),ce("div",Ga,[a[4]||(a[4]=ce("span",{class:"detail-label"},"产品分类:",-1)),ce("span",{class:me(["detail-value",i(null==(x=null==(k=c.extracted_data)?void 0:k.basic_info)?void 0:x.category)])},de(t(null==(V=null==(A=c.extracted_data)?void 0:A.basic_info)?void 0:V.category,"分类待确认")),3)])]),ce("div",qa,[ce("div",Ja,[a[5]||(a[5]=ce("span",{class:"metric-label"},"整体置信度:",-1)),te(u,{percentage:Math.round(100*((null==(j=c.confidence_scores)?void 0:j.overall)||0)),color:(B=(null==(O=c.confidence_scores)?void 0:O.overall)||0,B>=.8?"#67c23a":B>=.6?"#e6a23c":"#f56c6c"),"stroke-width":6,"show-text":!1,style:{width:"80px"}},null,8,["percentage","color"]),ce("span",Wa,de(Math.round(100*((null==(I=c.confidence_scores)?void 0:I.overall)||0)))+"% ",1)]),ce("div",Ka,[a[6]||(a[6]=ce("span",{class:"metric-label"},"完整性:",-1)),te(u,{percentage:Math.round(100*((null==(R=c.validation)?void 0:R.completeness_score)||0)),color:(S=(null==(M=c.validation)?void 0:M.completeness_score)||0,S>=.9?"#67c23a":S>=.7?"#e6a23c":"#f56c6c"),"stroke-width":6,"show-text":!1,style:{width:"80px"}},null,8,["percentage","color"]),ce("span",Xa,de(Math.round(100*((null==(P=c.validation)?void 0:P.completeness_score)||0)))+"% ",1)])]),ce("div",Ha,[ce("div",Qa,[te(o,null,{default:oe(()=>[te(v)]),_:1}),ce("span",null,"规格 "+de(Object.keys((null==(E=c.extracted_data)?void 0:E.specifications)||{}).length)+" 项",1)]),ce("div",Za,[te(o,null,{default:oe(()=>[te(ve(C))]),_:1}),ce("span",null,"特性 "+de((null==(F=null==(U=c.extracted_data)?void 0:U.features)?void 0:F.length)||0)+" 项",1)]),ce("div",Ya,[te(o,null,{default:oe(()=>[te(ve(q))]),_:1}),ce("span",null,"认证 "+de((null==(L=null==(T=c.extracted_data)?void 0:T.certificates)?void 0:L.length)||0)+" 项",1)])])])):(_e(),se("div",el,[te(_,{title:c.error||"分析失败",type:"error",closable:!1,"show-icon":""},null,8,["title"])])),ce("div",al,[ce("div",ll,[ce("span",sl,[te(o,null,{default:oe(()=>[te(ve(J))]),_:1}),pe(" "+de(s(c.analysis_timestamp)),1)]),ce("span",tl,[te(o,null,{default:oe(()=>[te(ve(z))]),_:1}),pe(" "+de((D=c.document_info.size,D<1024?"".concat(D," B"):D<1048576?"".concat((D/1024).toFixed(1)," KB"):"".concat((D/1024/1024).toFixed(1)," MB"))),1)]),c.document_info.analysis_duration?(_e(),se("span",il,[te(o,null,{default:oe(()=>[te(ve(W))]),_:1}),pe(" "+de(c.document_info.analysis_duration)+"s ",1)])):ne("",!0)]),ce("div",nl,[c.success?(_e(),ie(n,{key:0,type:"primary",size:"small",text:"",onClick:he(e=>(e=>{l("result-selected",e)})(c),["stop"])},{default:oe(()=>a[7]||(a[7]=[pe(" 查看详情 ",-1)])),_:2,__:[7]},1032,["onClick"])):ne("",!0),c.success?(_e(),ie(n,{key:1,type:"success",size:"small",text:"",onClick:he(e=>{Ae.info("跳转到产品创建页面...")},["stop"])},{default:oe(()=>a[8]||(a[8]=[pe(" 创建产品 ",-1)])),_:2,__:[8]},1032,["onClick"])):ne("",!0),te(n,{type:"info",size:"small",text:"",onClick:he(e=>(e=>{const a=JSON.stringify(e,null,2),l=new Blob([a],{type:"application/json"}),s=URL.createObjectURL(l),t=document.createElement("a");t.href=s,t.download="analysis-".concat(e.document_info.filename,"-").concat(Date.now(),".json"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(s),Ae.success("分析结果已导出")})(c),["stop"])},{default:oe(()=>a[9]||(a[9]=[pe(" 导出结果 ",-1)])),_:2,__:[9]},1032,["onClick"])])])],8,Ea)}),128))]))])}}}),[["__scopeId","data-v-b23e10cd"]]),ol={class:"ai-analysis-enhanced"},rl={class:"analysis-container"},dl={class:"feature-cards"},ul={class:"card-content"},fl={class:"card-content"},pl={class:"card-content"},vl={class:"card-content"},ml={key:0,class:"feature-content"},_l={key:0,class:"permission-warning"},yl={key:1,class:"feature-content"},hl={class:"batch-analysis-section"},gl={class:"quick-actions"},bl={key:0,class:"permission-hint"},wl={key:2,class:"feature-content"},kl={class:"comparison-section"},xl={class:"quick-actions"},Cl={key:0,class:"permission-hint"},Al={key:3,class:"feature-content"},zl={class:"optimization-section"},Vl={class:"quick-actions"},jl={key:0,class:"permission-hint"},Ol={class:"stats-overview"},Il={class:"stat-item"},Rl={class:"stat-number"},Ml={class:"stat-item"},Pl={class:"stat-number"},El={class:"stat-item"},Ul={class:"stat-number"},Fl={class:"stat-item"},Tl={class:"stat-number"},Ll={class:"card-header"},Dl={class:"model-info"},Sl={class:"model-item"},Bl={class:"model-value"},$l={class:"model-item"},Nl={class:"model-value"},Gl=Z({__name:"AIAnalysisEnhanced",setup(e){const a=re(),l=we(),s=Y("single"),t=ee(()=>l.hasAIAnalysisRole),i=ee(()=>l.userRole),n=ee(()=>l.isAuthenticated),c=ae({totalAnalyses:0,successRate:0,avgConfidence:0,processingJobs:0}),u=Y([]),v=Y("online"),_=Y(850),y=e=>{Ae.success("分析完成！"),u.value.unshift(e),u.value.length>5&&(u.value=u.value.slice(0,5)),w()},h=e=>{Ae.error("分析失败: ".concat(e))},g=e=>{Ae.info("查看分析结果详情")},b=()=>{Ae.info("查看所有分析结果")},w=()=>o(this,null,function*(){if(t.value)try{const e=yield Ce({days:30});e.success&&(c.totalAnalyses=e.statistics.total_analyses,c.successRate=e.statistics.success_rate,c.avgConfidence=e.statistics.average_confidence)}catch(e){Ae.error("加载统计数据失败：请确认您有足够的权限")}}),k=()=>{const e=Math.random();v.value=e>.1?"online":"offline",_.value=Math.floor(500*Math.random())+600};return ge(()=>o(this,null,function*(){if(!n.value)return Ae.warning("请先登录后再使用AI分析功能"),void a.push("/login");if(!l.user&&l.token)try{yield l.loadUserProfile()}catch(e){return Ae.error("用户信息加载失败，请重新登录"),void a.push("/login")}if(!t.value)return Ae.error("抱歉，".concat(i.value," 角色无权访问AI分析功能。仅限 engineer、admin、manager 角色使用。")),void a.push("/dashboard");w(),k(),setInterval(k,3e4),Ae.success("AI智能分析系统已就绪，基于智谱AI GLM-4模型提供服务")})),(e,a)=>{const l=p,n=r,o=f,w=d,k=Q,x=m;return _e(),se("div",ol,[a[36]||(a[36]=ce("div",{class:"page-header"},[ce("h1",null,"AI智能分析增强版"),ce("p",{class:"page-description"},"基于智谱AI GLM-4模型，提供更智能、更准确的文档分析和数据提取")],-1)),ce("div",rl,[ce("div",dl,[te(n,{class:me(["feature-card",{active:"single"===s.value}]),onClick:a[0]||(a[0]=e=>s.value="single")},{default:oe(()=>[ce("div",ul,[te(l,{class:"card-icon"},{default:oe(()=>[te(ve(z))]),_:1}),a[7]||(a[7]=ce("h3",null,"单文档智能分析",-1)),a[8]||(a[8]=ce("p",null,"深度分析单个文档，提取结构化数据",-1))])]),_:1},8,["class"]),te(n,{class:me(["feature-card",{active:"batch"===s.value}]),onClick:a[1]||(a[1]=e=>s.value="batch")},{default:oe(()=>[ce("div",fl,[te(l,{class:"card-icon"},{default:oe(()=>[te(ve(K))]),_:1}),a[9]||(a[9]=ce("h3",null,"批量智能分析",-1)),a[10]||(a[10]=ce("p",null,"高效处理多个文档的批量分析任务",-1))])]),_:1},8,["class"]),te(n,{class:me(["feature-card",{active:"comparison"===s.value}]),onClick:a[2]||(a[2]=e=>s.value="comparison")},{default:oe(()=>[ce("div",pl,[te(l,{class:"card-icon"},{default:oe(()=>[te(ve(X))]),_:1}),a[11]||(a[11]=ce("h3",null,"智能文档对比",-1)),a[12]||(a[12]=ce("p",null,"AI驱动的多文档对比和差异分析",-1))])]),_:1},8,["class"]),te(n,{class:me(["feature-card",{active:"optimization"===s.value}]),onClick:a[3]||(a[3]=e=>s.value="optimization")},{default:oe(()=>[ce("div",vl,[te(l,{class:"card-icon"},{default:oe(()=>[te(ve(H))]),_:1}),a[13]||(a[13]=ce("h3",null,"Prompt智能优化",-1)),a[14]||(a[14]=ce("p",null,"基于历史数据优化AI提示词效果",-1))])]),_:1},8,["class"])]),te(n,{class:"main-feature-area"},{default:oe(()=>["single"===s.value?(_e(),se("div",ml,[a[15]||(a[15]=ce("div",{class:"feature-header"},[ce("h2",null,"单文档智能分析"),ce("p",null,"上传文档，AI将自动识别并提取关键信息，支持产品规格、技术参数、价格等数据")],-1)),t.value?(_e(),ie(Ia,{key:1,onAnalysisSuccess:y,onAnalysisError:h})):(_e(),se("div",_l,[te(o,{title:"权限不足",description:"当前角色 ".concat(i.value," 无权使用AI分析功能。请联系管理员分配 engineer、admin 或 manager 角色。"),type:"warning","show-icon":"",closable:!1},null,8,["description"])]))])):ne("",!0),"batch"===s.value?(_e(),se("div",yl,[a[18]||(a[18]=ce("div",{class:"feature-header"},[ce("h2",null,"批量智能分析"),ce("p",null,"一次性上传多个文档，系统将自动排队处理，提供实时进度监控")],-1)),ce("div",hl,[te(o,{title:"批量分析功能",type:"info",description:"此功能可在批量分析页面使用，点击下方按钮快速跳转","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}}),ce("div",gl,[te(w,{type:"primary",size:"large",disabled:!t.value,onClick:a[4]||(a[4]=a=>e.$router.push("/batch-analysis"))},{icon:oe(()=>[te(l,null,{default:oe(()=>[te(ve(K))]),_:1})]),default:oe(()=>[a[16]||(a[16]=pe(" 进入批量分析 ",-1))]),_:1,__:[16]},8,["disabled"]),t.value?ne("",!0):(_e(),se("div",bl,[te(k,{type:"warning",size:"small"},{default:oe(()=>a[17]||(a[17]=[pe("需要 engineer/admin/manager 权限",-1)])),_:1,__:[17]})]))])])])):ne("",!0),"comparison"===s.value?(_e(),se("div",wl,[a[21]||(a[21]=ce("div",{class:"feature-header"},[ce("h2",null,"智能文档对比"),ce("p",null,"上传多个文档进行AI驱动的智能对比，识别相似性和差异性")],-1)),ce("div",kl,[te(o,{title:"文档对比功能",type:"info",description:"此功能可在文档对比页面使用，点击下方按钮快速跳转","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}}),ce("div",xl,[te(w,{type:"primary",size:"large",disabled:!t.value,onClick:a[5]||(a[5]=a=>e.$router.push("/document-comparison"))},{icon:oe(()=>[te(l,null,{default:oe(()=>[te(ve(X))]),_:1})]),default:oe(()=>[a[19]||(a[19]=pe(" 进入文档对比 ",-1))]),_:1,__:[19]},8,["disabled"]),t.value?ne("",!0):(_e(),se("div",Cl,[te(k,{type:"warning",size:"small"},{default:oe(()=>a[20]||(a[20]=[pe("需要 engineer/admin/manager 权限",-1)])),_:1,__:[20]})]))])])])):ne("",!0),"optimization"===s.value?(_e(),se("div",Al,[a[24]||(a[24]=ce("div",{class:"feature-header"},[ce("h2",null,"Prompt智能优化"),ce("p",null,"基于历史分析数据，智能优化AI提示词，提升分析准确性和用户满意度")],-1)),ce("div",zl,[te(o,{title:"Prompt优化功能",type:"info",description:"此功能可在Prompt优化页面使用，点击下方按钮快速跳转","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}}),ce("div",Vl,[te(w,{type:"primary",size:"large",disabled:!t.value,onClick:a[6]||(a[6]=a=>e.$router.push("/prompt-optimization"))},{icon:oe(()=>[te(l,null,{default:oe(()=>[te(ve(H))]),_:1})]),default:oe(()=>[a[22]||(a[22]=pe(" 进入Prompt优化 ",-1))]),_:1,__:[22]},8,["disabled"]),t.value?ne("",!0):(_e(),se("div",jl,[te(k,{type:"warning",size:"small"},{default:oe(()=>a[23]||(a[23]=[pe("需要 engineer/admin/manager 权限",-1)])),_:1,__:[23]})]))])])])):ne("",!0)]),_:1}),ce("div",Ol,[te(n,{class:"stats-card"},{default:oe(()=>[ce("div",Il,[ce("div",Rl,de(c.totalAnalyses),1),a[25]||(a[25]=ce("div",{class:"stat-label"},"总分析次数",-1))])]),_:1}),te(n,{class:"stats-card"},{default:oe(()=>[ce("div",Ml,[ce("div",Pl,de((100*c.successRate).toFixed(1))+"%",1),a[26]||(a[26]=ce("div",{class:"stat-label"},"成功率",-1))])]),_:1}),te(n,{class:"stats-card"},{default:oe(()=>[ce("div",El,[ce("div",Ul,de(c.avgConfidence.toFixed(1)),1),a[27]||(a[27]=ce("div",{class:"stat-label"},"平均置信度",-1))])]),_:1}),te(n,{class:"stats-card"},{default:oe(()=>[ce("div",Fl,[ce("div",Tl,de(c.processingJobs),1),a[28]||(a[28]=ce("div",{class:"stat-label"},"处理中任务",-1))])]),_:1})])]),te(n,{class:"recent-results-card"},{header:oe(()=>[ce("div",Ll,[a[30]||(a[30]=ce("h3",null,"最近分析结果",-1)),te(w,{link:"",onClick:b},{default:oe(()=>a[29]||(a[29]=[pe("查看全部",-1)])),_:1,__:[29]})])]),default:oe(()=>[te(cl,{results:u.value,onResultSelected:g},null,8,["results"])]),_:1}),te(n,{class:"model-info-card"},{header:oe(()=>a[31]||(a[31]=[ce("h3",null,"AI模型信息",-1)])),default:oe(()=>[ce("div",Dl,[a[34]||(a[34]=ce("div",{class:"model-item"},[ce("div",{class:"model-label"},"当前模型"),ce("div",{class:"model-value"},"智谱AI GLM-4")],-1)),a[35]||(a[35]=ce("div",{class:"model-item"},[ce("div",{class:"model-label"},"模型版本"),ce("div",{class:"model-value"},"GLM-4-0520")],-1)),ce("div",Sl,[a[32]||(a[32]=ce("div",{class:"model-label"},"服务状态",-1)),ce("div",Bl,[te(x,{type:"online"===v.value?"success":"danger"},{default:oe(()=>[pe(de("online"===v.value?"在线":"离线"),1)]),_:1},8,["type"])])]),ce("div",$l,[a[33]||(a[33]=ce("div",{class:"model-label"},"响应时间",-1)),ce("div",Nl,de(_.value)+"ms",1)])])]),_:1})])}}});export{na as A,Gl as _};
