var Ve=Object.defineProperty;var r=(g,f)=>Ve(g,"name",{value:f,configurable:!0});var ee=(g,f,c)=>new Promise((R,$)=>{var H=z=>{try{V(c.next(z))}catch(O){$(O)}},K=z=>{try{V(c.throw(z))}catch(O){$(O)}},V=z=>z.done?R(z.value):Promise.resolve(z.value).then(H,K);V((c=c.apply(g,f)).next())});import{s as C,_ as ye}from"./index-CoBZUWE1.js";/* empty css                         *//* empty css                  *//* empty css                 *//* empty css                *//* empty css                *//* empty css                           */import{r as S,c as A,j as ge,S as Ne,x as we,y as T,A as t,K as D,D as ve,u as o,Q as e,I as s,O as x,H as N,M as i,P as ue,a6 as ce,z as _,J as Se,R as Ce,aC as He,n as We}from"./vendor-vue-XfLkFKXI.js";import{b as he,U as Je,an as Qe,c as ze,d as ke,ao as Te,l as Xe,ap as Ge,h as Ae,aq as Ke,D as Ye,j as be,ar as Ze,I as et,O as Ie,as as tt,at as st,au as at,J as Ee,av as Re,aw as De,ab as Pe,ac as Me,B as $e,ax as lt,i as nt,ad as Oe,aa as Be,al as ot,ay as it,ae as fe,a3 as rt,az as ut,a4 as ct,a8 as dt,aA as pt,a9 as _t,a5 as mt,a7 as vt}from"./vendor-ui-CE-ZhXxH.js";/* empty css                 *//* empty css                  */import{getSupportedFormats as ft,analyzeDocument as yt}from"./ai-analysis-DPd-iqke.js";/* empty css                     *//* empty css                   */import"./el-tooltip-l0sNRNKZ.js";import{A as gt}from"./AIAnalysisPreview-_TtnVAQb.js";import{p as wt}from"./products-CqbSQiZB.js";import"./vendor-pdf-BeW0Xq92.js";import"./vendor-utils-B8vW8fJV.js";/* empty css                 *//* empty css                        *//* empty css                  *//* empty css               */function Fe(){const g=S({status:"unknown",queue_size:0,processing_count:0,max_concurrent:3,last_check:new Date().toISOString()}),f=S({isAnalyzing:!1,estimatedTime:0,actualStartTime:null,remainingTime:0,confidence:0}),c=S({isOnline:navigator.onLine,latency:0,lastCheck:Date.now()}),R=A(()=>g.value.status==="healthy"),$=A(()=>g.value.status!=="unavailable"),H=A(()=>Math.round(g.value.queue_size/50*100)),K=A(()=>Math.round(g.value.processing_count/g.value.max_concurrent*100)),V=A(()=>{switch(g.value.status){case"healthy":return"服务正常";case"degraded":return"服务繁忙";case"unavailable":return"服务不可用";default:return"检查中..."}}),z=A(()=>{switch(g.value.status){case"healthy":return"success";case"degraded":return"warning";case"unavailable":return"danger";default:return"info"}});let O=null,X=null;const J=r(()=>ee(this,null,function*(){var p,m,v,P;try{const q=yield fetch("/api/v1/system/health");if(!q.ok)throw new Error("HTTP ".concat(q.status));const Q=yield q.json(),j={status:Q.status==="healthy"?"healthy":Q.status==="warning"?"degraded":"unavailable",queue_size:((p=Q.ai_analysis)==null?void 0:p.queue_size)||0,processing_count:((m=Q.ai_analysis)==null?void 0:m.processing_count)||0,max_concurrent:((v=Q.ai_analysis)==null?void 0:v.max_concurrent)||3,estimated_wait_time:Y(((P=Q.ai_analysis)==null?void 0:P.queue_size)||0),last_check:new Date().toISOString()};return j.status!=="healthy"&&(j.recommendations=y(j)),g.value=j,j}catch(q){return g.value={status:"unknown",queue_size:0,processing_count:0,max_concurrent:3,last_check:new Date().toISOString()},g.value}}),"checkServiceStatus"),Y=r(p=>{const v=g.value.max_concurrent;return Math.ceil(p*45/v)},"calculateWaitTime"),y=r(p=>{const m=[];return p.queue_size>20&&m.push("当前队列较长，建议稍后重试"),p.processing_count>=p.max_concurrent&&m.push("服务器处理能力已满，请等待当前任务完成"),p.status==="degraded"&&m.push("服务正在降级模式运行，处理时间可能延长"),p.status==="unavailable"&&m.push("服务暂时不可用，请检查网络连接或稍后重试"),m},"generateRecommendations"),F=r((p,m)=>{let v=30;const P=p/(1024*1024);switch(v+=P*5,m.toLowerCase()){case"pdf":v*=1.5;break;case"docx":case"doc":v*=1.3;break;case"txt":v*=.8;break;case"png":case"jpg":case"jpeg":v*=2;break}g.value.status==="degraded"&&(v*=1.5);const q=g.value.estimated_wait_time||0;return Math.round(v+q)},"estimateAnalysisTime"),U=r((p,m)=>{const v=F(p,m);f.value={isAnalyzing:!0,estimatedTime:v,actualStartTime:Date.now(),remainingTime:v,confidence:te()},X=window.setInterval(()=>{const P=(Date.now()-(f.value.actualStartTime||0))/1e3,q=Math.max(0,f.value.estimatedTime-P);f.value.remainingTime=q,P>f.value.estimatedTime*1.2&&(f.value.confidence=Math.max(20,f.value.confidence-10))},1e3)},"startAnalysisTimer"),W=r(()=>{X&&(clearInterval(X),X=null),f.value.isAnalyzing=!1,f.value.remainingTime=0},"stopAnalysisTimer"),te=r(p=>{let m=75;return g.value.status==="healthy"?m+=15:g.value.status==="degraded"?m-=20:m-=40,c.value.isOnline&&c.value.latency<200?m+=10:m-=15,Math.max(10,Math.min(95,m))},"calculateConfidence"),se=r(()=>ee(this,null,function*(){const p=Date.now();try{yield fetch("/api/v1/system/health",{method:"HEAD"}),c.value.latency=Date.now()-p,c.value.lastCheck=Date.now()}catch(m){c.value.latency=9999}}),"checkNetworkLatency"),w=r(p=>{const m=g.value.queue_size,v=g.value.status;return p==="timeout"?v==="healthy"&&m<10?{shouldRetry:!0,retryDelay:5e3,reason:"服务状态良好，建议立即重试"}:{shouldRetry:!0,retryDelay:3e4,reason:"服务繁忙，建议稍后重试"}:p==="network"?{shouldRetry:c.value.isOnline,retryDelay:c.value.isOnline?1e4:6e4,reason:c.value.isOnline?"网络已恢复，可以重试":"请检查网络连接"}:v==="unavailable"?{shouldRetry:!1,retryDelay:0,reason:"服务暂时不可用，请稍后再试"}:{shouldRetry:!0,retryDelay:15e3,reason:"可以重试，建议等待15秒"}},"getRetryRecommendation"),G=r(p=>{if(p<60)return"".concat(Math.round(p),"秒");if(p<3600){const m=Math.floor(p/60),v=Math.round(p%60);return"".concat(m,"分").concat(v,"秒")}else{const m=Math.floor(p/3600),v=Math.floor(p%3600/60);return"".concat(m,"小时").concat(v,"分钟")}},"formatTime"),u=r(()=>{J(),se(),O=window.setInterval(()=>{J(),se()},3e4)},"startStatusMonitoring"),h=r(()=>{O&&(clearInterval(O),O=null),W()},"stopStatusMonitoring"),k=r(()=>{c.value.isOnline=!0,J(),C.success("网络连接已恢复")},"handleOnline"),a=r(()=>{c.value.isOnline=!1,C.warning("网络连接已断开")},"handleOffline");return ge(()=>{u(),window.addEventListener("online",k),window.addEventListener("offline",a)}),Ne(()=>{h(),window.removeEventListener("online",k),window.removeEventListener("offline",a)}),{serviceStatus:A(()=>g.value),analysisStatus:A(()=>f.value),networkStatus:A(()=>c.value),isServiceHealthy:R,isServiceAvailable:$,queueUtilization:H,processingUtilization:K,serviceStatusText:V,serviceStatusColor:z,checkServiceStatus:J,estimateAnalysisTime:F,startAnalysisTimer:U,stopAnalysisTimer:W,getRetryRecommendation:w,formatTime:G,startStatusMonitoring:u,stopStatusMonitoring:h}}r(Fe,"useAIAnalysisStatus");const ht={class:"ai-service-status"},kt={class:"status-content"},bt={class:"status-icon"},xt={class:"status-text"},St={class:"status-value"},Ct={key:0,class:"status-metrics"},Tt={class:"metric"},At={class:"metric"},$t={class:"status-actions"},zt={class:"status-details"},It={class:"detail-section"},Et={class:"detail-grid"},Rt={class:"detail-item"},Dt={class:"detail-item"},Pt={class:"detail-item"},Mt={key:0,class:"detail-item"},Ot={key:0,class:"detail-section"},Bt={class:"recommendation-list"},Ft={class:"detail-section"},Ut={class:"detail-grid"},qt={class:"detail-item"},jt={class:"detail-item"},Lt={class:"detail-actions"},Vt={key:0,class:"analysis-progress-bar"},Nt={class:"progress-header"},Ht={class:"progress-time"},Wt={class:"progress-footer"},Jt={class:"confidence-indicator"},Qt={key:1,class:"offline-banner"},Xt=we({__name:"AIServiceStatus",setup(g){const{serviceStatus:f,analysisStatus:c,networkStatus:R,isServiceAvailable:$,queueUtilization:H,processingUtilization:K,serviceStatusText:V,serviceStatusColor:z,checkServiceStatus:O,formatTime:X}=Fe(),J=S(!1),Y=S(!1),y=A(()=>c.value.isAnalyzing),F=A(()=>c.value.remainingTime),U=A(()=>R.value.latency),W=A(()=>R.value.isOnline),te=A(()=>{if(!y.value)return 0;const{estimatedTime:G,actualStartTime:u}=c.value;if(!u)return 0;const h=(Date.now()-u)/1e3,k=Math.min(95,h/G*100);return Math.round(k)}),se=r(()=>ee(this,null,function*(){J.value=!0;try{yield O(),C.success("状态已更新")}catch(G){C.error("刷新失败")}finally{J.value=!1}}),"manualRefresh"),w=r(()=>ee(this,null,function*(){Y.value=!0;try{yield fetch("/api/v1/system/health",{method:"HEAD",cache:"no-cache"}),C.success("网络连接正常")}catch(G){C.error("网络连接失败")}finally{Y.value=!1}}),"checkConnection");return(G,u)=>{const h=he,k=Je,a=ke,p=be,m=Qe,v=ze;return _(),T("div",ht,[t("div",{class:ve(["status-bar","status-".concat(o(z))])},[t("div",kt,[t("div",bt,[e(h,{class:ve(["status-indicator",{pulse:y.value}])},{default:s(()=>[o(z)==="success"?(_(),N(o(Te),{key:0})):o(z)==="info"?(_(),N(o(Xe),{key:1})):o(z)==="warning"?(_(),N(o(Ge),{key:2})):(_(),N(o(Ae),{key:3}))]),_:1},8,["class"])]),t("div",xt,[u[0]||(u[0]=t("span",{class:"status-label"},"AI分析服务",-1)),t("span",St,x(o(V)),1)]),o($)?(_(),T("div",Ct,[e(k,{content:"队列使用率",placement:"top"},{default:s(()=>[t("div",Tt,[e(h,null,{default:s(()=>[e(o(Ke))]),_:1}),t("span",null,x(o(H))+"%",1)])]),_:1}),e(k,{content:"处理器使用率",placement:"top"},{default:s(()=>[t("div",At,[e(h,null,{default:s(()=>[e(o(Ye))]),_:1}),t("span",null,x(o(K))+"%",1)])]),_:1}),U.value<9999?(_(),N(k,{key:0,content:"网络延迟: ".concat(U.value,"ms"),placement:"top"},{default:s(()=>[t("div",{class:ve(["metric",{"metric-warning":U.value>500}])},[e(h,null,{default:s(()=>[e(o(Te))]),_:1}),t("span",null,x(U.value)+"ms",1)],2)]),_:1},8,["content"])):D("",!0)])):D("",!0),t("div",$t,[W.value?D("",!0):(_(),N(a,{key:0,type:"warning",size:"small",icon:"Refresh",onClick:w,loading:Y.value},{default:s(()=>u[1]||(u[1]=[i(" 重连 ",-1)])),_:1,__:[1]},8,["loading"])),e(m,{placement:"bottom-end",title:"服务详情",width:"320",trigger:"click"},{reference:s(()=>[e(a,{type:"primary",size:"small",icon:"InfoFilled",circle:"",disabled:!o($)},null,8,["disabled"])]),default:s(()=>{var P;return[t("div",zt,[t("div",It,[u[6]||(u[6]=t("h4",null,"服务状态",-1)),t("div",Et,[t("div",Rt,[u[2]||(u[2]=t("span",{class:"detail-label"},"状态:",-1)),e(p,{type:o(z),size:"small"},{default:s(()=>[i(x(o(V)),1)]),_:1},8,["type"])]),t("div",Dt,[u[3]||(u[3]=t("span",{class:"detail-label"},"队列长度:",-1)),t("span",null,x(o(f).queue_size),1)]),t("div",Pt,[u[4]||(u[4]=t("span",{class:"detail-label"},"处理中:",-1)),t("span",null,x(o(f).processing_count)+"/"+x(o(f).max_concurrent),1)]),o(f).estimated_wait_time?(_(),T("div",Mt,[u[5]||(u[5]=t("span",{class:"detail-label"},"预计等待:",-1)),t("span",null,x(o(X)(o(f).estimated_wait_time)),1)])):D("",!0)])]),(P=o(f).recommendations)!=null&&P.length?(_(),T("div",Ot,[u[7]||(u[7]=t("h4",null,"建议",-1)),t("ul",Bt,[(_(!0),T(ue,null,ce(o(f).recommendations,q=>(_(),T("li",{key:q},x(q),1))),128))])])):D("",!0),t("div",Ft,[u[10]||(u[10]=t("h4",null,"网络状态",-1)),t("div",Ut,[t("div",qt,[u[8]||(u[8]=t("span",{class:"detail-label"},"连接:",-1)),e(p,{type:W.value?"success":"danger",size:"small"},{default:s(()=>[i(x(W.value?"正常":"断开"),1)]),_:1},8,["type"])]),t("div",jt,[u[9]||(u[9]=t("span",{class:"detail-label"},"延迟:",-1)),t("span",null,x(U.value<9999?"".concat(U.value,"ms"):"无法测量"),1)])])]),t("div",Lt,[e(a,{size:"small",onClick:se,loading:J.value},{default:s(()=>[e(h,null,{default:s(()=>[e(o(Ze))]),_:1}),u[11]||(u[11]=i(" 刷新状态 ",-1))]),_:1,__:[11]},8,["loading"])])])]}),_:1})])])],2),y.value?(_(),T("div",Vt,[t("div",Nt,[u[12]||(u[12]=t("span",{class:"progress-title"},"正在分析文档...",-1)),t("span",Ht,x(F.value>0?"剩余约 ".concat(o(X)(F.value)):"即将完成"),1)]),e(v,{percentage:te.value,"show-text":!1,"stroke-width":6,color:"#409EFF",class:"progress-bar"},null,8,["percentage"]),t("div",Wt,[t("span",Jt,[e(h,null,{default:s(()=>[e(o(et))]),_:1}),i(" 预估准确度: "+x(o(c).confidence)+"% ",1)])])])):D("",!0),W.value?D("",!0):(_(),T("div",Qt,[e(h,null,{default:s(()=>[e(o(Ae))]),_:1}),u[14]||(u[14]=t("span",null,"网络连接已断开，请检查网络设置",-1)),e(a,{type:"text",onClick:w},{default:s(()=>u[13]||(u[13]=[i("重试连接",-1)])),_:1,__:[13]})]))])}}}),Gt=ye(Xt,[["__scopeId","data-v-c0e9c927"]]),Kt={class:"ai-document-upload"},Yt={class:"card-header"},Zt={class:"card-title"},es={class:"upload-area"},ts={class:"upload-content"},ss={class:"upload-text"},as={class:"upload-hint"},ls={key:0,class:"upload-actions"},ns={key:1,class:"analysis-progress"},os={class:"progress-text"},is={class:"progress-steps"},rs={class:"format-info"},us={class:"format-details"},cs={class:"format-category"},ds={class:"format-desc"},ps={key:0,class:"format-category"},_s={class:"format-note"},ms={key:0,class:"error-container"},vs={class:"error-content"},fs={class:"error-message"},ys={class:"error-detail-list"},gs={key:1,class:"error-suggestions"},ws={class:"suggestion-list"},hs={class:"error-actions"},ks=we({__name:"AIDocumentUpload",props:{disabled:{type:Boolean,default:!1},maxSize:{default:10}},emits:["analysis-start","analysis-success","analysis-error","analysis-complete"],setup(g,{expose:f,emit:c}){const R=g,$=c,{serviceStatus:H,isServiceAvailable:K,estimateAnalysisTime:V,startAnalysisTimer:z,stopAnalysisTimer:O,getRetryRecommendation:X,formatTime:J}=Fe(),Y=S(),y=S(null),F=S(!1),U=S(0),W=S(""),te=S(0),se=S(""),w=S(null),G=S([]),u=S(null),h=S(null),k=A(()=>{var n;return(((n=h.value)==null?void 0:n.ai_available)||!1)&&K.value}),a=A(()=>{var n,l,d;return((d=(l=(n=h.value)==null?void 0:n.document_formats)==null?void 0:l.availability)==null?void 0:d.ocr)||!1}),p=A(()=>{if(!h.value)return[];const n=h.value.document_formats.availability;return[{ext:"txt",description:"纯文本文件",available:!0},{ext:"pdf",description:"PDF文档",available:n.pdf},{ext:"docx",description:"Word文档",available:n.docx},{ext:"doc",description:"旧版Word文档",available:n.docx}]}),m=A(()=>["png","jpg","jpeg"]),v=A(()=>{var l,d,b,I,M,B;const n=["TXT"];return(b=(d=(l=h.value)==null?void 0:l.document_formats)==null?void 0:d.availability)!=null&&b.pdf&&n.push("PDF"),(B=(M=(I=h.value)==null?void 0:I.document_formats)==null?void 0:M.availability)!=null&&B.docx&&n.push("DOCX","DOC"),a.value&&n.push(...m.value.map(E=>E.toUpperCase())),n}),P=A(()=>{var l,d,b,I,M,B;const n=[".txt"];return(b=(d=(l=h.value)==null?void 0:l.document_formats)==null?void 0:d.availability)!=null&&b.pdf&&n.push(".pdf"),(B=(M=(I=h.value)==null?void 0:I.document_formats)==null?void 0:M.availability)!=null&&B.docx&&n.push(".docx",".doc"),a.value&&n.push(".png",".jpg",".jpeg"),n.join(",")});ge(()=>ee(this,null,function*(){yield q()}));const q=r(()=>ee(this,null,function*(){try{const n=yield ft();h.value=n.formats,n.formats.ai_available||C.warning("AI分析服务当前不可用，请检查配置")}catch(n){C.error("获取支持格式失败")}}),"loadSupportedFormats"),Q=r(n=>{var I;const l=R.maxSize*1024*1024;if(n.size>l)return C.error("文件大小不能超过 ".concat(R.maxSize,"MB")),!1;const d=(I=n.name.split(".").pop())==null?void 0:I.toLowerCase();return!d||!["txt","pdf","docx","doc","png","jpg","jpeg"].includes(d)?(C.error("不支持的文件格式"),!1):!0},"beforeUpload"),j=r((n,l)=>{n.raw&&(y.value=n.raw,ae())},"handleFileChange"),de=r(()=>{y.value=null,ae()},"handleFileRemove"),re=r(()=>{var n;(n=Y.value)==null||n.clearFiles(),y.value=null,ae(),xe(),O(),ne()},"clearFile"),ae=r(()=>{se.value="",w.value=null},"clearError"),ne=r(()=>{U.value=0,te.value=0,W.value=""},"resetProgress"),oe=r((n,l,d)=>{if(te.value=n,W.value=l,d!==void 0)U.value=d;else{const b=[10,40,85,100];U.value=b[n]||0}},"updateProgress"),ie=r(()=>ee(this,null,function*(){var l,d,b,I,M;if(!y.value||!k.value)return;F.value=!0,ne(),$("analysis-start");const n=((l=y.value.name.split(".").pop())==null?void 0:l.toLowerCase())||"";V(y.value.size,n),H.value.estimated_wait_time&&H.value.estimated_wait_time>10&&C.info("当前队列较长，预计等待 ".concat(J(H.value.estimated_wait_time))),z(y.value.size,n);try{oe(0,"准备上传文件..."),yield new Promise(le=>setTimeout(le,500)),oe(1,"正在解析文档内容...");const B=H.value.status==="degraded"?"正在进行AI分析 (降级模式)...":"正在进行AI智能分析...";oe(2,B);const E=yield yt(y.value);if(oe(3,"分析完成！",100),yield new Promise(le=>setTimeout(le,500)),E.success)O(),C.success("文档分析完成！"),$("analysis-success",E);else throw new Error(E.error||"分析失败")}catch(B){O();const E=((d=B.response)==null?void 0:d.data)||{},le=_e(B),Z=X(le);if(E.error_type&&E.error_details)w.value={title:((b=E.error_details)==null?void 0:b.title)||"文档分析失败",message:E.error||"分析过程中出现错误",details:((I=E.error_details)==null?void 0:I.details)||[],suggestions:[...((M=E.error_details)==null?void 0:M.suggestions)||[],Z.reason],error_type:E.error_type,retry_recommendation:Z};else{const pe=E.error||B.message||"分析过程中出现错误";w.value={title:"文档分析失败",message:pe,details:["系统遇到了预期之外的问题"],suggestions:[Z.reason,"检查文档是否正常","尝试其他格式的文档","联系技术支持"],error_type:le,retry_recommendation:Z}}Z.shouldRetry&&Z.retryDelay>0&&Ue(Z.retryDelay),C.error(w.value.message),$("analysis-error",w.value.message),ne()}finally{F.value=!1,$("analysis-complete")}}),"startAnalysis"),_e=r(n=>{var l,d,b;return n.code==="ECONNABORTED"||(l=n.message)!=null&&l.includes("timeout")?"timeout":n.code==="NETWORK_ERROR"||!navigator.onLine?"network":((d=n.response)==null?void 0:d.status)>=500?"server":((b=n.response)==null?void 0:b.status)===429?"rate_limit":"unknown"},"getErrorType"),Ue=r(n=>{u.value&&clearTimeout(u.value);let l=Math.ceil(n/1e3);const d=setInterval(()=>{l>0?(C.info("将在 ".concat(l," 秒后自动重试..."),{duration:1e3}),l--):clearInterval(d)},1e3);u.value=window.setTimeout(()=>{var b,I;clearInterval(d),y.value&&((I=(b=w.value)==null?void 0:b.retry_recommendation)!=null&&I.shouldRetry)&&(C.info("正在自动重试..."),me())},n)},"setupSmartRetry"),me=r(()=>{y.value&&(ae(),xe(),ie())},"retryAnalysis"),xe=r(()=>{u.value&&(clearTimeout(u.value),u.value=null)},"clearSmartRetry"),qe=r(()=>{var n,l,d;fe.alert("请联系技术支持并提供以下信息：\n\n• 错误类型: ".concat(((n=w.value)==null?void 0:n.error_type)||"未知","\n• 文件名称: ").concat(((l=y.value)==null?void 0:l.name)||"未知","\n• 文件大小: ").concat(y.value?(y.value.size/1024/1024).toFixed(2)+"MB":"未知","\n• 错误信息: ").concat(((d=w.value)==null?void 0:d.message)||"未知","\n\n技术支持邮箱: support@example.com\n技术支持QQ群: 123456789"),"联系技术支持",{confirmButtonText:"复制信息",showCancelButton:!0,cancelButtonText:"关闭",type:"info"}).then(()=>{var I,M,B;const b="错误类型: ".concat(((I=w.value)==null?void 0:I.error_type)||"未知","\n文件名称: ").concat(((M=y.value)==null?void 0:M.name)||"未知","\n文件大小: ").concat(y.value?(y.value.size/1024/1024).toFixed(2)+"MB":"未知","\n错误信息: ").concat(((B=w.value)==null?void 0:B.message)||"未知");navigator.clipboard?navigator.clipboard.writeText(b).then(()=>{C.success("错误信息已复制到剪贴板")}):C.info("请手动复制错误信息")}).catch(()=>{})},"contactSupport");return f({clearFile:re,startAnalysis:ie,retryAnalysis:me}),(n,l)=>{const d=he,b=be,I=st,M=ke,B=ze,E=De,le=Re,Z=Me,pe=Pe,je=Ie,Le=tt;return _(),T("div",Kt,[e(Gt,{class:"service-status"}),e(je,{class:"upload-card"},{header:s(()=>[t("div",Yt,[t("span",Zt,[e(d,null,{default:s(()=>[e(o($e))]),_:1}),l[1]||(l[1]=i(" AI文档分析 ",-1))]),k.value?D("",!0):(_(),N(b,{key:0,type:"warning",size:"small"},{default:s(()=>l[2]||(l[2]=[i(" AI服务不可用 ",-1)])),_:1,__:[2]}))])]),default:s(()=>[t("div",es,[e(I,{ref_key:"uploadRef",ref:Y,class:"document-upload",drag:"",action:"","auto-upload":!1,"show-file-list":!0,accept:P.value,"before-upload":Q,"on-change":j,"on-remove":de,disabled:F.value||!k.value},{default:s(()=>[t("div",ts,[e(d,{class:"upload-icon"},{default:s(()=>[e(o(at))]),_:1}),t("div",ss,[l[3]||(l[3]=t("p",null,[i("拖拽文件到这里，或"),t("em",null,"点击选择文件")],-1)),t("p",as," 支持格式: "+x(v.value.join(", ")),1),l[4]||(l[4]=t("p",{class:"upload-size"},"文件大小限制: 10MB",-1))])])]),_:1},8,["accept","disabled"]),y.value?(_(),T("div",ls,[e(M,{type:"primary",size:"large",loading:F.value,disabled:!y.value||!k.value,onClick:ie},{default:s(()=>[e(d,null,{default:s(()=>[e(o(Ee))]),_:1}),i(" "+x(F.value?"正在分析中...":"开始AI分析"),1)]),_:1},8,["loading","disabled"]),F.value?D("",!0):(_(),N(M,{key:0,size:"large",onClick:re},{default:s(()=>l[5]||(l[5]=[i(" 清除文件 ",-1)])),_:1,__:[5]}))])):D("",!0),F.value?(_(),T("div",ns,[e(B,{percentage:U.value,"show-text":!1,"stroke-width":8,color:"#409EFF"},null,8,["percentage"]),t("p",os,x(W.value),1),t("div",is,[e(le,{active:te.value,"align-center":""},{default:s(()=>[e(E,{title:"上传文件",icon:"Upload"}),e(E,{title:"文档解析",icon:"Reading"}),e(E,{title:"AI分析",icon:"MagicStick"}),e(E,{title:"完成",icon:"Check"})]),_:1},8,["active"])])])):D("",!0)]),t("div",rs,[e(pe,{modelValue:G.value,"onUpdate:modelValue":l[0]||(l[0]=L=>G.value=L)},{default:s(()=>[e(Z,{title:"支持的文档格式",name:"formats"},{default:s(()=>[t("div",us,[t("div",cs,[t("h4",null,[e(d,null,{default:s(()=>[e(o($e))]),_:1}),l[6]||(l[6]=i("文本文档",-1))]),(_(!0),T(ue,null,ce(p.value,L=>(_(),N(b,{key:L.ext,type:L.available?"success":"info",size:"small",class:"format-tag"},{default:s(()=>[i(x(L.ext.toUpperCase())+" ",1),t("span",ds,x(L.description),1)]),_:2},1032,["type"]))),128))]),a.value?(_(),T("div",ps,[t("h4",null,[e(d,null,{default:s(()=>[e(o(lt))]),_:1}),l[7]||(l[7]=i("图片文档 (OCR)",-1))]),(_(!0),T(ue,null,ce(m.value,L=>(_(),N(b,{key:L,type:"warning",size:"small",class:"format-tag"},{default:s(()=>[i(x(L.toUpperCase()),1)]),_:2},1024))),128)),t("p",_s,[e(d,null,{default:s(()=>[e(o(nt))]),_:1}),l[8]||(l[8]=i(" 图片将通过OCR技术提取文字内容进行分析 ",-1))])])):D("",!0)])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),w.value?(_(),T("div",ms,[e(Le,{title:w.value.title||"文档分析失败",type:"error",closable:!0,onClose:ae,class:"error-alert","show-icon":""},{default:s(()=>[t("div",vs,[t("p",fs,x(w.value.message),1),w.value.details?(_(),N(pe,{key:0,class:"error-details"},{default:s(()=>[e(Z,{title:"错误详情",name:"details"},{default:s(()=>[t("ul",ys,[(_(!0),T(ue,null,ce(w.value.details,L=>(_(),T("li",{key:L},x(L),1))),128))])]),_:1})]),_:1})):D("",!0),w.value.suggestions?(_(),T("div",gs,[t("h4",null,[e(d,null,{default:s(()=>[e(o(Oe))]),_:1}),l[9]||(l[9]=i("解决建议：",-1))]),t("ul",ws,[(_(!0),T(ue,null,ce(w.value.suggestions,L=>(_(),T("li",{key:L},x(L),1))),128))])])):D("",!0),t("div",hs,[e(M,{type:"primary",size:"small",onClick:me,disabled:!y.value},{default:s(()=>[e(d,null,{default:s(()=>[e(o(Be))]),_:1}),l[10]||(l[10]=i(" 重新尝试 ",-1))]),_:1,__:[10]},8,["disabled"]),e(M,{size:"small",onClick:re},{default:s(()=>[e(d,null,{default:s(()=>[e(o(ot))]),_:1}),l[11]||(l[11]=i(" 清除文件 ",-1))]),_:1,__:[11]}),e(M,{size:"small",onClick:qe},{default:s(()=>[e(d,null,{default:s(()=>[e(o(it))]),_:1}),l[12]||(l[12]=i(" 联系支持 ",-1))]),_:1,__:[12]})])])]),_:1},8,["title"])])):D("",!0)])}}}),bs=ye(ks,[["__scopeId","data-v-33919a90"]]),xs={class:"create-product-ai"},Ss={class:"page-header"},Cs={class:"header-content"},Ts={class:"page-title"},As={class:"step-content"},$s={class:"step-content"},zs={class:"card-title"},Is={class:"card-title"},Es={class:"help-content"},Rs=we({__name:"CreateProductAI",setup(g){const f=He(),c=S(0),R=S(null),$=S(null),H=S([]),K=S([]),V=S(),z=S();ge(()=>ee(this,null,function*(){yield O()})),A(()=>["上传文档","AI分析","结果预览","创建产品"]);const O=r(()=>ee(this,null,function*(){try{const k=yield wt.getCategories();H.value=k.categories||[]}catch(k){}}),"loadProductCategories"),X=r(()=>{c.value=1,R.value=null,C.info("开始分析文档...")},"handleAnalysisStart"),J=r(k=>{R.value=k,c.value=2,C.success("文档分析完成！请检查提取的信息"),We(()=>{var a;(a=document.querySelector(".step-content"))==null||a.scrollIntoView({behavior:"smooth",block:"start"})})},"handleAnalysisSuccess"),Y=r(k=>{C.error("分析失败: ".concat(k)),c.value=0},"handleAnalysisError"),y=r(()=>{},"handleAnalysisComplete"),F=r(k=>{R.value&&($.value={id:k,name:R.value.extracted_data.basic_info.name,code:R.value.extracted_data.basic_info.code}),c.value=3,C.success("产品创建成功！正在跳转到产品详情页...")},"handleProductCreated"),U=r(()=>{fe.confirm("确定要取消当前操作吗？未保存的数据将会丢失。","确认取消",{confirmButtonText:"确定",cancelButtonText:"继续编辑",type:"warning"}).then(()=>{w()}).catch(()=>{})},"handleCancel"),W=r((k,a)=>{},"handleFieldModified"),te=r(()=>{c.value>0&&c.value--},"goToPreviousStep"),se=r(()=>{fe.confirm("确定要重新开始吗？当前进度将会丢失。","重新开始",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{c.value=0,R.value=null,$.value=null,V.value&&V.value.clearFile(),C.success("已重置，请重新上传文档")}).catch(()=>{})},"resetWorkflow"),w=r(()=>{f.push({name:"Products"})},"goBack"),G=r(()=>{f.push({name:"CreateProduct"})},"goToTraditionalCreate"),u=r(()=>{$.value&&f.push({name:"ProductDetail",params:{id:$.value.id}})},"viewCreatedProduct"),h=r(()=>{se()},"createAnother");return document.title="AI智能产品创建 - CPQ系统",(k,a)=>{var ie;const p=ct,m=rt,v=he,P=De,q=Re,Q=Ie,j=ke,de=dt,re=ut,ae=Me,ne=be,oe=Pe;return _(),T("div",xs,[t("div",Ss,[e(m,{separator:"/"},{default:s(()=>[e(p,{to:{name:"products"}},{default:s(()=>a[1]||(a[1]=[i("产品管理",-1)])),_:1,__:[1]}),e(p,null,{default:s(()=>a[2]||(a[2]=[i("AI智能创建",-1)])),_:1,__:[2]})]),_:1}),t("div",Cs,[t("h1",Ts,[e(v,null,{default:s(()=>[e(o(Ee))]),_:1}),a[3]||(a[3]=i(" AI智能产品创建 ",-1))]),a[4]||(a[4]=t("p",{class:"page-description"}," 上传产品相关文档，AI将自动分析并提取产品信息，大幅提升产品录入效率 ",-1))])]),e(Q,{class:"steps-card"},{default:s(()=>[e(q,{active:c.value,"align-center":""},{default:s(()=>[e(P,{title:"上传文档",icon:"Upload"},{description:s(()=>a[5]||(a[5]=[i(" 上传产品相关文档 ",-1)])),_:1}),e(P,{title:"AI分析",icon:"MagicStick"},{description:s(()=>a[6]||(a[6]=[i(" AI智能提取产品信息 ",-1)])),_:1}),e(P,{title:"结果预览",icon:"View"},{description:s(()=>a[7]||(a[7]=[i(" 预览并确认分析结果 ",-1)])),_:1}),e(P,{title:"创建产品",icon:"Check"},{description:s(()=>a[8]||(a[8]=[i(" 确认创建产品 ",-1)])),_:1})]),_:1},8,["active"])]),_:1}),Se(t("div",As,[e(bs,{ref_key:"documentUploadRef",ref:V,onAnalysisStart:X,onAnalysisSuccess:J,onAnalysisError:Y,onAnalysisComplete:y},null,512)],512),[[Ce,c.value===0]]),Se(t("div",$s,[e(gt,{ref_key:"analysisPreviewRef",ref:z,"analysis-result":R.value,categories:H.value,onProductCreated:F,onCancel:U,onFieldModified:W},null,8,["analysis-result","categories"])],512),[[Ce,c.value>=1&&R.value]]),c.value===3&&$.value?(_(),N(re,{key:0,icon:"success",title:"产品创建成功！","sub-title":"产品 "+(((ie=$.value)==null?void 0:ie.name)||"")+" 已成功创建",class:"success-result"},{extra:s(()=>[e(de,null,{default:s(()=>[e(j,{type:"primary",onClick:u},{default:s(()=>a[9]||(a[9]=[i(" 查看产品详情 ",-1)])),_:1,__:[9]}),e(j,{onClick:h},{default:s(()=>a[10]||(a[10]=[i(" 继续创建 ",-1)])),_:1,__:[10]}),e(j,{onClick:w},{default:s(()=>a[11]||(a[11]=[i(" 返回产品列表 ",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["sub-title"])):D("",!0),c.value<3?(_(),N(Q,{key:1,class:"quick-actions"},{header:s(()=>[t("span",zs,[e(v,null,{default:s(()=>[e(o(vt))]),_:1}),a[12]||(a[12]=i(" 快速操作 ",-1))])]),default:s(()=>[e(de,{wrap:""},{default:s(()=>[c.value>0?(_(),N(j,{key:0,type:"info",onClick:te},{default:s(()=>[e(v,null,{default:s(()=>[e(o(pt))]),_:1}),a[13]||(a[13]=i(" 上一步 ",-1))]),_:1,__:[13]})):D("",!0),e(j,{type:"warning",onClick:se},{default:s(()=>[e(v,null,{default:s(()=>[e(o(Be))]),_:1}),a[14]||(a[14]=i(" 重新开始 ",-1))]),_:1,__:[14]}),e(j,{onClick:w},{default:s(()=>[e(v,null,{default:s(()=>[e(o(_t))]),_:1}),a[15]||(a[15]=i(" 返回列表 ",-1))]),_:1,__:[15]}),e(j,{type:"success",onClick:G},{default:s(()=>[e(v,null,{default:s(()=>[e(o(mt))]),_:1}),a[16]||(a[16]=i(" 传统创建 ",-1))]),_:1,__:[16]})]),_:1})]),_:1})):D("",!0),e(Q,{class:"help-card"},{header:s(()=>[t("span",Is,[e(v,null,{default:s(()=>[e(o(Oe))]),_:1}),a[17]||(a[17]=i(" 使用帮助 ",-1))])]),default:s(()=>[e(oe,{modelValue:K.value,"onUpdate:modelValue":a[0]||(a[0]=_e=>K.value=_e)},{default:s(()=>[e(ae,{title:"支持的文档格式",name:"formats"},{default:s(()=>a[18]||(a[18]=[t("div",{class:"help-content"},[t("p",null,[t("strong",null,"文本文档:"),i(" TXT, PDF, Word文档 (DOC/DOCX)")]),t("p",null,[t("strong",null,"图片文档:"),i(" PNG, JPG, JPEG (通过OCR识别)")]),t("p",null,[t("strong",null,"建议:"),i(" 文档内容越详细，AI提取的信息越准确")])],-1)])),_:1,__:[18]}),e(ae,{title:"最佳实践",name:"best-practices"},{default:s(()=>a[19]||(a[19]=[t("div",{class:"help-content"},[t("ul",null,[t("li",null,"使用包含完整产品规格的正式文档"),t("li",null,"确保文档中包含产品名称、型号等关键信息"),t("li",null,"技术参数表格式的文档效果更好"),t("li",null,"分析后请仔细检查并修正AI提取的信息")])],-1)])),_:1,__:[19]}),e(ae,{title:"置信度说明",name:"confidence"},{default:s(()=>[t("div",Es,[t("p",null,[a[21]||(a[21]=t("strong",null,"高置信度 (80%+):",-1)),a[22]||(a[22]=i()),e(ne,{type:"success",size:"small"},{default:s(()=>a[20]||(a[20]=[i("绿色",-1)])),_:1,__:[20]}),a[23]||(a[23]=i(" 信息准确，可直接使用",-1))]),t("p",null,[a[25]||(a[25]=t("strong",null,"中等置信度 (60-79%):",-1)),a[26]||(a[26]=i()),e(ne,{type:"warning",size:"small"},{default:s(()=>a[24]||(a[24]=[i("黄色",-1)])),_:1,__:[24]}),a[27]||(a[27]=i(" 建议人工核实",-1))]),t("p",null,[a[29]||(a[29]=t("strong",null,"低置信度 (<60%):",-1)),a[30]||(a[30]=i()),e(ne,{type:"danger",size:"small"},{default:s(()=>a[28]||(a[28]=[i("红色",-1)])),_:1,__:[28]}),a[31]||(a[31]=i(" 需要人工修正",-1))])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}}),aa=ye(Rs,[["__scopeId","data-v-9ab95708"]]);export{aa as default};
