var X=Object.defineProperty;var _=(M,$)=>X(M,"name",{value:$,configurable:!0});var B=(M,$,g)=>new Promise((a,w)=>{var C=v=>{try{x(g.next(v))}catch(q){w(q)}},y=v=>{try{x(g.throw(v))}catch(q){w(q)}},x=v=>v.done?a(v.value):Promise.resolve(v.value).then(C,y);x((g=g.apply(M,$)).next())});import{s as k,_ as Y}from"./index-CoBZUWE1.js";/* empty css                  *//* empty css                         *//* empty css               *//* empty css                        *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                *//* empty css                             */import{x as Z,r as T,j as tt,y as m,A as s,Q as o,H as D,K as f,I as e,aB as et,aC as at,M as u,O as i,z as r}from"./vendor-vue-XfLkFKXI.js";import{u as z}from"./quotes-BbFL_Tm9.js";import{c as st,u as ot}from"./unifiedChinesePDFGenerator-C7HpLm4O.js";import{d as lt,M as nt,aB as it,az as ut,N as rt,O as dt,a1 as ct,a2 as pt,j as _t,R as ft,S as vt,ae as A}from"./vendor-ui-CE-ZhXxH.js";import"./vendor-pdf-BeW0Xq92.js";import"./vendor-utils-B8vW8fJV.js";import"./settings-Dj-ToOIB.js";const mt={class:"quote-detail"},gt={class:"page-header"},yt={class:"header-actions"},bt={key:0,class:"quote-content"},kt={class:"card-header"},Dt={class:"total-amount"},wt={class:"product-info"},Ct={class:"product-code"},$t={key:0,class:"product-description"},xt={class:"line-total"},qt={class:"quote-totals"},Et={class:"totals-section"},St={class:"total-row"},Bt={key:0,class:"total-row"},Tt={key:1,class:"total-row"},Mt={class:"total-row final-total"},Qt={key:0},Ft={class:"notes-content"},ht={class:"terms-content"},Pt={class:"action-buttons"},Lt={class:"stats-content"},Nt={class:"stat-item"},It={class:"stat-value"},jt={class:"stat-item"},Rt={class:"stat-value"},Vt={key:1,class:"loading"},zt={key:2,class:"error"},At=Z({__name:"QuoteDetail",setup(M){const $=et(),g=at(),a=T(null),w=T(!1),C=T(!1),y=T(!1),x=T(!0),v=_(n=>({draft:"info",pending:"warning",approved:"success",rejected:"danger",expired:"warning"})[n]||"info","getStatusType"),q=_(n=>({draft:"草稿",pending:"待审批",approved:"已审批",rejected:"已拒绝",expired:"已过期"})[n]||n.charAt(0).toUpperCase()+n.slice(1),"formatStatus"),h=_(n=>n?new Date(n).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):"暂无","formatDate"),P=_(n=>({pending:"提交审批",approved:"批准",rejected:"拒绝"})[n]||n,"getStatusAction"),O=_(()=>{var c;if(!((c=a.value)!=null&&c.valid_until))return"暂无";const n=new Date(a.value.valid_until),t=new Date,d=n.getTime()-t.getTime(),E=Math.ceil(d/(1e3*60*60*24));return E<0?"已过期":E===0?"今天":"".concat(E,"天")},"getDaysUntilExpiry"),Q=_(n=>B(this,null,function*(){if(a.value)try{const t="您确定要".concat(P(n),"这个报价吗？");yield A.confirm(t,"确认状态变更",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),y.value=!0;const d={status:n};yield z.updateQuote(a.value.id,d),a.value.status=n,k.success("报价".concat(P(n),"成功"))}catch(t){t!=="cancel"&&k.error("更新报价状态失败")}finally{y.value=!1}}),"updateStatus"),U=_(()=>{a.value&&g.push("/quotes/".concat(a.value.id,"/edit"))},"editQuote"),G=_(()=>B(this,null,function*(){if(a.value)try{yield A.confirm("这将创建一个具有相同项目和客户信息的新报价单。继续吗？","复制报价",{confirmButtonText:"创建复制",cancelButtonText:"取消",type:"info"}),k.info("复制功能将在下一个版本中实现")}catch(n){}}),"duplicateQuote"),L=_(()=>B(this,null,function*(){if(a.value)try{C.value=!0;const n=yield st(a.value);yield ot.downloadPDF(n,"报价单-".concat(a.value.quote_number)),k.success("PDF生成成功")}catch(n){k.error("生成PDF失败")}finally{C.value=!1}}),"generatePDF"),H=_(()=>B(this,null,function*(){const n=parseInt($.params.id);if(isNaN(n)){k.error("无效的报价ID"),g.push("/quotes");return}w.value=!0;try{const t=yield z.getQuote(n);a.value=t.quote}catch(t){k.error("加载报价失败")}finally{w.value=!1}}),"loadQuote");return tt(()=>{H()}),(n,t)=>{var j;const d=lt,E=_t,c=pt,N=ct,b=dt,S=vt,K=ft,F=rt,I=nt,J=it,W=ut;return r(),m("div",mt,[s("div",gt,[t[8]||(t[8]=s("h1",null,"报价详情",-1)),s("div",yt,[o(d,{onClick:t[0]||(t[0]=l=>n.$router.go(-1))},{default:e(()=>t[5]||(t[5]=[u("返回",-1)])),_:1,__:[5]}),((j=a.value)==null?void 0:j.status)==="draft"?(r(),D(d,{key:0,type:"primary",onClick:U},{default:e(()=>t[6]||(t[6]=[u(" 编辑 ",-1)])),_:1,__:[6]})):f("",!0),o(d,{type:"success",onClick:L,loading:C.value,icon:"Download"},{default:e(()=>t[7]||(t[7]=[u(" 导出PDF ",-1)])),_:1,__:[7]},8,["loading"])])]),a.value?(r(),m("div",bt,[o(I,{gutter:20},{default:e(()=>[o(F,{span:16},{default:e(()=>[o(b,{class:"quote-info-card"},{header:e(()=>[s("div",kt,[t[9]||(t[9]=s("span",{class:"card-title"},"报价信息",-1)),o(E,{type:v(a.value.status),size:"large"},{default:e(()=>[u(i(q(a.value.status)),1)]),_:1},8,["type"])])]),default:e(()=>[o(N,{column:2,border:""},{default:e(()=>[o(c,{label:"报价单号"},{default:e(()=>[s("strong",null,i(a.value.quote_number),1)]),_:1}),o(c,{label:"版本"},{default:e(()=>[u(i(a.value.version||1),1)]),_:1}),o(c,{label:"创建日期"},{default:e(()=>[u(i(h(a.value.created_at)),1)]),_:1}),o(c,{label:"有效期至"},{default:e(()=>[u(i(h(a.value.valid_until)),1)]),_:1}),o(c,{label:"创建人"},{default:e(()=>{var l;return[u(i(((l=a.value.created_by_user)==null?void 0:l.name)||"未知"),1)]}),_:1}),o(c,{label:"总金额"},{default:e(()=>{var l;return[s("strong",Dt,"$"+i((l=a.value.total_price)==null?void 0:l.toLocaleString()),1)]}),_:1})]),_:1})]),_:1}),o(b,{class:"customer-info-card"},{header:e(()=>t[10]||(t[10]=[s("span",{class:"card-title"},"客户信息",-1)])),default:e(()=>[o(N,{column:2,border:""},{default:e(()=>[o(c,{label:"客户名称"},{default:e(()=>[u(i(a.value.customer_name),1)]),_:1}),o(c,{label:"邮箱"},{default:e(()=>[u(i(a.value.customer_email),1)]),_:1}),o(c,{label:"公司"},{default:e(()=>[u(i(a.value.customer_company||"暂无"),1)]),_:1}),o(c,{label:"电话"},{default:e(()=>[u(i(a.value.customer_phone||"暂无"),1)]),_:1}),o(c,{label:"地址",span:2},{default:e(()=>[u(i(a.value.customer_address||"暂无"),1)]),_:1})]),_:1})]),_:1}),o(b,{class:"items-card"},{header:e(()=>t[11]||(t[11]=[s("span",{class:"card-title"},"报价项目",-1)])),default:e(()=>[o(K,{data:a.value.items||[],style:{width:"100%"},class:"items-table"},{default:e(()=>[o(S,{label:"产品","min-width":"200"},{default:e(({row:l})=>{var p,R,V;return[s("div",wt,[s("strong",null,i((p=l.product)==null?void 0:p.name),1),s("div",Ct,i((R=l.product)==null?void 0:R.code),1),(V=l.product)!=null&&V.description?(r(),m("div",$t,i(l.product.description),1)):f("",!0)])]}),_:1}),o(S,{label:"数量",width:"100",align:"center"},{default:e(({row:l})=>[u(i(l.quantity),1)]),_:1}),o(S,{label:"单价",width:"120",align:"right"},{default:e(({row:l})=>{var p;return[u(" $"+i((p=l.unit_price)==null?void 0:p.toLocaleString()),1)]}),_:1}),o(S,{label:"折扣",width:"100",align:"center"},{default:e(({row:l})=>[u(i(l.discount_percentage?"".concat(l.discount_percentage,"%"):"-"),1)]),_:1}),o(S,{label:"小计",width:"120",align:"right"},{default:e(({row:l})=>{var p;return[s("span",xt," $"+i((p=l.line_total)==null?void 0:p.toLocaleString()),1)]}),_:1})]),_:1},8,["data"]),s("div",qt,[o(I,null,{default:e(()=>[o(F,{span:12,offset:12},{default:e(()=>{var l,p;return[s("div",Et,[s("div",St,[t[12]||(t[12]=s("span",null,"小计:",-1)),s("span",null,"$"+i((l=a.value.subtotal)==null?void 0:l.toLocaleString()),1)]),a.value.discount_amount&&a.value.discount_amount>0?(r(),m("div",Bt,[s("span",null,"整单折扣 ("+i(a.value.discount_percentage)+"%):",1),s("span",null,"-$"+i(a.value.discount_amount.toLocaleString()),1)])):f("",!0),a.value.tax_amount&&a.value.tax_amount>0?(r(),m("div",Tt,[t[13]||(t[13]=s("span",null,"税费:",-1)),s("span",null,"$"+i(a.value.tax_amount.toLocaleString()),1)])):f("",!0),s("div",Mt,[t[14]||(t[14]=s("span",null,"总计:",-1)),s("span",null,"$"+i((p=a.value.total_price)==null?void 0:p.toLocaleString()),1)])])]}),_:1})]),_:1})])]),_:1}),a.value.notes||a.value.terms_conditions?(r(),m("div",Qt,[a.value.notes?(r(),D(b,{key:0,class:"notes-card"},{header:e(()=>t[15]||(t[15]=[s("span",{class:"card-title"},"备注",-1)])),default:e(()=>[s("p",Ft,i(a.value.notes),1)]),_:1})):f("",!0),a.value.terms_conditions?(r(),D(b,{key:1,class:"terms-card"},{header:e(()=>t[16]||(t[16]=[s("span",{class:"card-title"},"条款和条件",-1)])),default:e(()=>[s("p",ht,i(a.value.terms_conditions),1)]),_:1})):f("",!0)])):f("",!0)]),_:1}),o(F,{span:8},{default:e(()=>[o(b,{class:"actions-card"},{header:e(()=>t[17]||(t[17]=[s("span",{class:"card-title"},"操作",-1)])),default:e(()=>[s("div",Pt,[a.value.status==="draft"?(r(),D(d,{key:0,type:"warning",onClick:t[1]||(t[1]=l=>Q("pending")),loading:y.value,block:""},{default:e(()=>t[18]||(t[18]=[u(" 提交审批 ",-1)])),_:1,__:[18]},8,["loading"])):f("",!0),a.value.status==="pending"?(r(),D(d,{key:1,type:"success",onClick:t[2]||(t[2]=l=>Q("approved")),loading:y.value,block:""},{default:e(()=>t[19]||(t[19]=[u(" 批准报价 ",-1)])),_:1,__:[19]},8,["loading"])):f("",!0),a.value.status==="pending"?(r(),D(d,{key:2,type:"danger",onClick:t[3]||(t[3]=l=>Q("rejected")),loading:y.value,block:""},{default:e(()=>t[20]||(t[20]=[u(" 拒绝报价 ",-1)])),_:1,__:[20]},8,["loading"])):f("",!0),o(d,{type:"primary",onClick:L,loading:C.value,icon:"Download",block:""},{default:e(()=>t[21]||(t[21]=[u(" 下载PDF ",-1)])),_:1,__:[21]},8,["loading"]),o(d,{type:"info",disabled:"",icon:"Message",block:""},{default:e(()=>t[22]||(t[22]=[u(" 邮件报价 ",-1)])),_:1,__:[22]}),o(d,{type:"default",onClick:G,icon:"DocumentCopy",block:""},{default:e(()=>t[23]||(t[23]=[u(" 复制报价 ",-1)])),_:1,__:[23]})])]),_:1}),x.value?(r(),D(b,{key:0,class:"stats-card"},{header:e(()=>t[24]||(t[24]=[s("span",{class:"card-title"},"统计信息",-1)])),default:e(()=>{var l;return[s("div",Lt,[s("div",Nt,[t[25]||(t[25]=s("span",{class:"stat-label"},"Items Count:",-1)),s("span",It,i(((l=a.value.items)==null?void 0:l.length)||0),1)]),s("div",jt,[t[26]||(t[26]=s("span",{class:"stat-label"},"Days Valid:",-1)),s("span",Rt,i(O()),1)])])]}),_:1})):f("",!0)]),_:1})]),_:1})])):w.value?(r(),m("div",Vt,[o(J,{rows:10,animated:""})])):(r(),m("div",zt,[o(W,{icon:"error",title:"Quote not found","sub-title":"The quote you're looking for doesn't exist or you don't have permission to view it."},{extra:e(()=>[o(d,{onClick:t[4]||(t[4]=l=>n.$router.push("/quotes"))},{default:e(()=>t[27]||(t[27]=[u("Back to Quotes",-1)])),_:1,__:[27]})]),_:1})]))])}}}),ue=Y(At,[["__scopeId","data-v-aa5a659f"]]);export{ue as default};
