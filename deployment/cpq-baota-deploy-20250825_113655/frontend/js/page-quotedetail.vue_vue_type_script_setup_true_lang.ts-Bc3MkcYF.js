var a=(a,e,t)=>new Promise((l,s)=>{var n=a=>{try{u(t.next(a))}catch(e){s(e)}},o=a=>{try{u(t.throw(a))}catch(e){s(e)}},u=a=>a.done?l(a.value):Promise.resolve(a.value).then(n,o);u((t=t.apply(a,e)).next())});import{a as e,g as t,V as l,aM as s,h as n,E as o,aa as u,ab as i,f as r,a1 as c,$ as d,b as v}from"./element-plus-DR0qywX_.js";import{z as p,r as _,l as f,A as m,C as g,S as y,J as h,M as b,K as k,aA as w,az as D,P as x,Q as C,B as q}from"./vue-BMWQU0Ry.js";import{o as $}from"./api-BHu6TLr6.js";import{s as S,a as j,u as L}from"./utils-BjNHK8wL.js";const P={class:"quote-detail"},T={class:"page-header"},B={class:"header-actions"},Q={key:0,class:"quote-content"},F={class:"card-header"},z={class:"total-amount"},M={class:"product-info"},A={class:"product-code"},I={key:0,class:"product-description"},N={class:"line-total"},V={class:"quote-totals"},E={class:"totals-section"},J={class:"total-row"},K={key:0,class:"total-row"},U={key:1,class:"total-row"},G={class:"total-row final-total"},H={key:0},O={class:"notes-content"},R={class:"terms-content"},W={class:"action-buttons"},X={class:"stats-content"},Y={class:"stat-item"},Z={class:"stat-value"},aa={class:"stat-item"},ea={class:"stat-value"},ta={key:1,class:"loading"},la={key:2,class:"error"},sa=p({__name:"QuoteDetail",setup(p){const sa=w(),na=D(),oa=_(null),ua=_(!1),ia=_(!1),ra=_(!1),ca=_(!0),da=a=>({draft:"草稿",pending:"待审批",approved:"已审批",rejected:"已拒绝",expired:"已过期"}[a]||a.charAt(0).toUpperCase()+a.slice(1)),va=a=>a?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):"暂无",pa=a=>({pending:"提交审批",approved:"批准",rejected:"拒绝"}[a]||a),_a=()=>{var a;if(!(null==(a=oa.value)?void 0:a.valid_until))return"暂无";const e=new Date(oa.value.valid_until),t=new Date,l=e.getTime()-t.getTime(),s=Math.ceil(l/864e5);return s<0?"已过期":0===s?"今天":"".concat(s,"天")},fa=e=>a(this,null,function*(){if(oa.value)try{const a="您确定要".concat(pa(e),"这个报价吗？");yield v.confirm(a,"确认状态变更",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),ra.value=!0;const t={status:e};yield $.updateQuote(oa.value.id,t),oa.value.status=e,S.success("报价".concat(pa(e),"成功"))}catch(a){"cancel"!==a&&S.error("更新报价状态失败")}finally{ra.value=!1}}),ma=()=>{oa.value&&na.push("/quotes/".concat(oa.value.id,"/edit"))},ga=()=>a(this,null,function*(){if(oa.value)try{yield v.confirm("这将创建一个具有相同项目和客户信息的新报价单。继续吗？","复制报价",{confirmButtonText:"创建复制",cancelButtonText:"取消",type:"info"}),S.info("复制功能将在下一个版本中实现")}catch(a){}}),ya=()=>a(this,null,function*(){if(oa.value)try{ia.value=!0;const a=yield j(oa.value);yield L.downloadPDF(a,"报价单-".concat(oa.value.quote_number)),S.success("PDF生成成功")}catch(a){S.error("生成PDF失败")}finally{ia.value=!1}}),ha=()=>a(this,null,function*(){const a=parseInt(sa.params.id);if(isNaN(a))return S.error("无效的报价ID"),void na.push("/quotes");ua.value=!0;try{const e=yield $.getQuote(a);oa.value=e.quote}catch(e){S.error("加载报价失败")}finally{ua.value=!1}});return f(()=>{ha()}),(a,v)=>{var p;const _=e,f=r,w=i,D=u,$=o,S=d,j=c,L=n,sa=t,na=l,pa=s;return q(),m("div",P,[g("div",T,[v[8]||(v[8]=g("h1",null,"报价详情",-1)),g("div",B,[y(_,{onClick:v[0]||(v[0]=e=>a.$router.go(-1))},{default:k(()=>v[5]||(v[5]=[x("返回",-1)])),_:1,__:[5]}),"draft"===(null==(p=oa.value)?void 0:p.status)?(q(),h(_,{key:0,type:"primary",onClick:ma},{default:k(()=>v[6]||(v[6]=[x(" 编辑 ",-1)])),_:1,__:[6]})):b("",!0),y(_,{type:"success",onClick:ya,loading:ia.value,icon:"Download"},{default:k(()=>v[7]||(v[7]=[x(" 导出PDF ",-1)])),_:1,__:[7]},8,["loading"])])]),oa.value?(q(),m("div",Q,[y(sa,{gutter:20},{default:k(()=>[y(L,{span:16},{default:k(()=>[y($,{class:"quote-info-card"},{header:k(()=>{return[g("div",F,[v[9]||(v[9]=g("span",{class:"card-title"},"报价信息",-1)),y(f,{type:(a=oa.value.status,{draft:"info",pending:"warning",approved:"success",rejected:"danger",expired:"warning"}[a]||"info"),size:"large"},{default:k(()=>[x(C(da(oa.value.status)),1)]),_:1},8,["type"])])];var a}),default:k(()=>[y(D,{column:2,border:""},{default:k(()=>[y(w,{label:"报价单号"},{default:k(()=>[g("strong",null,C(oa.value.quote_number),1)]),_:1}),y(w,{label:"版本"},{default:k(()=>[x(C(oa.value.version||1),1)]),_:1}),y(w,{label:"创建日期"},{default:k(()=>[x(C(va(oa.value.created_at)),1)]),_:1}),y(w,{label:"有效期至"},{default:k(()=>[x(C(va(oa.value.valid_until)),1)]),_:1}),y(w,{label:"创建人"},{default:k(()=>{var a;return[x(C((null==(a=oa.value.created_by_user)?void 0:a.name)||"未知"),1)]}),_:1}),y(w,{label:"总金额"},{default:k(()=>{var a;return[g("strong",z,"$"+C(null==(a=oa.value.total_price)?void 0:a.toLocaleString()),1)]}),_:1})]),_:1})]),_:1}),y($,{class:"customer-info-card"},{header:k(()=>v[10]||(v[10]=[g("span",{class:"card-title"},"客户信息",-1)])),default:k(()=>[y(D,{column:2,border:""},{default:k(()=>[y(w,{label:"客户名称"},{default:k(()=>[x(C(oa.value.customer_name),1)]),_:1}),y(w,{label:"邮箱"},{default:k(()=>[x(C(oa.value.customer_email),1)]),_:1}),y(w,{label:"公司"},{default:k(()=>[x(C(oa.value.customer_company||"暂无"),1)]),_:1}),y(w,{label:"电话"},{default:k(()=>[x(C(oa.value.customer_phone||"暂无"),1)]),_:1}),y(w,{label:"地址",span:2},{default:k(()=>[x(C(oa.value.customer_address||"暂无"),1)]),_:1})]),_:1})]),_:1}),y($,{class:"items-card"},{header:k(()=>v[11]||(v[11]=[g("span",{class:"card-title"},"报价项目",-1)])),default:k(()=>[y(j,{data:oa.value.items||[],style:{width:"100%"},class:"items-table"},{default:k(()=>[y(S,{label:"产品","min-width":"200"},{default:k(({row:a})=>{var e,t,l;return[g("div",M,[g("strong",null,C(null==(e=a.product)?void 0:e.name),1),g("div",A,C(null==(t=a.product)?void 0:t.code),1),(null==(l=a.product)?void 0:l.description)?(q(),m("div",I,C(a.product.description),1)):b("",!0)])]}),_:1}),y(S,{label:"数量",width:"100",align:"center"},{default:k(({row:a})=>[x(C(a.quantity),1)]),_:1}),y(S,{label:"单价",width:"120",align:"right"},{default:k(({row:a})=>{var e;return[x(" $"+C(null==(e=a.unit_price)?void 0:e.toLocaleString()),1)]}),_:1}),y(S,{label:"折扣",width:"100",align:"center"},{default:k(({row:a})=>[x(C(a.discount_percentage?"".concat(a.discount_percentage,"%"):"-"),1)]),_:1}),y(S,{label:"小计",width:"120",align:"right"},{default:k(({row:a})=>{var e;return[g("span",N," $"+C(null==(e=a.line_total)?void 0:e.toLocaleString()),1)]}),_:1})]),_:1},8,["data"]),g("div",V,[y(sa,null,{default:k(()=>[y(L,{span:12,offset:12},{default:k(()=>{var a,e;return[g("div",E,[g("div",J,[v[12]||(v[12]=g("span",null,"小计:",-1)),g("span",null,"$"+C(null==(a=oa.value.subtotal)?void 0:a.toLocaleString()),1)]),oa.value.discount_amount&&oa.value.discount_amount>0?(q(),m("div",K,[g("span",null,"整单折扣 ("+C(oa.value.discount_percentage)+"%):",1),g("span",null,"-$"+C(oa.value.discount_amount.toLocaleString()),1)])):b("",!0),oa.value.tax_amount&&oa.value.tax_amount>0?(q(),m("div",U,[v[13]||(v[13]=g("span",null,"税费:",-1)),g("span",null,"$"+C(oa.value.tax_amount.toLocaleString()),1)])):b("",!0),g("div",G,[v[14]||(v[14]=g("span",null,"总计:",-1)),g("span",null,"$"+C(null==(e=oa.value.total_price)?void 0:e.toLocaleString()),1)])])]}),_:1})]),_:1})])]),_:1}),oa.value.notes||oa.value.terms_conditions?(q(),m("div",H,[oa.value.notes?(q(),h($,{key:0,class:"notes-card"},{header:k(()=>v[15]||(v[15]=[g("span",{class:"card-title"},"备注",-1)])),default:k(()=>[g("p",O,C(oa.value.notes),1)]),_:1})):b("",!0),oa.value.terms_conditions?(q(),h($,{key:1,class:"terms-card"},{header:k(()=>v[16]||(v[16]=[g("span",{class:"card-title"},"条款和条件",-1)])),default:k(()=>[g("p",R,C(oa.value.terms_conditions),1)]),_:1})):b("",!0)])):b("",!0)]),_:1}),y(L,{span:8},{default:k(()=>[y($,{class:"actions-card"},{header:k(()=>v[17]||(v[17]=[g("span",{class:"card-title"},"操作",-1)])),default:k(()=>[g("div",W,["draft"===oa.value.status?(q(),h(_,{key:0,type:"warning",onClick:v[1]||(v[1]=a=>fa("pending")),loading:ra.value,block:""},{default:k(()=>v[18]||(v[18]=[x(" 提交审批 ",-1)])),_:1,__:[18]},8,["loading"])):b("",!0),"pending"===oa.value.status?(q(),h(_,{key:1,type:"success",onClick:v[2]||(v[2]=a=>fa("approved")),loading:ra.value,block:""},{default:k(()=>v[19]||(v[19]=[x(" 批准报价 ",-1)])),_:1,__:[19]},8,["loading"])):b("",!0),"pending"===oa.value.status?(q(),h(_,{key:2,type:"danger",onClick:v[3]||(v[3]=a=>fa("rejected")),loading:ra.value,block:""},{default:k(()=>v[20]||(v[20]=[x(" 拒绝报价 ",-1)])),_:1,__:[20]},8,["loading"])):b("",!0),y(_,{type:"primary",onClick:ya,loading:ia.value,icon:"Download",block:""},{default:k(()=>v[21]||(v[21]=[x(" 下载PDF ",-1)])),_:1,__:[21]},8,["loading"]),y(_,{type:"info",disabled:"",icon:"Message",block:""},{default:k(()=>v[22]||(v[22]=[x(" 邮件报价 ",-1)])),_:1,__:[22]}),y(_,{type:"default",onClick:ga,icon:"DocumentCopy",block:""},{default:k(()=>v[23]||(v[23]=[x(" 复制报价 ",-1)])),_:1,__:[23]})])]),_:1}),ca.value?(q(),h($,{key:0,class:"stats-card"},{header:k(()=>v[24]||(v[24]=[g("span",{class:"card-title"},"统计信息",-1)])),default:k(()=>{var a;return[g("div",X,[g("div",Y,[v[25]||(v[25]=g("span",{class:"stat-label"},"Items Count:",-1)),g("span",Z,C((null==(a=oa.value.items)?void 0:a.length)||0),1)]),g("div",aa,[v[26]||(v[26]=g("span",{class:"stat-label"},"Days Valid:",-1)),g("span",ea,C(_a()),1)])])]}),_:1})):b("",!0)]),_:1})]),_:1})])):ua.value?(q(),m("div",ta,[y(na,{rows:10,animated:""})])):(q(),m("div",la,[y(pa,{icon:"error",title:"Quote not found","sub-title":"The quote you're looking for doesn't exist or you don't have permission to view it."},{extra:k(()=>[y(_,{onClick:v[4]||(v[4]=e=>a.$router.push("/quotes"))},{default:k(()=>v[27]||(v[27]=[x("Back to Quotes",-1)])),_:1,__:[27]})]),_:1})]))])}}});export{sa as _};
